(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const d of f.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function o(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(l){if(l.ep)return;l.ep=!0;const f=o(l);fetch(l.href,f)}})();/**
* @vue/shared v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function kr(n){const s=Object.create(null);for(const o of n.split(","))s[o]=1;return o=>o in s}const Ce={},Pn=[],Rt=()=>{},Qh=()=>!1,ri=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Er=n=>n.startsWith("onUpdate:"),qe=Object.assign,Ir=(n,s)=>{const o=n.indexOf(s);o>-1&&n.splice(o,1)},Yh=Object.prototype.hasOwnProperty,ge=(n,s)=>Yh.call(n,s),X=Array.isArray,kn=n=>oi(n)==="[object Map]",Ya=n=>oi(n)==="[object Set]",ie=n=>typeof n=="function",xe=n=>typeof n=="string",Qt=n=>typeof n=="symbol",Re=n=>n!==null&&typeof n=="object",Xa=n=>(Re(n)||ie(n))&&ie(n.then)&&ie(n.catch),Za=Object.prototype.toString,oi=n=>Za.call(n),Xh=n=>oi(n).slice(8,-1),ec=n=>oi(n)==="[object Object]",xr=n=>xe(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,os=kr(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ai=n=>{const s=Object.create(null);return o=>s[o]||(s[o]=n(o))},Zh=/-(\w)/g,pt=ai(n=>n.replace(Zh,(s,o)=>o?o.toUpperCase():"")),ef=/\B([A-Z])/g,Yt=ai(n=>n.replace(ef,"-$1").toLowerCase()),ci=ai(n=>n.charAt(0).toUpperCase()+n.slice(1)),Ji=ai(n=>n?`on${ci(n)}`:""),ln=(n,s)=>!Object.is(n,s),qs=(n,...s)=>{for(let o=0;o<n.length;o++)n[o](...s)},tc=(n,s,o,c=!1)=>{Object.defineProperty(n,s,{configurable:!0,enumerable:!1,writable:c,value:o})},lr=n=>{const s=parseFloat(n);return isNaN(s)?n:s},tf=n=>{const s=xe(n)?Number(n):NaN;return isNaN(s)?n:s};let da;const li=()=>da||(da=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ln(n){if(X(n)){const s={};for(let o=0;o<n.length;o++){const c=n[o],l=xe(c)?of(c):Ln(c);if(l)for(const f in l)s[f]=l[f]}return s}else if(xe(n)||Re(n))return n}const nf=/;(?![^(]*\))/g,sf=/:([^]+)/,rf=/\/\*[^]*?\*\//g;function of(n){const s={};return n.replace(rf,"").split(nf).forEach(o=>{if(o){const c=o.split(sf);c.length>1&&(s[c[0].trim()]=c[1].trim())}}),s}function Je(n){let s="";if(xe(n))s=n;else if(X(n))for(let o=0;o<n.length;o++){const c=Je(n[o]);c&&(s+=c+" ")}else if(Re(n))for(const o in n)n[o]&&(s+=o+" ");return s.trim()}const af="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",cf=kr(af);function nc(n){return!!n||n===""}const sc=n=>!!(n&&n.__v_isRef===!0),Te=n=>xe(n)?n:n==null?"":X(n)||Re(n)&&(n.toString===Za||!ie(n.toString))?sc(n)?Te(n.value):JSON.stringify(n,ic,2):String(n),ic=(n,s)=>sc(s)?ic(n,s.value):kn(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((o,[c,l],f)=>(o[Qi(c,f)+" =>"]=l,o),{})}:Ya(s)?{[`Set(${s.size})`]:[...s.values()].map(o=>Qi(o))}:Qt(s)?Qi(s):Re(s)&&!X(s)&&!ec(s)?String(s):s,Qi=(n,s="")=>{var o;return Qt(n)?`Symbol(${(o=n.description)!=null?o:s})`:n};/**
* @vue/reactivity v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let st;class lf{constructor(s=!1){this.detached=s,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=st,!s&&st&&(this.index=(st.scopes||(st.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let s,o;if(this.scopes)for(s=0,o=this.scopes.length;s<o;s++)this.scopes[s].pause();for(s=0,o=this.effects.length;s<o;s++)this.effects[s].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let s,o;if(this.scopes)for(s=0,o=this.scopes.length;s<o;s++)this.scopes[s].resume();for(s=0,o=this.effects.length;s<o;s++)this.effects[s].resume()}}run(s){if(this._active){const o=st;try{return st=this,s()}finally{st=o}}}on(){++this._on===1&&(this.prevScope=st,st=this)}off(){this._on>0&&--this._on===0&&(st=this.prevScope,this.prevScope=void 0)}stop(s){if(this._active){this._active=!1;let o,c;for(o=0,c=this.effects.length;o<c;o++)this.effects[o].stop();for(this.effects.length=0,o=0,c=this.cleanups.length;o<c;o++)this.cleanups[o]();if(this.cleanups.length=0,this.scopes){for(o=0,c=this.scopes.length;o<c;o++)this.scopes[o].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!s){const l=this.parent.scopes.pop();l&&l!==this&&(this.parent.scopes[this.index]=l,l.index=this.index)}this.parent=void 0}}}function uf(){return st}let Oe;const Yi=new WeakSet;class rc{constructor(s){this.fn=s,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,st&&st.active&&st.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Yi.has(this)&&(Yi.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ac(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,ga(this),cc(this);const s=Oe,o=yt;Oe=this,yt=!0;try{return this.fn()}finally{lc(this),Oe=s,yt=o,this.flags&=-3}}stop(){if(this.flags&1){for(let s=this.deps;s;s=s.nextDep)Ur(s);this.deps=this.depsTail=void 0,ga(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Yi.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ur(this)&&this.run()}get dirty(){return ur(this)}}let oc=0,as,cs;function ac(n,s=!1){if(n.flags|=8,s){n.next=cs,cs=n;return}n.next=as,as=n}function Lr(){oc++}function Nr(){if(--oc>0)return;if(cs){let s=cs;for(cs=void 0;s;){const o=s.next;s.next=void 0,s.flags&=-9,s=o}}let n;for(;as;){let s=as;for(as=void 0;s;){const o=s.next;if(s.next=void 0,s.flags&=-9,s.flags&1)try{s.trigger()}catch(c){n||(n=c)}s=o}}if(n)throw n}function cc(n){for(let s=n.deps;s;s=s.nextDep)s.version=-1,s.prevActiveLink=s.dep.activeLink,s.dep.activeLink=s}function lc(n){let s,o=n.depsTail,c=o;for(;c;){const l=c.prevDep;c.version===-1?(c===o&&(o=l),Ur(c),hf(c)):s=c,c.dep.activeLink=c.prevActiveLink,c.prevActiveLink=void 0,c=l}n.deps=s,n.depsTail=o}function ur(n){for(let s=n.deps;s;s=s.nextDep)if(s.dep.version!==s.version||s.dep.computed&&(uc(s.dep.computed)||s.dep.version!==s.version))return!0;return!!n._dirty}function uc(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===fs)||(n.globalVersion=fs,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!ur(n))))return;n.flags|=2;const s=n.dep,o=Oe,c=yt;Oe=n,yt=!0;try{cc(n);const l=n.fn(n._value);(s.version===0||ln(l,n._value))&&(n.flags|=128,n._value=l,s.version++)}catch(l){throw s.version++,l}finally{Oe=o,yt=c,lc(n),n.flags&=-3}}function Ur(n,s=!1){const{dep:o,prevSub:c,nextSub:l}=n;if(c&&(c.nextSub=l,n.prevSub=void 0),l&&(l.prevSub=c,n.nextSub=void 0),o.subs===n&&(o.subs=c,!c&&o.computed)){o.computed.flags&=-5;for(let f=o.computed.deps;f;f=f.nextDep)Ur(f,!0)}!s&&!--o.sc&&o.map&&o.map.delete(o.key)}function hf(n){const{prevDep:s,nextDep:o}=n;s&&(s.nextDep=o,n.prevDep=void 0),o&&(o.prevDep=s,n.nextDep=void 0)}let yt=!0;const hc=[];function Ut(){hc.push(yt),yt=!1}function Bt(){const n=hc.pop();yt=n===void 0?!0:n}function ga(n){const{cleanup:s}=n;if(n.cleanup=void 0,s){const o=Oe;Oe=void 0;try{s()}finally{Oe=o}}}let fs=0;class ff{constructor(s,o){this.sub=s,this.dep=o,this.version=o.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class fc{constructor(s){this.computed=s,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(s){if(!Oe||!yt||Oe===this.computed)return;let o=this.activeLink;if(o===void 0||o.sub!==Oe)o=this.activeLink=new ff(Oe,this),Oe.deps?(o.prevDep=Oe.depsTail,Oe.depsTail.nextDep=o,Oe.depsTail=o):Oe.deps=Oe.depsTail=o,dc(o);else if(o.version===-1&&(o.version=this.version,o.nextDep)){const c=o.nextDep;c.prevDep=o.prevDep,o.prevDep&&(o.prevDep.nextDep=c),o.prevDep=Oe.depsTail,o.nextDep=void 0,Oe.depsTail.nextDep=o,Oe.depsTail=o,Oe.deps===o&&(Oe.deps=c)}return o}trigger(s){this.version++,fs++,this.notify(s)}notify(s){Lr();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{Nr()}}}function dc(n){if(n.dep.sc++,n.sub.flags&4){const s=n.dep.computed;if(s&&!n.dep.subs){s.flags|=20;for(let c=s.deps;c;c=c.nextDep)dc(c)}const o=n.dep.subs;o!==n&&(n.prevSub=o,o&&(o.nextSub=n)),n.dep.subs=n}}const hr=new WeakMap,un=Symbol(""),fr=Symbol(""),ds=Symbol("");function Ke(n,s,o){if(yt&&Oe){let c=hr.get(n);c||hr.set(n,c=new Map);let l=c.get(o);l||(c.set(o,l=new fc),l.map=c,l.key=o),l.track()}}function xt(n,s,o,c,l,f){const d=hr.get(n);if(!d){fs++;return}const p=y=>{y&&y.trigger()};if(Lr(),s==="clear")d.forEach(p);else{const y=X(n),O=y&&xr(o);if(y&&o==="length"){const v=Number(c);d.forEach((T,B)=>{(B==="length"||B===ds||!Qt(B)&&B>=v)&&p(T)})}else switch((o!==void 0||d.has(void 0))&&p(d.get(o)),O&&p(d.get(ds)),s){case"add":y?O&&p(d.get("length")):(p(d.get(un)),kn(n)&&p(d.get(fr)));break;case"delete":y||(p(d.get(un)),kn(n)&&p(d.get(fr)));break;case"set":kn(n)&&p(d.get(un));break}}Nr()}function Sn(n){const s=ye(n);return s===n?s:(Ke(s,"iterate",ds),bt(n)?s:s.map(Ye))}function ui(n){return Ke(n=ye(n),"iterate",ds),n}const df={__proto__:null,[Symbol.iterator](){return Xi(this,Symbol.iterator,Ye)},concat(...n){return Sn(this).concat(...n.map(s=>X(s)?Sn(s):s))},entries(){return Xi(this,"entries",n=>(n[1]=Ye(n[1]),n))},every(n,s){return kt(this,"every",n,s,void 0,arguments)},filter(n,s){return kt(this,"filter",n,s,o=>o.map(Ye),arguments)},find(n,s){return kt(this,"find",n,s,Ye,arguments)},findIndex(n,s){return kt(this,"findIndex",n,s,void 0,arguments)},findLast(n,s){return kt(this,"findLast",n,s,Ye,arguments)},findLastIndex(n,s){return kt(this,"findLastIndex",n,s,void 0,arguments)},forEach(n,s){return kt(this,"forEach",n,s,void 0,arguments)},includes(...n){return Zi(this,"includes",n)},indexOf(...n){return Zi(this,"indexOf",n)},join(n){return Sn(this).join(n)},lastIndexOf(...n){return Zi(this,"lastIndexOf",n)},map(n,s){return kt(this,"map",n,s,void 0,arguments)},pop(){return Xn(this,"pop")},push(...n){return Xn(this,"push",n)},reduce(n,...s){return pa(this,"reduce",n,s)},reduceRight(n,...s){return pa(this,"reduceRight",n,s)},shift(){return Xn(this,"shift")},some(n,s){return kt(this,"some",n,s,void 0,arguments)},splice(...n){return Xn(this,"splice",n)},toReversed(){return Sn(this).toReversed()},toSorted(n){return Sn(this).toSorted(n)},toSpliced(...n){return Sn(this).toSpliced(...n)},unshift(...n){return Xn(this,"unshift",n)},values(){return Xi(this,"values",Ye)}};function Xi(n,s,o){const c=ui(n),l=c[s]();return c!==n&&!bt(n)&&(l._next=l.next,l.next=()=>{const f=l._next();return f.value&&(f.value=o(f.value)),f}),l}const gf=Array.prototype;function kt(n,s,o,c,l,f){const d=ui(n),p=d!==n&&!bt(n),y=d[s];if(y!==gf[s]){const T=y.apply(n,f);return p?Ye(T):T}let O=o;d!==n&&(p?O=function(T,B){return o.call(this,Ye(T),B,n)}:o.length>2&&(O=function(T,B){return o.call(this,T,B,n)}));const v=y.call(d,O,c);return p&&l?l(v):v}function pa(n,s,o,c){const l=ui(n);let f=o;return l!==n&&(bt(n)?o.length>3&&(f=function(d,p,y){return o.call(this,d,p,y,n)}):f=function(d,p,y){return o.call(this,d,Ye(p),y,n)}),l[s](f,...c)}function Zi(n,s,o){const c=ye(n);Ke(c,"iterate",ds);const l=c[s](...o);return(l===-1||l===!1)&&Gr(o[0])?(o[0]=ye(o[0]),c[s](...o)):l}function Xn(n,s,o=[]){Ut(),Lr();const c=ye(n)[s].apply(n,o);return Nr(),Bt(),c}const pf=kr("__proto__,__v_isRef,__isVue"),gc=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Qt));function mf(n){Qt(n)||(n=String(n));const s=ye(this);return Ke(s,"has",n),s.hasOwnProperty(n)}class pc{constructor(s=!1,o=!1){this._isReadonly=s,this._isShallow=o}get(s,o,c){if(o==="__v_skip")return s.__v_skip;const l=this._isReadonly,f=this._isShallow;if(o==="__v_isReactive")return!l;if(o==="__v_isReadonly")return l;if(o==="__v_isShallow")return f;if(o==="__v_raw")return c===(l?f?Rf:vc:f?bc:yc).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(c)?s:void 0;const d=X(s);if(!l){let y;if(d&&(y=df[o]))return y;if(o==="hasOwnProperty")return mf}const p=Reflect.get(s,o,et(s)?s:c);return(Qt(o)?gc.has(o):pf(o))||(l||Ke(s,"get",o),f)?p:et(p)?d&&xr(o)?p:p.value:Re(p)?l?wc(p):Dr(p):p}}class mc extends pc{constructor(s=!1){super(!1,s)}set(s,o,c,l){let f=s[o];if(!this._isShallow){const y=hn(f);if(!bt(c)&&!hn(c)&&(f=ye(f),c=ye(c)),!X(s)&&et(f)&&!et(c))return y?!1:(f.value=c,!0)}const d=X(s)&&xr(o)?Number(o)<s.length:ge(s,o),p=Reflect.set(s,o,c,et(s)?s:l);return s===ye(l)&&(d?ln(c,f)&&xt(s,"set",o,c):xt(s,"add",o,c)),p}deleteProperty(s,o){const c=ge(s,o);s[o];const l=Reflect.deleteProperty(s,o);return l&&c&&xt(s,"delete",o,void 0),l}has(s,o){const c=Reflect.has(s,o);return(!Qt(o)||!gc.has(o))&&Ke(s,"has",o),c}ownKeys(s){return Ke(s,"iterate",X(s)?"length":un),Reflect.ownKeys(s)}}class yf extends pc{constructor(s=!1){super(!0,s)}set(s,o){return!0}deleteProperty(s,o){return!0}}const bf=new mc,vf=new yf,wf=new mc(!0);const dr=n=>n,Bs=n=>Reflect.getPrototypeOf(n);function Cf(n,s,o){return function(...c){const l=this.__v_raw,f=ye(l),d=kn(f),p=n==="entries"||n===Symbol.iterator&&d,y=n==="keys"&&d,O=l[n](...c),v=o?dr:s?zs:Ye;return!s&&Ke(f,"iterate",y?fr:un),{next(){const{value:T,done:B}=O.next();return B?{value:T,done:B}:{value:p?[v(T[0]),v(T[1])]:v(T),done:B}},[Symbol.iterator](){return this}}}}function Ds(n){return function(...s){return n==="delete"?!1:n==="clear"?void 0:this}}function _f(n,s){const o={get(l){const f=this.__v_raw,d=ye(f),p=ye(l);n||(ln(l,p)&&Ke(d,"get",l),Ke(d,"get",p));const{has:y}=Bs(d),O=s?dr:n?zs:Ye;if(y.call(d,l))return O(f.get(l));if(y.call(d,p))return O(f.get(p));f!==d&&f.get(l)},get size(){const l=this.__v_raw;return!n&&Ke(ye(l),"iterate",un),Reflect.get(l,"size",l)},has(l){const f=this.__v_raw,d=ye(f),p=ye(l);return n||(ln(l,p)&&Ke(d,"has",l),Ke(d,"has",p)),l===p?f.has(l):f.has(l)||f.has(p)},forEach(l,f){const d=this,p=d.__v_raw,y=ye(p),O=s?dr:n?zs:Ye;return!n&&Ke(y,"iterate",un),p.forEach((v,T)=>l.call(f,O(v),O(T),d))}};return qe(o,n?{add:Ds("add"),set:Ds("set"),delete:Ds("delete"),clear:Ds("clear")}:{add(l){!s&&!bt(l)&&!hn(l)&&(l=ye(l));const f=ye(this);return Bs(f).has.call(f,l)||(f.add(l),xt(f,"add",l,l)),this},set(l,f){!s&&!bt(f)&&!hn(f)&&(f=ye(f));const d=ye(this),{has:p,get:y}=Bs(d);let O=p.call(d,l);O||(l=ye(l),O=p.call(d,l));const v=y.call(d,l);return d.set(l,f),O?ln(f,v)&&xt(d,"set",l,f):xt(d,"add",l,f),this},delete(l){const f=ye(this),{has:d,get:p}=Bs(f);let y=d.call(f,l);y||(l=ye(l),y=d.call(f,l)),p&&p.call(f,l);const O=f.delete(l);return y&&xt(f,"delete",l,void 0),O},clear(){const l=ye(this),f=l.size!==0,d=l.clear();return f&&xt(l,"clear",void 0,void 0),d}}),["keys","values","entries",Symbol.iterator].forEach(l=>{o[l]=Cf(l,n,s)}),o}function Br(n,s){const o=_f(n,s);return(c,l,f)=>l==="__v_isReactive"?!n:l==="__v_isReadonly"?n:l==="__v_raw"?c:Reflect.get(ge(o,l)&&l in c?o:c,l,f)}const Sf={get:Br(!1,!1)},Of={get:Br(!1,!0)},Af={get:Br(!0,!1)};const yc=new WeakMap,bc=new WeakMap,vc=new WeakMap,Rf=new WeakMap;function Tf(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Mf(n){return n.__v_skip||!Object.isExtensible(n)?0:Tf(Xh(n))}function Dr(n){return hn(n)?n:Hr(n,!1,bf,Sf,yc)}function Pf(n){return Hr(n,!1,wf,Of,bc)}function wc(n){return Hr(n,!0,vf,Af,vc)}function Hr(n,s,o,c,l){if(!Re(n)||n.__v_raw&&!(s&&n.__v_isReactive))return n;const f=Mf(n);if(f===0)return n;const d=l.get(n);if(d)return d;const p=new Proxy(n,f===2?c:o);return l.set(n,p),p}function En(n){return hn(n)?En(n.__v_raw):!!(n&&n.__v_isReactive)}function hn(n){return!!(n&&n.__v_isReadonly)}function bt(n){return!!(n&&n.__v_isShallow)}function Gr(n){return n?!!n.__v_raw:!1}function ye(n){const s=n&&n.__v_raw;return s?ye(s):n}function kf(n){return!ge(n,"__v_skip")&&Object.isExtensible(n)&&tc(n,"__v_skip",!0),n}const Ye=n=>Re(n)?Dr(n):n,zs=n=>Re(n)?wc(n):n;function et(n){return n?n.__v_isRef===!0:!1}function Ef(n){return et(n)?n.value:n}const If={get:(n,s,o)=>s==="__v_raw"?n:Ef(Reflect.get(n,s,o)),set:(n,s,o,c)=>{const l=n[s];return et(l)&&!et(o)?(l.value=o,!0):Reflect.set(n,s,o,c)}};function Cc(n){return En(n)?n:new Proxy(n,If)}class xf{constructor(s,o,c){this.fn=s,this.setter=o,this._value=void 0,this.dep=new fc(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=fs-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!o,this.isSSR=c}notify(){if(this.flags|=16,!(this.flags&8)&&Oe!==this)return ac(this,!0),!0}get value(){const s=this.dep.track();return uc(this),s&&(s.version=this.dep.version),this._value}set value(s){this.setter&&this.setter(s)}}function Lf(n,s,o=!1){let c,l;return ie(n)?c=n:(c=n.get,l=n.set),new xf(c,l,o)}const Hs={},Js=new WeakMap;let an;function Nf(n,s=!1,o=an){if(o){let c=Js.get(o);c||Js.set(o,c=[]),c.push(n)}}function Uf(n,s,o=Ce){const{immediate:c,deep:l,once:f,scheduler:d,augmentJob:p,call:y}=o,O=_=>l?_:bt(_)||l===!1||l===0?Lt(_,1):Lt(_);let v,T,B,U,J=!1,re=!1;if(et(n)?(T=()=>n.value,J=bt(n)):En(n)?(T=()=>O(n),J=!0):X(n)?(re=!0,J=n.some(_=>En(_)||bt(_)),T=()=>n.map(_=>{if(et(_))return _.value;if(En(_))return O(_);if(ie(_))return y?y(_,2):_()})):ie(n)?s?T=y?()=>y(n,2):n:T=()=>{if(B){Ut();try{B()}finally{Bt()}}const _=an;an=v;try{return y?y(n,3,[U]):n(U)}finally{an=_}}:T=Rt,s&&l){const _=T,me=l===!0?1/0:l;T=()=>Lt(_(),me)}const Me=uf(),ce=()=>{v.stop(),Me&&Me.active&&Ir(Me.effects,v)};if(f&&s){const _=s;s=(...me)=>{_(...me),ce()}}let pe=re?new Array(n.length).fill(Hs):Hs;const fe=_=>{if(!(!(v.flags&1)||!v.dirty&&!_))if(s){const me=v.run();if(l||J||(re?me.some((Pe,De)=>ln(Pe,pe[De])):ln(me,pe))){B&&B();const Pe=an;an=v;try{const De=[me,pe===Hs?void 0:re&&pe[0]===Hs?[]:pe,U];pe=me,y?y(s,3,De):s(...De)}finally{an=Pe}}}else v.run()};return p&&p(fe),v=new rc(T),v.scheduler=d?()=>d(fe,!1):fe,U=_=>Nf(_,!1,v),B=v.onStop=()=>{const _=Js.get(v);if(_){if(y)y(_,4);else for(const me of _)me();Js.delete(v)}},s?c?fe(!0):pe=v.run():d?d(fe.bind(null,!0),!0):v.run(),ce.pause=v.pause.bind(v),ce.resume=v.resume.bind(v),ce.stop=ce,ce}function Lt(n,s=1/0,o){if(s<=0||!Re(n)||n.__v_skip||(o=o||new Set,o.has(n)))return n;if(o.add(n),s--,et(n))Lt(n.value,s,o);else if(X(n))for(let c=0;c<n.length;c++)Lt(n[c],s,o);else if(Ya(n)||kn(n))n.forEach(c=>{Lt(c,s,o)});else if(ec(n)){for(const c in n)Lt(n[c],s,o);for(const c of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,c)&&Lt(n[c],s,o)}return n}/**
* @vue/runtime-core v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ws(n,s,o,c){try{return c?n(...c):n()}catch(l){hi(l,s,o)}}function vt(n,s,o,c){if(ie(n)){const l=ws(n,s,o,c);return l&&Xa(l)&&l.catch(f=>{hi(f,s,o)}),l}if(X(n)){const l=[];for(let f=0;f<n.length;f++)l.push(vt(n[f],s,o,c));return l}}function hi(n,s,o,c=!0){const l=s?s.vnode:null,{errorHandler:f,throwUnhandledErrorInProduction:d}=s&&s.appContext.config||Ce;if(s){let p=s.parent;const y=s.proxy,O=`https://vuejs.org/error-reference/#runtime-${o}`;for(;p;){const v=p.ec;if(v){for(let T=0;T<v.length;T++)if(v[T](n,y,O)===!1)return}p=p.parent}if(f){Ut(),ws(f,null,10,[n,y,O]),Bt();return}}Bf(n,o,l,c,d)}function Bf(n,s,o,c=!0,l=!1){if(l)throw n;console.error(n)}const Xe=[];let Ot=-1;const In=[];let $t=null,On=0;const _c=Promise.resolve();let Qs=null;function Df(n){const s=Qs||_c;return n?s.then(this?n.bind(this):n):s}function Hf(n){let s=Ot+1,o=Xe.length;for(;s<o;){const c=s+o>>>1,l=Xe[c],f=gs(l);f<n||f===n&&l.flags&2?s=c+1:o=c}return s}function jr(n){if(!(n.flags&1)){const s=gs(n),o=Xe[Xe.length-1];!o||!(n.flags&2)&&s>=gs(o)?Xe.push(n):Xe.splice(Hf(s),0,n),n.flags|=1,Sc()}}function Sc(){Qs||(Qs=_c.then(Ac))}function Gf(n){X(n)?In.push(...n):$t&&n.id===-1?$t.splice(On+1,0,n):n.flags&1||(In.push(n),n.flags|=1),Sc()}function ma(n,s,o=Ot+1){for(;o<Xe.length;o++){const c=Xe[o];if(c&&c.flags&2){if(n&&c.id!==n.uid)continue;Xe.splice(o,1),o--,c.flags&4&&(c.flags&=-2),c(),c.flags&4||(c.flags&=-2)}}}function Oc(n){if(In.length){const s=[...new Set(In)].sort((o,c)=>gs(o)-gs(c));if(In.length=0,$t){$t.push(...s);return}for($t=s,On=0;On<$t.length;On++){const o=$t[On];o.flags&4&&(o.flags&=-2),o.flags&8||o(),o.flags&=-2}$t=null,On=0}}const gs=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Ac(n){try{for(Ot=0;Ot<Xe.length;Ot++){const s=Xe[Ot];s&&!(s.flags&8)&&(s.flags&4&&(s.flags&=-2),ws(s,s.i,s.i?15:14),s.flags&4||(s.flags&=-2))}}finally{for(;Ot<Xe.length;Ot++){const s=Xe[Ot];s&&(s.flags&=-2)}Ot=-1,Xe.length=0,Oc(),Qs=null,(Xe.length||In.length)&&Ac()}}let rt=null,Rc=null;function Ys(n){const s=rt;return rt=n,Rc=n&&n.type.__scopeId||null,s}function ps(n,s=rt,o){if(!s||n._n)return n;const c=(...l)=>{c._d&&Ta(-1);const f=Ys(s);let d;try{d=n(...l)}finally{Ys(f),c._d&&Ta(1)}return d};return c._n=!0,c._c=!0,c._d=!0,c}function Nt(n,s){if(rt===null)return n;const o=mi(rt),c=n.dirs||(n.dirs=[]);for(let l=0;l<s.length;l++){let[f,d,p,y=Ce]=s[l];f&&(ie(f)&&(f={mounted:f,updated:f}),f.deep&&Lt(d),c.push({dir:f,instance:o,value:d,oldValue:void 0,arg:p,modifiers:y}))}return n}function nn(n,s,o,c){const l=n.dirs,f=s&&s.dirs;for(let d=0;d<l.length;d++){const p=l[d];f&&(p.oldValue=f[d].value);let y=p.dir[c];y&&(Ut(),vt(y,o,8,[n.el,p,n,s]),Bt())}}const jf=Symbol("_vte"),Tc=n=>n.__isTeleport,Kt=Symbol("_leaveCb"),Gs=Symbol("_enterCb");function qf(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Nc(()=>{n.isMounted=!0}),Uc(()=>{n.isUnmounting=!0}),n}const gt=[Function,Array],Mc={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:gt,onEnter:gt,onAfterEnter:gt,onEnterCancelled:gt,onBeforeLeave:gt,onLeave:gt,onAfterLeave:gt,onLeaveCancelled:gt,onBeforeAppear:gt,onAppear:gt,onAfterAppear:gt,onAppearCancelled:gt},Pc=n=>{const s=n.subTree;return s.component?Pc(s.component):s},Ff={name:"BaseTransition",props:Mc,setup(n,{slots:s}){const o=jd(),c=qf();return()=>{const l=s.default&&Ic(s.default(),!0);if(!l||!l.length)return;const f=kc(l),d=ye(n),{mode:p}=d;if(c.isLeaving)return er(f);const y=ya(f);if(!y)return er(f);let O=gr(y,d,c,o,T=>O=T);y.type!==Ze&&ms(y,O);let v=o.subTree&&ya(o.subTree);if(v&&v.type!==Ze&&!cn(y,v)&&Pc(o).type!==Ze){let T=gr(v,d,c,o);if(ms(v,T),p==="out-in"&&y.type!==Ze)return c.isLeaving=!0,T.afterLeave=()=>{c.isLeaving=!1,o.job.flags&8||o.update(),delete T.afterLeave,v=void 0},er(f);p==="in-out"&&y.type!==Ze?T.delayLeave=(B,U,J)=>{const re=Ec(c,v);re[String(v.key)]=v,B[Kt]=()=>{U(),B[Kt]=void 0,delete O.delayedLeave,v=void 0},O.delayedLeave=()=>{J(),delete O.delayedLeave,v=void 0}}:v=void 0}else v&&(v=void 0);return f}}};function kc(n){let s=n[0];if(n.length>1){for(const o of n)if(o.type!==Ze){s=o;break}}return s}const Vf=Ff;function Ec(n,s){const{leavingVNodes:o}=n;let c=o.get(s.type);return c||(c=Object.create(null),o.set(s.type,c)),c}function gr(n,s,o,c,l){const{appear:f,mode:d,persisted:p=!1,onBeforeEnter:y,onEnter:O,onAfterEnter:v,onEnterCancelled:T,onBeforeLeave:B,onLeave:U,onAfterLeave:J,onLeaveCancelled:re,onBeforeAppear:Me,onAppear:ce,onAfterAppear:pe,onAppearCancelled:fe}=s,_=String(n.key),me=Ec(o,n),Pe=(te,de)=>{te&&vt(te,c,9,de)},De=(te,de)=>{const h=de[1];Pe(te,de),X(te)?te.every(W=>W.length<=1)&&h():te.length<=1&&h()},Fe={mode:d,persisted:p,beforeEnter(te){let de=y;if(!o.isMounted)if(f)de=Me||y;else return;te[Kt]&&te[Kt](!0);const h=me[_];h&&cn(n,h)&&h.el[Kt]&&h.el[Kt](),Pe(de,[te])},enter(te){let de=O,h=v,W=T;if(!o.isMounted)if(f)de=ce||O,h=pe||v,W=fe||T;else return;let ve=!1;const R=te[Gs]=_e=>{ve||(ve=!0,_e?Pe(W,[te]):Pe(h,[te]),Fe.delayedLeave&&Fe.delayedLeave(),te[Gs]=void 0)};de?De(de,[te,R]):R()},leave(te,de){const h=String(n.key);if(te[Gs]&&te[Gs](!0),o.isUnmounting)return de();Pe(B,[te]);let W=!1;const ve=te[Kt]=R=>{W||(W=!0,de(),R?Pe(re,[te]):Pe(J,[te]),te[Kt]=void 0,me[h]===n&&delete me[h])};me[h]=n,U?De(U,[te,ve]):ve()},clone(te){const de=gr(te,s,o,c,l);return l&&l(de),de}};return Fe}function er(n){if(fi(n))return n=Jt(n),n.children=null,n}function ya(n){if(!fi(n))return Tc(n.type)&&n.children?kc(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:s,children:o}=n;if(o){if(s&16)return o[0];if(s&32&&ie(o.default))return o.default()}}function ms(n,s){n.shapeFlag&6&&n.component?(n.transition=s,ms(n.component.subTree,s)):n.shapeFlag&128?(n.ssContent.transition=s.clone(n.ssContent),n.ssFallback.transition=s.clone(n.ssFallback)):n.transition=s}function Ic(n,s=!1,o){let c=[],l=0;for(let f=0;f<n.length;f++){let d=n[f];const p=o==null?d.key:String(o)+String(d.key!=null?d.key:f);d.type===ze?(d.patchFlag&128&&l++,c=c.concat(Ic(d.children,s,p))):(s||d.type!==Ze)&&c.push(p!=null?Jt(d,{key:p}):d)}if(l>1)for(let f=0;f<c.length;f++)c[f].patchFlag=-2;return c}function xc(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Xs(n,s,o,c,l=!1){if(X(n)){n.forEach((J,re)=>Xs(J,s&&(X(s)?s[re]:s),o,c,l));return}if(ls(c)&&!l){c.shapeFlag&512&&c.type.__asyncResolved&&c.component.subTree.component&&Xs(n,s,o,c.component.subTree);return}const f=c.shapeFlag&4?mi(c.component):c.el,d=l?null:f,{i:p,r:y}=n,O=s&&s.r,v=p.refs===Ce?p.refs={}:p.refs,T=p.setupState,B=ye(T),U=T===Ce?()=>!1:J=>ge(B,J);if(O!=null&&O!==y&&(xe(O)?(v[O]=null,U(O)&&(T[O]=null)):et(O)&&(O.value=null)),ie(y))ws(y,p,12,[d,v]);else{const J=xe(y),re=et(y);if(J||re){const Me=()=>{if(n.f){const ce=J?U(y)?T[y]:v[y]:y.value;l?X(ce)&&Ir(ce,f):X(ce)?ce.includes(f)||ce.push(f):J?(v[y]=[f],U(y)&&(T[y]=v[y])):(y.value=[f],n.k&&(v[n.k]=y.value))}else J?(v[y]=d,U(y)&&(T[y]=d)):re&&(y.value=d,n.k&&(v[n.k]=d))};d?(Me.id=-1,ht(Me,o)):Me()}}}li().requestIdleCallback;li().cancelIdleCallback;const ls=n=>!!n.type.__asyncLoader,fi=n=>n.type.__isKeepAlive;function Wf(n,s){Lc(n,"a",s)}function $f(n,s){Lc(n,"da",s)}function Lc(n,s,o=Ge){const c=n.__wdc||(n.__wdc=()=>{let l=o;for(;l;){if(l.isDeactivated)return;l=l.parent}return n()});if(di(s,c,o),o){let l=o.parent;for(;l&&l.parent;)fi(l.parent.vnode)&&Kf(c,s,o,l),l=l.parent}}function Kf(n,s,o,c){const l=di(s,n,c,!0);Bc(()=>{Ir(c[s],l)},o)}function di(n,s,o=Ge,c=!1){if(o){const l=o[n]||(o[n]=[]),f=s.__weh||(s.__weh=(...d)=>{Ut();const p=Cs(o),y=vt(s,o,n,d);return p(),Bt(),y});return c?l.unshift(f):l.push(f),f}}const Dt=n=>(s,o=Ge)=>{(!bs||n==="sp")&&di(n,(...c)=>s(...c),o)},zf=Dt("bm"),Nc=Dt("m"),Jf=Dt("bu"),Qf=Dt("u"),Uc=Dt("bum"),Bc=Dt("um"),Yf=Dt("sp"),Xf=Dt("rtg"),Zf=Dt("rtc");function ed(n,s=Ge){di("ec",n,s)}const td="components";function js(n,s){return sd(td,n,!0,s)||n}const nd=Symbol.for("v-ndc");function sd(n,s,o=!0,c=!1){const l=rt||Ge;if(l){const f=l.type;{const p=$d(f,!1);if(p&&(p===s||p===pt(s)||p===ci(pt(s))))return f}const d=ba(l[n]||f[n],s)||ba(l.appContext[n],s);return!d&&c?f:d}}function ba(n,s){return n&&(n[s]||n[pt(s)]||n[ci(pt(s))])}function Nn(n,s,o,c){let l;const f=o,d=X(n);if(d||xe(n)){const p=d&&En(n);let y=!1,O=!1;p&&(y=!bt(n),O=hn(n),n=ui(n)),l=new Array(n.length);for(let v=0,T=n.length;v<T;v++)l[v]=s(y?O?zs(Ye(n[v])):Ye(n[v]):n[v],v,void 0,f)}else if(typeof n=="number"){l=new Array(n);for(let p=0;p<n;p++)l[p]=s(p+1,p,void 0,f)}else if(Re(n))if(n[Symbol.iterator])l=Array.from(n,(p,y)=>s(p,y,void 0,f));else{const p=Object.keys(n);l=new Array(p.length);for(let y=0,O=p.length;y<O;y++){const v=p[y];l[y]=s(n[v],v,y,f)}}else l=[];return l}const pr=n=>n?sl(n)?mi(n):pr(n.parent):null,us=qe(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>pr(n.parent),$root:n=>pr(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Hc(n),$forceUpdate:n=>n.f||(n.f=()=>{jr(n.update)}),$nextTick:n=>n.n||(n.n=Df.bind(n.proxy)),$watch:n=>Ad.bind(n)}),tr=(n,s)=>n!==Ce&&!n.__isScriptSetup&&ge(n,s),id={get({_:n},s){if(s==="__v_skip")return!0;const{ctx:o,setupState:c,data:l,props:f,accessCache:d,type:p,appContext:y}=n;let O;if(s[0]!=="$"){const U=d[s];if(U!==void 0)switch(U){case 1:return c[s];case 2:return l[s];case 4:return o[s];case 3:return f[s]}else{if(tr(c,s))return d[s]=1,c[s];if(l!==Ce&&ge(l,s))return d[s]=2,l[s];if((O=n.propsOptions[0])&&ge(O,s))return d[s]=3,f[s];if(o!==Ce&&ge(o,s))return d[s]=4,o[s];mr&&(d[s]=0)}}const v=us[s];let T,B;if(v)return s==="$attrs"&&Ke(n.attrs,"get",""),v(n);if((T=p.__cssModules)&&(T=T[s]))return T;if(o!==Ce&&ge(o,s))return d[s]=4,o[s];if(B=y.config.globalProperties,ge(B,s))return B[s]},set({_:n},s,o){const{data:c,setupState:l,ctx:f}=n;return tr(l,s)?(l[s]=o,!0):c!==Ce&&ge(c,s)?(c[s]=o,!0):ge(n.props,s)||s[0]==="$"&&s.slice(1)in n?!1:(f[s]=o,!0)},has({_:{data:n,setupState:s,accessCache:o,ctx:c,appContext:l,propsOptions:f}},d){let p;return!!o[d]||n!==Ce&&ge(n,d)||tr(s,d)||(p=f[0])&&ge(p,d)||ge(c,d)||ge(us,d)||ge(l.config.globalProperties,d)},defineProperty(n,s,o){return o.get!=null?n._.accessCache[s]=0:ge(o,"value")&&this.set(n,s,o.value,null),Reflect.defineProperty(n,s,o)}};function va(n){return X(n)?n.reduce((s,o)=>(s[o]=null,s),{}):n}let mr=!0;function rd(n){const s=Hc(n),o=n.proxy,c=n.ctx;mr=!1,s.beforeCreate&&wa(s.beforeCreate,n,"bc");const{data:l,computed:f,methods:d,watch:p,provide:y,inject:O,created:v,beforeMount:T,mounted:B,beforeUpdate:U,updated:J,activated:re,deactivated:Me,beforeDestroy:ce,beforeUnmount:pe,destroyed:fe,unmounted:_,render:me,renderTracked:Pe,renderTriggered:De,errorCaptured:Fe,serverPrefetch:te,expose:de,inheritAttrs:h,components:W,directives:ve,filters:R}=s;if(O&&od(O,c,null),d)for(const $ in d){const le=d[$];ie(le)&&(c[$]=le.bind(o))}if(l){const $=l.call(o,o);Re($)&&(n.data=Dr($))}if(mr=!0,f)for(const $ in f){const le=f[$],wt=ie(le)?le.bind(o,o):ie(le.get)?le.get.bind(o,o):Rt,mt=!ie(le)&&ie(le.set)?le.set.bind(o):Rt,Tt=zd({get:wt,set:mt});Object.defineProperty(c,$,{enumerable:!0,configurable:!0,get:()=>Tt.value,set:ke=>Tt.value=ke})}if(p)for(const $ in p)Dc(p[$],c,o,$);if(y){const $=ie(y)?y.call(o):y;Reflect.ownKeys($).forEach(le=>{fd(le,$[le])})}v&&wa(v,n,"c");function Le($,le){X(le)?le.forEach(wt=>$(wt.bind(o))):le&&$(le.bind(o))}if(Le(zf,T),Le(Nc,B),Le(Jf,U),Le(Qf,J),Le(Wf,re),Le($f,Me),Le(ed,Fe),Le(Zf,Pe),Le(Xf,De),Le(Uc,pe),Le(Bc,_),Le(Yf,te),X(de))if(de.length){const $=n.exposed||(n.exposed={});de.forEach(le=>{Object.defineProperty($,le,{get:()=>o[le],set:wt=>o[le]=wt})})}else n.exposed||(n.exposed={});me&&n.render===Rt&&(n.render=me),h!=null&&(n.inheritAttrs=h),W&&(n.components=W),ve&&(n.directives=ve),te&&xc(n)}function od(n,s,o=Rt){X(n)&&(n=yr(n));for(const c in n){const l=n[c];let f;Re(l)?"default"in l?f=Fs(l.from||c,l.default,!0):f=Fs(l.from||c):f=Fs(l),et(f)?Object.defineProperty(s,c,{enumerable:!0,configurable:!0,get:()=>f.value,set:d=>f.value=d}):s[c]=f}}function wa(n,s,o){vt(X(n)?n.map(c=>c.bind(s.proxy)):n.bind(s.proxy),s,o)}function Dc(n,s,o,c){let l=c.includes(".")?Xc(o,c):()=>o[c];if(xe(n)){const f=s[n];ie(f)&&sr(l,f)}else if(ie(n))sr(l,n.bind(o));else if(Re(n))if(X(n))n.forEach(f=>Dc(f,s,o,c));else{const f=ie(n.handler)?n.handler.bind(o):s[n.handler];ie(f)&&sr(l,f,n)}}function Hc(n){const s=n.type,{mixins:o,extends:c}=s,{mixins:l,optionsCache:f,config:{optionMergeStrategies:d}}=n.appContext,p=f.get(s);let y;return p?y=p:!l.length&&!o&&!c?y=s:(y={},l.length&&l.forEach(O=>Zs(y,O,d,!0)),Zs(y,s,d)),Re(s)&&f.set(s,y),y}function Zs(n,s,o,c=!1){const{mixins:l,extends:f}=s;f&&Zs(n,f,o,!0),l&&l.forEach(d=>Zs(n,d,o,!0));for(const d in s)if(!(c&&d==="expose")){const p=ad[d]||o&&o[d];n[d]=p?p(n[d],s[d]):s[d]}return n}const ad={data:Ca,props:_a,emits:_a,methods:ts,computed:ts,beforeCreate:Qe,created:Qe,beforeMount:Qe,mounted:Qe,beforeUpdate:Qe,updated:Qe,beforeDestroy:Qe,beforeUnmount:Qe,destroyed:Qe,unmounted:Qe,activated:Qe,deactivated:Qe,errorCaptured:Qe,serverPrefetch:Qe,components:ts,directives:ts,watch:ld,provide:Ca,inject:cd};function Ca(n,s){return s?n?function(){return qe(ie(n)?n.call(this,this):n,ie(s)?s.call(this,this):s)}:s:n}function cd(n,s){return ts(yr(n),yr(s))}function yr(n){if(X(n)){const s={};for(let o=0;o<n.length;o++)s[n[o]]=n[o];return s}return n}function Qe(n,s){return n?[...new Set([].concat(n,s))]:s}function ts(n,s){return n?qe(Object.create(null),n,s):s}function _a(n,s){return n?X(n)&&X(s)?[...new Set([...n,...s])]:qe(Object.create(null),va(n),va(s??{})):s}function ld(n,s){if(!n)return s;if(!s)return n;const o=qe(Object.create(null),n);for(const c in s)o[c]=Qe(n[c],s[c]);return o}function Gc(){return{app:null,config:{isNativeTag:Qh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ud=0;function hd(n,s){return function(c,l=null){ie(c)||(c=qe({},c)),l!=null&&!Re(l)&&(l=null);const f=Gc(),d=new WeakSet,p=[];let y=!1;const O=f.app={_uid:ud++,_component:c,_props:l,_container:null,_context:f,_instance:null,version:Qd,get config(){return f.config},set config(v){},use(v,...T){return d.has(v)||(v&&ie(v.install)?(d.add(v),v.install(O,...T)):ie(v)&&(d.add(v),v(O,...T))),O},mixin(v){return f.mixins.includes(v)||f.mixins.push(v),O},component(v,T){return T?(f.components[v]=T,O):f.components[v]},directive(v,T){return T?(f.directives[v]=T,O):f.directives[v]},mount(v,T,B){if(!y){const U=O._ceVNode||je(c,l);return U.appContext=f,B===!0?B="svg":B===!1&&(B=void 0),n(U,v,B),y=!0,O._container=v,v.__vue_app__=O,mi(U.component)}},onUnmount(v){p.push(v)},unmount(){y&&(vt(p,O._instance,16),n(null,O._container),delete O._container.__vue_app__)},provide(v,T){return f.provides[v]=T,O},runWithContext(v){const T=xn;xn=O;try{return v()}finally{xn=T}}};return O}}let xn=null;function fd(n,s){if(Ge){let o=Ge.provides;const c=Ge.parent&&Ge.parent.provides;c===o&&(o=Ge.provides=Object.create(c)),o[n]=s}}function Fs(n,s,o=!1){const c=Ge||rt;if(c||xn){let l=xn?xn._context.provides:c?c.parent==null||c.ce?c.vnode.appContext&&c.vnode.appContext.provides:c.parent.provides:void 0;if(l&&n in l)return l[n];if(arguments.length>1)return o&&ie(s)?s.call(c&&c.proxy):s}}const jc={},qc=()=>Object.create(jc),Fc=n=>Object.getPrototypeOf(n)===jc;function dd(n,s,o,c=!1){const l={},f=qc();n.propsDefaults=Object.create(null),Vc(n,s,l,f);for(const d in n.propsOptions[0])d in l||(l[d]=void 0);o?n.props=c?l:Pf(l):n.type.props?n.props=l:n.props=f,n.attrs=f}function gd(n,s,o,c){const{props:l,attrs:f,vnode:{patchFlag:d}}=n,p=ye(l),[y]=n.propsOptions;let O=!1;if((c||d>0)&&!(d&16)){if(d&8){const v=n.vnode.dynamicProps;for(let T=0;T<v.length;T++){let B=v[T];if(gi(n.emitsOptions,B))continue;const U=s[B];if(y)if(ge(f,B))U!==f[B]&&(f[B]=U,O=!0);else{const J=pt(B);l[J]=br(y,p,J,U,n,!1)}else U!==f[B]&&(f[B]=U,O=!0)}}}else{Vc(n,s,l,f)&&(O=!0);let v;for(const T in p)(!s||!ge(s,T)&&((v=Yt(T))===T||!ge(s,v)))&&(y?o&&(o[T]!==void 0||o[v]!==void 0)&&(l[T]=br(y,p,T,void 0,n,!0)):delete l[T]);if(f!==p)for(const T in f)(!s||!ge(s,T))&&(delete f[T],O=!0)}O&&xt(n.attrs,"set","")}function Vc(n,s,o,c){const[l,f]=n.propsOptions;let d=!1,p;if(s)for(let y in s){if(os(y))continue;const O=s[y];let v;l&&ge(l,v=pt(y))?!f||!f.includes(v)?o[v]=O:(p||(p={}))[v]=O:gi(n.emitsOptions,y)||(!(y in c)||O!==c[y])&&(c[y]=O,d=!0)}if(f){const y=ye(o),O=p||Ce;for(let v=0;v<f.length;v++){const T=f[v];o[T]=br(l,y,T,O[T],n,!ge(O,T))}}return d}function br(n,s,o,c,l,f){const d=n[o];if(d!=null){const p=ge(d,"default");if(p&&c===void 0){const y=d.default;if(d.type!==Function&&!d.skipFactory&&ie(y)){const{propsDefaults:O}=l;if(o in O)c=O[o];else{const v=Cs(l);c=O[o]=y.call(null,s),v()}}else c=y;l.ce&&l.ce._setProp(o,c)}d[0]&&(f&&!p?c=!1:d[1]&&(c===""||c===Yt(o))&&(c=!0))}return c}const pd=new WeakMap;function Wc(n,s,o=!1){const c=o?pd:s.propsCache,l=c.get(n);if(l)return l;const f=n.props,d={},p=[];let y=!1;if(!ie(n)){const v=T=>{y=!0;const[B,U]=Wc(T,s,!0);qe(d,B),U&&p.push(...U)};!o&&s.mixins.length&&s.mixins.forEach(v),n.extends&&v(n.extends),n.mixins&&n.mixins.forEach(v)}if(!f&&!y)return Re(n)&&c.set(n,Pn),Pn;if(X(f))for(let v=0;v<f.length;v++){const T=pt(f[v]);Sa(T)&&(d[T]=Ce)}else if(f)for(const v in f){const T=pt(v);if(Sa(T)){const B=f[v],U=d[T]=X(B)||ie(B)?{type:B}:qe({},B),J=U.type;let re=!1,Me=!0;if(X(J))for(let ce=0;ce<J.length;++ce){const pe=J[ce],fe=ie(pe)&&pe.name;if(fe==="Boolean"){re=!0;break}else fe==="String"&&(Me=!1)}else re=ie(J)&&J.name==="Boolean";U[0]=re,U[1]=Me,(re||ge(U,"default"))&&p.push(T)}}const O=[d,p];return Re(n)&&c.set(n,O),O}function Sa(n){return n[0]!=="$"&&!os(n)}const qr=n=>n[0]==="_"||n==="$stable",Fr=n=>X(n)?n.map(At):[At(n)],md=(n,s,o)=>{if(s._n)return s;const c=ps((...l)=>Fr(s(...l)),o);return c._c=!1,c},$c=(n,s,o)=>{const c=n._ctx;for(const l in n){if(qr(l))continue;const f=n[l];if(ie(f))s[l]=md(l,f,c);else if(f!=null){const d=Fr(f);s[l]=()=>d}}},Kc=(n,s)=>{const o=Fr(s);n.slots.default=()=>o},zc=(n,s,o)=>{for(const c in s)(o||!qr(c))&&(n[c]=s[c])},yd=(n,s,o)=>{const c=n.slots=qc();if(n.vnode.shapeFlag&32){const l=s._;l?(zc(c,s,o),o&&tc(c,"_",l,!0)):$c(s,c)}else s&&Kc(n,s)},bd=(n,s,o)=>{const{vnode:c,slots:l}=n;let f=!0,d=Ce;if(c.shapeFlag&32){const p=s._;p?o&&p===1?f=!1:zc(l,s,o):(f=!s.$stable,$c(s,l)),d=s}else s&&(Kc(n,s),d={default:1});if(f)for(const p in l)!qr(p)&&d[p]==null&&delete l[p]},ht=Id;function vd(n){return wd(n)}function wd(n,s){const o=li();o.__VUE__=!0;const{insert:c,remove:l,patchProp:f,createElement:d,createText:p,createComment:y,setText:O,setElementText:v,parentNode:T,nextSibling:B,setScopeId:U=Rt,insertStaticContent:J}=n,re=(b,w,M,N=null,x=null,L=null,j=void 0,H=null,D=!!w.dynamicChildren)=>{if(b===w)return;b&&!cn(b,w)&&(N=Zt(b),ke(b,x,L,!0),b=null),w.patchFlag===-2&&(D=!1,w.dynamicChildren=null);const{type:P,ref:z,shapeFlag:q}=w;switch(P){case pi:Me(b,w,M,N);break;case Ze:ce(b,w,M,N);break;case ir:b==null&&pe(w,M,N,j);break;case ze:W(b,w,M,N,x,L,j,H,D);break;default:q&1?me(b,w,M,N,x,L,j,H,D):q&6?ve(b,w,M,N,x,L,j,H,D):(q&64||q&128)&&P.process(b,w,M,N,x,L,j,H,D,Ht)}z!=null&&x&&Xs(z,b&&b.ref,L,w||b,!w)},Me=(b,w,M,N)=>{if(b==null)c(w.el=p(w.children),M,N);else{const x=w.el=b.el;w.children!==b.children&&O(x,w.children)}},ce=(b,w,M,N)=>{b==null?c(w.el=y(w.children||""),M,N):w.el=b.el},pe=(b,w,M,N)=>{[b.el,b.anchor]=J(b.children,w,M,N,b.el,b.anchor)},fe=({el:b,anchor:w},M,N)=>{let x;for(;b&&b!==w;)x=B(b),c(b,M,N),b=x;c(w,M,N)},_=({el:b,anchor:w})=>{let M;for(;b&&b!==w;)M=B(b),l(b),b=M;l(w)},me=(b,w,M,N,x,L,j,H,D)=>{w.type==="svg"?j="svg":w.type==="math"&&(j="mathml"),b==null?Pe(w,M,N,x,L,j,H,D):te(b,w,x,L,j,H,D)},Pe=(b,w,M,N,x,L,j,H)=>{let D,P;const{props:z,shapeFlag:q,transition:K,dirs:Z}=b;if(D=b.el=d(b.type,L,z&&z.is,z),q&8?v(D,b.children):q&16&&Fe(b.children,D,null,N,x,nr(b,L),j,H),Z&&nn(b,null,N,"created"),De(D,b,b.scopeId,j,N),z){for(const oe in z)oe!=="value"&&!os(oe)&&f(D,oe,null,z[oe],L,N);"value"in z&&f(D,"value",null,z.value,L),(P=z.onVnodeBeforeMount)&&St(P,N,b)}Z&&nn(b,null,N,"beforeMount");const ae=Cd(x,K);ae&&K.beforeEnter(D),c(D,w,M),((P=z&&z.onVnodeMounted)||ae||Z)&&ht(()=>{P&&St(P,N,b),ae&&K.enter(D),Z&&nn(b,null,N,"mounted")},x)},De=(b,w,M,N,x)=>{if(M&&U(b,M),N)for(let L=0;L<N.length;L++)U(b,N[L]);if(x){let L=x.subTree;if(w===L||el(L.type)&&(L.ssContent===w||L.ssFallback===w)){const j=x.vnode;De(b,j,j.scopeId,j.slotScopeIds,x.parent)}}},Fe=(b,w,M,N,x,L,j,H,D=0)=>{for(let P=D;P<b.length;P++){const z=b[P]=H?zt(b[P]):At(b[P]);re(null,z,w,M,N,x,L,j,H)}},te=(b,w,M,N,x,L,j)=>{const H=w.el=b.el;let{patchFlag:D,dynamicChildren:P,dirs:z}=w;D|=b.patchFlag&16;const q=b.props||Ce,K=w.props||Ce;let Z;if(M&&sn(M,!1),(Z=K.onVnodeBeforeUpdate)&&St(Z,M,w,b),z&&nn(w,b,M,"beforeUpdate"),M&&sn(M,!0),(q.innerHTML&&K.innerHTML==null||q.textContent&&K.textContent==null)&&v(H,""),P?de(b.dynamicChildren,P,H,M,N,nr(w,x),L):j||le(b,w,H,null,M,N,nr(w,x),L,!1),D>0){if(D&16)h(H,q,K,M,x);else if(D&2&&q.class!==K.class&&f(H,"class",null,K.class,x),D&4&&f(H,"style",q.style,K.style,x),D&8){const ae=w.dynamicProps;for(let oe=0;oe<ae.length;oe++){const se=ae[oe],Ae=q[se],Ue=K[se];(Ue!==Ae||se==="value")&&f(H,se,Ae,Ue,x,M)}}D&1&&b.children!==w.children&&v(H,w.children)}else!j&&P==null&&h(H,q,K,M,x);((Z=K.onVnodeUpdated)||z)&&ht(()=>{Z&&St(Z,M,w,b),z&&nn(w,b,M,"updated")},N)},de=(b,w,M,N,x,L,j)=>{for(let H=0;H<w.length;H++){const D=b[H],P=w[H],z=D.el&&(D.type===ze||!cn(D,P)||D.shapeFlag&198)?T(D.el):M;re(D,P,z,null,N,x,L,j,!0)}},h=(b,w,M,N,x)=>{if(w!==M){if(w!==Ce)for(const L in w)!os(L)&&!(L in M)&&f(b,L,w[L],null,x,N);for(const L in M){if(os(L))continue;const j=M[L],H=w[L];j!==H&&L!=="value"&&f(b,L,H,j,x,N)}"value"in M&&f(b,"value",w.value,M.value,x)}},W=(b,w,M,N,x,L,j,H,D)=>{const P=w.el=b?b.el:p(""),z=w.anchor=b?b.anchor:p("");let{patchFlag:q,dynamicChildren:K,slotScopeIds:Z}=w;Z&&(H=H?H.concat(Z):Z),b==null?(c(P,M,N),c(z,M,N),Fe(w.children||[],M,z,x,L,j,H,D)):q>0&&q&64&&K&&b.dynamicChildren?(de(b.dynamicChildren,K,M,x,L,j,H),(w.key!=null||x&&w===x.subTree)&&Jc(b,w,!0)):le(b,w,M,z,x,L,j,H,D)},ve=(b,w,M,N,x,L,j,H,D)=>{w.slotScopeIds=H,b==null?w.shapeFlag&512?x.ctx.activate(w,M,N,j,D):R(w,M,N,x,L,j,D):_e(b,w,D)},R=(b,w,M,N,x,L,j)=>{const H=b.component=Gd(b,N,x);if(fi(b)&&(H.ctx.renderer=Ht),qd(H,!1,j),H.asyncDep){if(x&&x.registerDep(H,Le,j),!b.el){const D=H.subTree=je(Ze);ce(null,D,w,M)}}else Le(H,b,w,M,x,L,j)},_e=(b,w,M)=>{const N=w.component=b.component;if(kd(b,w,M))if(N.asyncDep&&!N.asyncResolved){$(N,w,M);return}else N.next=w,N.update();else w.el=b.el,N.vnode=w},Le=(b,w,M,N,x,L,j)=>{const H=()=>{if(b.isMounted){let{next:q,bu:K,u:Z,parent:ae,vnode:oe}=b;{const at=Qc(b);if(at){q&&(q.el=oe.el,$(b,q,j)),at.asyncDep.then(()=>{b.isUnmounted||H()});return}}let se=q,Ae;sn(b,!1),q?(q.el=oe.el,$(b,q,j)):q=oe,K&&qs(K),(Ae=q.props&&q.props.onVnodeBeforeUpdate)&&St(Ae,ae,q,oe),sn(b,!0);const Ue=Aa(b),ot=b.subTree;b.subTree=Ue,re(ot,Ue,T(ot.el),Zt(ot),b,x,L),q.el=Ue.el,se===null&&Ed(b,Ue.el),Z&&ht(Z,x),(Ae=q.props&&q.props.onVnodeUpdated)&&ht(()=>St(Ae,ae,q,oe),x)}else{let q;const{el:K,props:Z}=w,{bm:ae,m:oe,parent:se,root:Ae,type:Ue}=b,ot=ls(w);sn(b,!1),ae&&qs(ae),!ot&&(q=Z&&Z.onVnodeBeforeMount)&&St(q,se,w),sn(b,!0);{Ae.ce&&Ae.ce._injectChildStyle(Ue);const at=b.subTree=Aa(b);re(null,at,M,N,b,x,L),w.el=at.el}if(oe&&ht(oe,x),!ot&&(q=Z&&Z.onVnodeMounted)){const at=w;ht(()=>St(q,se,at),x)}(w.shapeFlag&256||se&&ls(se.vnode)&&se.vnode.shapeFlag&256)&&b.a&&ht(b.a,x),b.isMounted=!0,w=M=N=null}};b.scope.on();const D=b.effect=new rc(H);b.scope.off();const P=b.update=D.run.bind(D),z=b.job=D.runIfDirty.bind(D);z.i=b,z.id=b.uid,D.scheduler=()=>jr(z),sn(b,!0),P()},$=(b,w,M)=>{w.component=b;const N=b.vnode.props;b.vnode=w,b.next=null,gd(b,w.props,N,M),bd(b,w.children,M),Ut(),ma(b),Bt()},le=(b,w,M,N,x,L,j,H,D=!1)=>{const P=b&&b.children,z=b?b.shapeFlag:0,q=w.children,{patchFlag:K,shapeFlag:Z}=w;if(K>0){if(K&128){mt(P,q,M,N,x,L,j,H,D);return}else if(K&256){wt(P,q,M,N,x,L,j,H,D);return}}Z&8?(z&16&&Xt(P,x,L),q!==P&&v(M,q)):z&16?Z&16?mt(P,q,M,N,x,L,j,H,D):Xt(P,x,L,!0):(z&8&&v(M,""),Z&16&&Fe(q,M,N,x,L,j,H,D))},wt=(b,w,M,N,x,L,j,H,D)=>{b=b||Pn,w=w||Pn;const P=b.length,z=w.length,q=Math.min(P,z);let K;for(K=0;K<q;K++){const Z=w[K]=D?zt(w[K]):At(w[K]);re(b[K],Z,M,null,x,L,j,H,D)}P>z?Xt(b,x,L,!0,!1,q):Fe(w,M,N,x,L,j,H,D,q)},mt=(b,w,M,N,x,L,j,H,D)=>{let P=0;const z=w.length;let q=b.length-1,K=z-1;for(;P<=q&&P<=K;){const Z=b[P],ae=w[P]=D?zt(w[P]):At(w[P]);if(cn(Z,ae))re(Z,ae,M,null,x,L,j,H,D);else break;P++}for(;P<=q&&P<=K;){const Z=b[q],ae=w[K]=D?zt(w[K]):At(w[K]);if(cn(Z,ae))re(Z,ae,M,null,x,L,j,H,D);else break;q--,K--}if(P>q){if(P<=K){const Z=K+1,ae=Z<z?w[Z].el:N;for(;P<=K;)re(null,w[P]=D?zt(w[P]):At(w[P]),M,ae,x,L,j,H,D),P++}}else if(P>K)for(;P<=q;)ke(b[P],x,L,!0),P++;else{const Z=P,ae=P,oe=new Map;for(P=ae;P<=K;P++){const He=w[P]=D?zt(w[P]):At(w[P]);He.key!=null&&oe.set(He.key,P)}let se,Ae=0;const Ue=K-ae+1;let ot=!1,at=0;const Gt=new Array(Ue);for(P=0;P<Ue;P++)Gt[P]=0;for(P=Z;P<=q;P++){const He=b[P];if(Ae>=Ue){ke(He,x,L,!0);continue}let ct;if(He.key!=null)ct=oe.get(He.key);else for(se=ae;se<=K;se++)if(Gt[se-ae]===0&&cn(He,w[se])){ct=se;break}ct===void 0?ke(He,x,L,!0):(Gt[ct-ae]=P+1,ct>=at?at=ct:ot=!0,re(He,w[ct],M,null,x,L,j,H,D),Ae++)}const dn=ot?_d(Gt):Pn;for(se=dn.length-1,P=Ue-1;P>=0;P--){const He=ae+P,ct=w[He],Bn=He+1<z?w[He+1].el:N;Gt[P]===0?re(null,ct,M,Bn,x,L,j,H,D):ot&&(se<0||P!==dn[se]?Tt(ct,M,Bn,2):se--)}}},Tt=(b,w,M,N,x=null)=>{const{el:L,type:j,transition:H,children:D,shapeFlag:P}=b;if(P&6){Tt(b.component.subTree,w,M,N);return}if(P&128){b.suspense.move(w,M,N);return}if(P&64){j.move(b,w,M,Ht);return}if(j===ze){c(L,w,M);for(let q=0;q<D.length;q++)Tt(D[q],w,M,N);c(b.anchor,w,M);return}if(j===ir){fe(b,w,M);return}if(N!==2&&P&1&&H)if(N===0)H.beforeEnter(L),c(L,w,M),ht(()=>H.enter(L),x);else{const{leave:q,delayLeave:K,afterLeave:Z}=H,ae=()=>{b.ctx.isUnmounted?l(L):c(L,w,M)},oe=()=>{q(L,()=>{ae(),Z&&Z()})};K?K(L,ae,oe):oe()}else c(L,w,M)},ke=(b,w,M,N=!1,x=!1)=>{const{type:L,props:j,ref:H,children:D,dynamicChildren:P,shapeFlag:z,patchFlag:q,dirs:K,cacheIndex:Z}=b;if(q===-2&&(x=!1),H!=null&&(Ut(),Xs(H,null,M,b,!0),Bt()),Z!=null&&(w.renderCache[Z]=void 0),z&256){w.ctx.deactivate(b);return}const ae=z&1&&K,oe=!ls(b);let se;if(oe&&(se=j&&j.onVnodeBeforeUnmount)&&St(se,w,b),z&6)yi(b.component,M,N);else{if(z&128){b.suspense.unmount(M,N);return}ae&&nn(b,null,w,"beforeUnmount"),z&64?b.type.remove(b,w,M,Ht,N):P&&!P.hasOnce&&(L!==ze||q>0&&q&64)?Xt(P,w,M,!1,!0):(L===ze&&q&384||!x&&z&16)&&Xt(D,w,M),N&&Ss(b)}(oe&&(se=j&&j.onVnodeUnmounted)||ae)&&ht(()=>{se&&St(se,w,b),ae&&nn(b,null,w,"unmounted")},M)},Ss=b=>{const{type:w,el:M,anchor:N,transition:x}=b;if(w===ze){Os(M,N);return}if(w===ir){_(b);return}const L=()=>{l(M),x&&!x.persisted&&x.afterLeave&&x.afterLeave()};if(b.shapeFlag&1&&x&&!x.persisted){const{leave:j,delayLeave:H}=x,D=()=>j(M,L);H?H(b.el,L,D):D()}else L()},Os=(b,w)=>{let M;for(;b!==w;)M=B(b),l(b),b=M;l(w)},yi=(b,w,M)=>{const{bum:N,scope:x,job:L,subTree:j,um:H,m:D,a:P,parent:z,slots:{__:q}}=b;Oa(D),Oa(P),N&&qs(N),z&&X(q)&&q.forEach(K=>{z.renderCache[K]=void 0}),x.stop(),L&&(L.flags|=8,ke(j,b,w,M)),H&&ht(H,w),ht(()=>{b.isUnmounted=!0},w),w&&w.pendingBranch&&!w.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===w.pendingId&&(w.deps--,w.deps===0&&w.resolve())},Xt=(b,w,M,N=!1,x=!1,L=0)=>{for(let j=L;j<b.length;j++)ke(b[j],w,M,N,x)},Zt=b=>{if(b.shapeFlag&6)return Zt(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const w=B(b.anchor||b.el),M=w&&w[jf];return M?B(M):w};let fn=!1;const Un=(b,w,M)=>{b==null?w._vnode&&ke(w._vnode,null,null,!0):re(w._vnode||null,b,w,null,null,null,M),w._vnode=b,fn||(fn=!0,ma(),Oc(),fn=!1)},Ht={p:re,um:ke,m:Tt,r:Ss,mt:R,mc:Fe,pc:le,pbc:de,n:Zt,o:n};return{render:Un,hydrate:void 0,createApp:hd(Un)}}function nr({type:n,props:s},o){return o==="svg"&&n==="foreignObject"||o==="mathml"&&n==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:o}function sn({effect:n,job:s},o){o?(n.flags|=32,s.flags|=4):(n.flags&=-33,s.flags&=-5)}function Cd(n,s){return(!n||n&&!n.pendingBranch)&&s&&!s.persisted}function Jc(n,s,o=!1){const c=n.children,l=s.children;if(X(c)&&X(l))for(let f=0;f<c.length;f++){const d=c[f];let p=l[f];p.shapeFlag&1&&!p.dynamicChildren&&((p.patchFlag<=0||p.patchFlag===32)&&(p=l[f]=zt(l[f]),p.el=d.el),!o&&p.patchFlag!==-2&&Jc(d,p)),p.type===pi&&(p.el=d.el),p.type===Ze&&!p.el&&(p.el=d.el)}}function _d(n){const s=n.slice(),o=[0];let c,l,f,d,p;const y=n.length;for(c=0;c<y;c++){const O=n[c];if(O!==0){if(l=o[o.length-1],n[l]<O){s[c]=l,o.push(c);continue}for(f=0,d=o.length-1;f<d;)p=f+d>>1,n[o[p]]<O?f=p+1:d=p;O<n[o[f]]&&(f>0&&(s[c]=o[f-1]),o[f]=c)}}for(f=o.length,d=o[f-1];f-- >0;)o[f]=d,d=s[d];return o}function Qc(n){const s=n.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:Qc(s)}function Oa(n){if(n)for(let s=0;s<n.length;s++)n[s].flags|=8}const Sd=Symbol.for("v-scx"),Od=()=>Fs(Sd);function sr(n,s,o){return Yc(n,s,o)}function Yc(n,s,o=Ce){const{immediate:c,deep:l,flush:f,once:d}=o,p=qe({},o),y=s&&c||!s&&f!=="post";let O;if(bs){if(f==="sync"){const U=Od();O=U.__watcherHandles||(U.__watcherHandles=[])}else if(!y){const U=()=>{};return U.stop=Rt,U.resume=Rt,U.pause=Rt,U}}const v=Ge;p.call=(U,J,re)=>vt(U,v,J,re);let T=!1;f==="post"?p.scheduler=U=>{ht(U,v&&v.suspense)}:f!=="sync"&&(T=!0,p.scheduler=(U,J)=>{J?U():jr(U)}),p.augmentJob=U=>{s&&(U.flags|=4),T&&(U.flags|=2,v&&(U.id=v.uid,U.i=v))};const B=Uf(n,s,p);return bs&&(O?O.push(B):y&&B()),B}function Ad(n,s,o){const c=this.proxy,l=xe(n)?n.includes(".")?Xc(c,n):()=>c[n]:n.bind(c,c);let f;ie(s)?f=s:(f=s.handler,o=s);const d=Cs(this),p=Yc(l,f.bind(c),o);return d(),p}function Xc(n,s){const o=s.split(".");return()=>{let c=n;for(let l=0;l<o.length&&c;l++)c=c[o[l]];return c}}const Rd=(n,s)=>s==="modelValue"||s==="model-value"?n.modelModifiers:n[`${s}Modifiers`]||n[`${pt(s)}Modifiers`]||n[`${Yt(s)}Modifiers`];function Td(n,s,...o){if(n.isUnmounted)return;const c=n.vnode.props||Ce;let l=o;const f=s.startsWith("update:"),d=f&&Rd(c,s.slice(7));d&&(d.trim&&(l=o.map(v=>xe(v)?v.trim():v)),d.number&&(l=o.map(lr)));let p,y=c[p=Ji(s)]||c[p=Ji(pt(s))];!y&&f&&(y=c[p=Ji(Yt(s))]),y&&vt(y,n,6,l);const O=c[p+"Once"];if(O){if(!n.emitted)n.emitted={};else if(n.emitted[p])return;n.emitted[p]=!0,vt(O,n,6,l)}}function Zc(n,s,o=!1){const c=s.emitsCache,l=c.get(n);if(l!==void 0)return l;const f=n.emits;let d={},p=!1;if(!ie(n)){const y=O=>{const v=Zc(O,s,!0);v&&(p=!0,qe(d,v))};!o&&s.mixins.length&&s.mixins.forEach(y),n.extends&&y(n.extends),n.mixins&&n.mixins.forEach(y)}return!f&&!p?(Re(n)&&c.set(n,null),null):(X(f)?f.forEach(y=>d[y]=null):qe(d,f),Re(n)&&c.set(n,d),d)}function gi(n,s){return!n||!ri(s)?!1:(s=s.slice(2).replace(/Once$/,""),ge(n,s[0].toLowerCase()+s.slice(1))||ge(n,Yt(s))||ge(n,s))}function Aa(n){const{type:s,vnode:o,proxy:c,withProxy:l,propsOptions:[f],slots:d,attrs:p,emit:y,render:O,renderCache:v,props:T,data:B,setupState:U,ctx:J,inheritAttrs:re}=n,Me=Ys(n);let ce,pe;try{if(o.shapeFlag&4){const _=l||c,me=_;ce=At(O.call(me,_,v,T,U,B,J)),pe=p}else{const _=s;ce=At(_.length>1?_(T,{attrs:p,slots:d,emit:y}):_(T,null)),pe=s.props?p:Md(p)}}catch(_){hs.length=0,hi(_,n,1),ce=je(Ze)}let fe=ce;if(pe&&re!==!1){const _=Object.keys(pe),{shapeFlag:me}=fe;_.length&&me&7&&(f&&_.some(Er)&&(pe=Pd(pe,f)),fe=Jt(fe,pe,!1,!0))}return o.dirs&&(fe=Jt(fe,null,!1,!0),fe.dirs=fe.dirs?fe.dirs.concat(o.dirs):o.dirs),o.transition&&ms(fe,o.transition),ce=fe,Ys(Me),ce}const Md=n=>{let s;for(const o in n)(o==="class"||o==="style"||ri(o))&&((s||(s={}))[o]=n[o]);return s},Pd=(n,s)=>{const o={};for(const c in n)(!Er(c)||!(c.slice(9)in s))&&(o[c]=n[c]);return o};function kd(n,s,o){const{props:c,children:l,component:f}=n,{props:d,children:p,patchFlag:y}=s,O=f.emitsOptions;if(s.dirs||s.transition)return!0;if(o&&y>=0){if(y&1024)return!0;if(y&16)return c?Ra(c,d,O):!!d;if(y&8){const v=s.dynamicProps;for(let T=0;T<v.length;T++){const B=v[T];if(d[B]!==c[B]&&!gi(O,B))return!0}}}else return(l||p)&&(!p||!p.$stable)?!0:c===d?!1:c?d?Ra(c,d,O):!0:!!d;return!1}function Ra(n,s,o){const c=Object.keys(s);if(c.length!==Object.keys(n).length)return!0;for(let l=0;l<c.length;l++){const f=c[l];if(s[f]!==n[f]&&!gi(o,f))return!0}return!1}function Ed({vnode:n,parent:s},o){for(;s;){const c=s.subTree;if(c.suspense&&c.suspense.activeBranch===n&&(c.el=n.el),c===n)(n=s.vnode).el=o,s=s.parent;else break}}const el=n=>n.__isSuspense;function Id(n,s){s&&s.pendingBranch?X(n)?s.effects.push(...n):s.effects.push(n):Gf(n)}const ze=Symbol.for("v-fgt"),pi=Symbol.for("v-txt"),Ze=Symbol.for("v-cmt"),ir=Symbol.for("v-stc"),hs=[];let ft=null;function he(n=!1){hs.push(ft=n?null:[])}function xd(){hs.pop(),ft=hs[hs.length-1]||null}let ys=1;function Ta(n,s=!1){ys+=n,n<0&&ft&&s&&(ft.hasOnce=!0)}function tl(n){return n.dynamicChildren=ys>0?ft||Pn:null,xd(),ys>0&&ft&&ft.push(n),n}function we(n,s,o,c,l,f){return tl(A(n,s,o,c,l,f,!0))}function ns(n,s,o,c,l){return tl(je(n,s,o,c,l,!0))}function ei(n){return n?n.__v_isVNode===!0:!1}function cn(n,s){return n.type===s.type&&n.key===s.key}const nl=({key:n})=>n??null,Vs=({ref:n,ref_key:s,ref_for:o})=>(typeof n=="number"&&(n=""+n),n!=null?xe(n)||et(n)||ie(n)?{i:rt,r:n,k:s,f:!!o}:n:null);function A(n,s=null,o=null,c=0,l=null,f=n===ze?0:1,d=!1,p=!1){const y={__v_isVNode:!0,__v_skip:!0,type:n,props:s,key:s&&nl(s),ref:s&&Vs(s),scopeId:Rc,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:f,patchFlag:c,dynamicProps:l,dynamicChildren:null,appContext:null,ctx:rt};return p?(Vr(y,o),f&128&&n.normalize(y)):o&&(y.shapeFlag|=xe(o)?8:16),ys>0&&!d&&ft&&(y.patchFlag>0||f&6)&&y.patchFlag!==32&&ft.push(y),y}const je=Ld;function Ld(n,s=null,o=null,c=0,l=null,f=!1){if((!n||n===nd)&&(n=Ze),ei(n)){const p=Jt(n,s,!0);return o&&Vr(p,o),ys>0&&!f&&ft&&(p.shapeFlag&6?ft[ft.indexOf(n)]=p:ft.push(p)),p.patchFlag=-2,p}if(Kd(n)&&(n=n.__vccOpts),s){s=Nd(s);let{class:p,style:y}=s;p&&!xe(p)&&(s.class=Je(p)),Re(y)&&(Gr(y)&&!X(y)&&(y=qe({},y)),s.style=Ln(y))}const d=xe(n)?1:el(n)?128:Tc(n)?64:Re(n)?4:ie(n)?2:0;return A(n,s,o,c,l,d,f,!0)}function Nd(n){return n?Gr(n)||Fc(n)?qe({},n):n:null}function Jt(n,s,o=!1,c=!1){const{props:l,ref:f,patchFlag:d,children:p,transition:y}=n,O=s?Bd(l||{},s):l,v={__v_isVNode:!0,__v_skip:!0,type:n.type,props:O,key:O&&nl(O),ref:s&&s.ref?o&&f?X(f)?f.concat(Vs(s)):[f,Vs(s)]:Vs(s):f,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:p,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:s&&n.type!==ze?d===-1?16:d|16:d,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:y,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Jt(n.ssContent),ssFallback:n.ssFallback&&Jt(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return y&&c&&ms(v,y.clone(v)),v}function Ud(n=" ",s=0){return je(pi,null,n,s)}function it(n="",s=!1){return s?(he(),ns(Ze,null,n)):je(Ze,null,n)}function At(n){return n==null||typeof n=="boolean"?je(Ze):X(n)?je(ze,null,n.slice()):ei(n)?zt(n):je(pi,null,String(n))}function zt(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Jt(n)}function Vr(n,s){let o=0;const{shapeFlag:c}=n;if(s==null)s=null;else if(X(s))o=16;else if(typeof s=="object")if(c&65){const l=s.default;l&&(l._c&&(l._d=!1),Vr(n,l()),l._c&&(l._d=!0));return}else{o=32;const l=s._;!l&&!Fc(s)?s._ctx=rt:l===3&&rt&&(rt.slots._===1?s._=1:(s._=2,n.patchFlag|=1024))}else ie(s)?(s={default:s,_ctx:rt},o=32):(s=String(s),c&64?(o=16,s=[Ud(s)]):o=8);n.children=s,n.shapeFlag|=o}function Bd(...n){const s={};for(let o=0;o<n.length;o++){const c=n[o];for(const l in c)if(l==="class")s.class!==c.class&&(s.class=Je([s.class,c.class]));else if(l==="style")s.style=Ln([s.style,c.style]);else if(ri(l)){const f=s[l],d=c[l];d&&f!==d&&!(X(f)&&f.includes(d))&&(s[l]=f?[].concat(f,d):d)}else l!==""&&(s[l]=c[l])}return s}function St(n,s,o,c=null){vt(n,s,7,[o,c])}const Dd=Gc();let Hd=0;function Gd(n,s,o){const c=n.type,l=(s?s.appContext:n.appContext)||Dd,f={uid:Hd++,vnode:n,type:c,parent:s,appContext:l,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new lf(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(l.provides),ids:s?s.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Wc(c,l),emitsOptions:Zc(c,l),emit:null,emitted:null,propsDefaults:Ce,inheritAttrs:c.inheritAttrs,ctx:Ce,data:Ce,props:Ce,attrs:Ce,slots:Ce,refs:Ce,setupState:Ce,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return f.ctx={_:f},f.root=s?s.root:f,f.emit=Td.bind(null,f),n.ce&&n.ce(f),f}let Ge=null;const jd=()=>Ge||rt;let ti,vr;{const n=li(),s=(o,c)=>{let l;return(l=n[o])||(l=n[o]=[]),l.push(c),f=>{l.length>1?l.forEach(d=>d(f)):l[0](f)}};ti=s("__VUE_INSTANCE_SETTERS__",o=>Ge=o),vr=s("__VUE_SSR_SETTERS__",o=>bs=o)}const Cs=n=>{const s=Ge;return ti(n),n.scope.on(),()=>{n.scope.off(),ti(s)}},Ma=()=>{Ge&&Ge.scope.off(),ti(null)};function sl(n){return n.vnode.shapeFlag&4}let bs=!1;function qd(n,s=!1,o=!1){s&&vr(s);const{props:c,children:l}=n.vnode,f=sl(n);dd(n,c,f,s),yd(n,l,o||s);const d=f?Fd(n,s):void 0;return s&&vr(!1),d}function Fd(n,s){const o=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,id);const{setup:c}=o;if(c){Ut();const l=n.setupContext=c.length>1?Wd(n):null,f=Cs(n),d=ws(c,n,0,[n.props,l]),p=Xa(d);if(Bt(),f(),(p||n.sp)&&!ls(n)&&xc(n),p){if(d.then(Ma,Ma),s)return d.then(y=>{Pa(n,y)}).catch(y=>{hi(y,n,0)});n.asyncDep=d}else Pa(n,d)}else il(n)}function Pa(n,s,o){ie(s)?n.type.__ssrInlineRender?n.ssrRender=s:n.render=s:Re(s)&&(n.setupState=Cc(s)),il(n)}function il(n,s,o){const c=n.type;n.render||(n.render=c.render||Rt);{const l=Cs(n);Ut();try{rd(n)}finally{Bt(),l()}}}const Vd={get(n,s){return Ke(n,"get",""),n[s]}};function Wd(n){const s=o=>{n.exposed=o||{}};return{attrs:new Proxy(n.attrs,Vd),slots:n.slots,emit:n.emit,expose:s}}function mi(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Cc(kf(n.exposed)),{get(s,o){if(o in s)return s[o];if(o in us)return us[o](n)},has(s,o){return o in s||o in us}})):n.proxy}function $d(n,s=!0){return ie(n)?n.displayName||n.name:n.name||s&&n.__name}function Kd(n){return ie(n)&&"__vccOpts"in n}const zd=(n,s)=>Lf(n,s,bs);function Jd(n,s,o){const c=arguments.length;return c===2?Re(s)&&!X(s)?ei(s)?je(n,null,[s]):je(n,s):je(n,null,s):(c>3?o=Array.prototype.slice.call(arguments,2):c===3&&ei(o)&&(o=[o]),je(n,s,o))}const Qd="3.5.15";/**
* @vue/runtime-dom v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let wr;const ka=typeof window<"u"&&window.trustedTypes;if(ka)try{wr=ka.createPolicy("vue",{createHTML:n=>n})}catch{}const rl=wr?n=>wr.createHTML(n):n=>n,Yd="http://www.w3.org/2000/svg",Xd="http://www.w3.org/1998/Math/MathML",It=typeof document<"u"?document:null,Ea=It&&It.createElement("template"),Zd={insert:(n,s,o)=>{s.insertBefore(n,o||null)},remove:n=>{const s=n.parentNode;s&&s.removeChild(n)},createElement:(n,s,o,c)=>{const l=s==="svg"?It.createElementNS(Yd,n):s==="mathml"?It.createElementNS(Xd,n):o?It.createElement(n,{is:o}):It.createElement(n);return n==="select"&&c&&c.multiple!=null&&l.setAttribute("multiple",c.multiple),l},createText:n=>It.createTextNode(n),createComment:n=>It.createComment(n),setText:(n,s)=>{n.nodeValue=s},setElementText:(n,s)=>{n.textContent=s},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>It.querySelector(n),setScopeId(n,s){n.setAttribute(s,"")},insertStaticContent(n,s,o,c,l,f){const d=o?o.previousSibling:s.lastChild;if(l&&(l===f||l.nextSibling))for(;s.insertBefore(l.cloneNode(!0),o),!(l===f||!(l=l.nextSibling)););else{Ea.innerHTML=rl(c==="svg"?`<svg>${n}</svg>`:c==="mathml"?`<math>${n}</math>`:n);const p=Ea.content;if(c==="svg"||c==="mathml"){const y=p.firstChild;for(;y.firstChild;)p.appendChild(y.firstChild);p.removeChild(y)}s.insertBefore(p,o)}return[d?d.nextSibling:s.firstChild,o?o.previousSibling:s.lastChild]}},Vt="transition",Zn="animation",vs=Symbol("_vtc"),ol={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},eg=qe({},Mc,ol),tg=n=>(n.displayName="Transition",n.props=eg,n),ni=tg((n,{slots:s})=>Jd(Vf,ng(n),s)),rn=(n,s=[])=>{X(n)?n.forEach(o=>o(...s)):n&&n(...s)},Ia=n=>n?X(n)?n.some(s=>s.length>1):n.length>1:!1;function ng(n){const s={};for(const W in n)W in ol||(s[W]=n[W]);if(n.css===!1)return s;const{name:o="v",type:c,duration:l,enterFromClass:f=`${o}-enter-from`,enterActiveClass:d=`${o}-enter-active`,enterToClass:p=`${o}-enter-to`,appearFromClass:y=f,appearActiveClass:O=d,appearToClass:v=p,leaveFromClass:T=`${o}-leave-from`,leaveActiveClass:B=`${o}-leave-active`,leaveToClass:U=`${o}-leave-to`}=n,J=sg(l),re=J&&J[0],Me=J&&J[1],{onBeforeEnter:ce,onEnter:pe,onEnterCancelled:fe,onLeave:_,onLeaveCancelled:me,onBeforeAppear:Pe=ce,onAppear:De=pe,onAppearCancelled:Fe=fe}=s,te=(W,ve,R,_e)=>{W._enterCancelled=_e,on(W,ve?v:p),on(W,ve?O:d),R&&R()},de=(W,ve)=>{W._isLeaving=!1,on(W,T),on(W,U),on(W,B),ve&&ve()},h=W=>(ve,R)=>{const _e=W?De:pe,Le=()=>te(ve,W,R);rn(_e,[ve,Le]),xa(()=>{on(ve,W?y:f),Et(ve,W?v:p),Ia(_e)||La(ve,c,re,Le)})};return qe(s,{onBeforeEnter(W){rn(ce,[W]),Et(W,f),Et(W,d)},onBeforeAppear(W){rn(Pe,[W]),Et(W,y),Et(W,O)},onEnter:h(!1),onAppear:h(!0),onLeave(W,ve){W._isLeaving=!0;const R=()=>de(W,ve);Et(W,T),W._enterCancelled?(Et(W,B),Ba()):(Ba(),Et(W,B)),xa(()=>{W._isLeaving&&(on(W,T),Et(W,U),Ia(_)||La(W,c,Me,R))}),rn(_,[W,R])},onEnterCancelled(W){te(W,!1,void 0,!0),rn(fe,[W])},onAppearCancelled(W){te(W,!0,void 0,!0),rn(Fe,[W])},onLeaveCancelled(W){de(W),rn(me,[W])}})}function sg(n){if(n==null)return null;if(Re(n))return[rr(n.enter),rr(n.leave)];{const s=rr(n);return[s,s]}}function rr(n){return tf(n)}function Et(n,s){s.split(/\s+/).forEach(o=>o&&n.classList.add(o)),(n[vs]||(n[vs]=new Set)).add(s)}function on(n,s){s.split(/\s+/).forEach(c=>c&&n.classList.remove(c));const o=n[vs];o&&(o.delete(s),o.size||(n[vs]=void 0))}function xa(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let ig=0;function La(n,s,o,c){const l=n._endId=++ig,f=()=>{l===n._endId&&c()};if(o!=null)return setTimeout(f,o);const{type:d,timeout:p,propCount:y}=rg(n,s);if(!d)return c();const O=d+"end";let v=0;const T=()=>{n.removeEventListener(O,B),f()},B=U=>{U.target===n&&++v>=y&&T()};setTimeout(()=>{v<y&&T()},p+1),n.addEventListener(O,B)}function rg(n,s){const o=window.getComputedStyle(n),c=J=>(o[J]||"").split(", "),l=c(`${Vt}Delay`),f=c(`${Vt}Duration`),d=Na(l,f),p=c(`${Zn}Delay`),y=c(`${Zn}Duration`),O=Na(p,y);let v=null,T=0,B=0;s===Vt?d>0&&(v=Vt,T=d,B=f.length):s===Zn?O>0&&(v=Zn,T=O,B=y.length):(T=Math.max(d,O),v=T>0?d>O?Vt:Zn:null,B=v?v===Vt?f.length:y.length:0);const U=v===Vt&&/\b(transform|all)(,|$)/.test(c(`${Vt}Property`).toString());return{type:v,timeout:T,propCount:B,hasTransform:U}}function Na(n,s){for(;n.length<s.length;)n=n.concat(n);return Math.max(...s.map((o,c)=>Ua(o)+Ua(n[c])))}function Ua(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Ba(){return document.body.offsetHeight}function og(n,s,o){const c=n[vs];c&&(s=(s?[s,...c]:[...c]).join(" ")),s==null?n.removeAttribute("class"):o?n.setAttribute("class",s):n.className=s}const si=Symbol("_vod"),al=Symbol("_vsh"),Mn={beforeMount(n,{value:s},{transition:o}){n[si]=n.style.display==="none"?"":n.style.display,o&&s?o.beforeEnter(n):es(n,s)},mounted(n,{value:s},{transition:o}){o&&s&&o.enter(n)},updated(n,{value:s,oldValue:o},{transition:c}){!s!=!o&&(c?s?(c.beforeEnter(n),es(n,!0),c.enter(n)):c.leave(n,()=>{es(n,!1)}):es(n,s))},beforeUnmount(n,{value:s}){es(n,s)}};function es(n,s){n.style.display=s?n[si]:"none",n[al]=!s}const ag=Symbol(""),cg=/(^|;)\s*display\s*:/;function lg(n,s,o){const c=n.style,l=xe(o);let f=!1;if(o&&!l){if(s)if(xe(s))for(const d of s.split(";")){const p=d.slice(0,d.indexOf(":")).trim();o[p]==null&&Ws(c,p,"")}else for(const d in s)o[d]==null&&Ws(c,d,"");for(const d in o)d==="display"&&(f=!0),Ws(c,d,o[d])}else if(l){if(s!==o){const d=c[ag];d&&(o+=";"+d),c.cssText=o,f=cg.test(o)}}else s&&n.removeAttribute("style");si in n&&(n[si]=f?c.display:"",n[al]&&(c.display="none"))}const Da=/\s*!important$/;function Ws(n,s,o){if(X(o))o.forEach(c=>Ws(n,s,c));else if(o==null&&(o=""),s.startsWith("--"))n.setProperty(s,o);else{const c=ug(n,s);Da.test(o)?n.setProperty(Yt(c),o.replace(Da,""),"important"):n[c]=o}}const Ha=["Webkit","Moz","ms"],or={};function ug(n,s){const o=or[s];if(o)return o;let c=pt(s);if(c!=="filter"&&c in n)return or[s]=c;c=ci(c);for(let l=0;l<Ha.length;l++){const f=Ha[l]+c;if(f in n)return or[s]=f}return s}const Ga="http://www.w3.org/1999/xlink";function ja(n,s,o,c,l,f=cf(s)){c&&s.startsWith("xlink:")?o==null?n.removeAttributeNS(Ga,s.slice(6,s.length)):n.setAttributeNS(Ga,s,o):o==null||f&&!nc(o)?n.removeAttribute(s):n.setAttribute(s,f?"":Qt(o)?String(o):o)}function qa(n,s,o,c,l){if(s==="innerHTML"||s==="textContent"){o!=null&&(n[s]=s==="innerHTML"?rl(o):o);return}const f=n.tagName;if(s==="value"&&f!=="PROGRESS"&&!f.includes("-")){const p=f==="OPTION"?n.getAttribute("value")||"":n.value,y=o==null?n.type==="checkbox"?"on":"":String(o);(p!==y||!("_value"in n))&&(n.value=y),o==null&&n.removeAttribute(s),n._value=o;return}let d=!1;if(o===""||o==null){const p=typeof n[s];p==="boolean"?o=nc(o):o==null&&p==="string"?(o="",d=!0):p==="number"&&(o=0,d=!0)}try{n[s]=o}catch{}d&&n.removeAttribute(l||s)}function An(n,s,o,c){n.addEventListener(s,o,c)}function hg(n,s,o,c){n.removeEventListener(s,o,c)}const Fa=Symbol("_vei");function fg(n,s,o,c,l=null){const f=n[Fa]||(n[Fa]={}),d=f[s];if(c&&d)d.value=c;else{const[p,y]=dg(s);if(c){const O=f[s]=mg(c,l);An(n,p,O,y)}else d&&(hg(n,p,d,y),f[s]=void 0)}}const Va=/(?:Once|Passive|Capture)$/;function dg(n){let s;if(Va.test(n)){s={};let c;for(;c=n.match(Va);)n=n.slice(0,n.length-c[0].length),s[c[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Yt(n.slice(2)),s]}let ar=0;const gg=Promise.resolve(),pg=()=>ar||(gg.then(()=>ar=0),ar=Date.now());function mg(n,s){const o=c=>{if(!c._vts)c._vts=Date.now();else if(c._vts<=o.attached)return;vt(yg(c,o.value),s,5,[c])};return o.value=n,o.attached=pg(),o}function yg(n,s){if(X(s)){const o=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{o.call(n),n._stopped=!0},s.map(c=>l=>!l._stopped&&c&&c(l))}else return s}const Wa=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,bg=(n,s,o,c,l,f)=>{const d=l==="svg";s==="class"?og(n,c,d):s==="style"?lg(n,o,c):ri(s)?Er(s)||fg(n,s,o,c,f):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):vg(n,s,c,d))?(qa(n,s,c),!n.tagName.includes("-")&&(s==="value"||s==="checked"||s==="selected")&&ja(n,s,c,d,f,s!=="value")):n._isVueCE&&(/[A-Z]/.test(s)||!xe(c))?qa(n,pt(s),c,f,s):(s==="true-value"?n._trueValue=c:s==="false-value"&&(n._falseValue=c),ja(n,s,c,d))};function vg(n,s,o,c){if(c)return!!(s==="innerHTML"||s==="textContent"||s in n&&Wa(s)&&ie(o));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="autocorrect"||s==="form"||s==="list"&&n.tagName==="INPUT"||s==="type"&&n.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const l=n.tagName;if(l==="IMG"||l==="VIDEO"||l==="CANVAS"||l==="SOURCE")return!1}return Wa(s)&&xe(o)?!1:s in n}const $a=n=>{const s=n.props["onUpdate:modelValue"]||!1;return X(s)?o=>qs(s,o):s};function wg(n){n.target.composing=!0}function Ka(n){const s=n.target;s.composing&&(s.composing=!1,s.dispatchEvent(new Event("input")))}const cr=Symbol("_assign"),Wr={created(n,{modifiers:{lazy:s,trim:o,number:c}},l){n[cr]=$a(l);const f=c||l.props&&l.props.type==="number";An(n,s?"change":"input",d=>{if(d.target.composing)return;let p=n.value;o&&(p=p.trim()),f&&(p=lr(p)),n[cr](p)}),o&&An(n,"change",()=>{n.value=n.value.trim()}),s||(An(n,"compositionstart",wg),An(n,"compositionend",Ka),An(n,"change",Ka))},mounted(n,{value:s}){n.value=s??""},beforeUpdate(n,{value:s,oldValue:o,modifiers:{lazy:c,trim:l,number:f}},d){if(n[cr]=$a(d),n.composing)return;const p=(f||n.type==="number")&&!/^0\d/.test(n.value)?lr(n.value):n.value,y=s??"";p!==y&&(document.activeElement===n&&n.type!=="range"&&(c&&s===o||l&&n.value.trim()===y)||(n.value=y))}},Cg=["ctrl","shift","alt","meta"],_g={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,s)=>Cg.some(o=>n[`${o}Key`]&&!s.includes(o))},za=(n,s)=>{const o=n._withMods||(n._withMods={}),c=s.join(".");return o[c]||(o[c]=(l,...f)=>{for(let d=0;d<s.length;d++){const p=_g[s[d]];if(p&&p(l,s))return}return n(l,...f)})},Sg={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ii=(n,s)=>{const o=n._withKeys||(n._withKeys={}),c=s.join(".");return o[c]||(o[c]=l=>{if(!("key"in l))return;const f=Yt(l.key);if(s.some(d=>d===f||Sg[d]===f))return n(l)})},Og=qe({patchProp:bg},Zd);let Ja;function Ag(){return Ja||(Ja=vd(Og))}const Rg=(...n)=>{const s=Ag().createApp(...n),{mount:o}=s;return s.mount=c=>{const l=Mg(c);if(!l)return;const f=s._component;!ie(f)&&!f.render&&!f.template&&(f.template=l.innerHTML),l.nodeType===1&&(l.textContent="");const d=o(l,!1,Tg(l));return l instanceof Element&&(l.removeAttribute("v-cloak"),l.setAttribute("data-v-app","")),d},s};function Tg(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function Mg(n){return xe(n)?document.querySelector(n):n}const _s=(n,s)=>{const o=n.__vccOpts||n;for(const[c,l]of s)o[c]=l;return o},Pg={props:["searchQuery","loggedInUsername","sessionId"],data(){return{posts:[],currentPage:1,loading:!1,hasMorePosts:!0,sortOption:"most-liked",postText:"",imagePreview:null,lastSentPostId:null}},computed:{filteredPosts(){return this.posts.filter(n=>(n.message||"").toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{getPostHeaderHtml(n){return`
        <div class="post-header">
          <div class="profile-picture" onclick="showUserProfile('${n.username.replace(/'/g,"\\'")}', '${n.profilePicture||"pfp2.jpg"}')">
            <img src="${n.profilePicture||"pfp2.jpg"}" alt="${n.username.replace(/'/g,"\\'")}'s profile picture" />
          </div>
          <div class="username">
            <strong>${n.username.replace(/'/g,"\\'")}</strong>
          </div>
        </div>
      `},getCommentHtml(n,s){const o=Array.isArray(s.replies)?s.replies:[],c=this.getTimeAgo(new Date(s.timestamp)),l=s.username||"Unknown",f=s.profilePicture||"https://latestnewsandaffairs.site/public/pfp3.jpg",d=o.length>0?o.map(p=>{const y=p.username||"Unknown",O=p.replyId||"";return O?`
          <div class="reply" id="reply-${O}">
            <div class="reply-profile">
              <img src="${p.profilePicture||"https://latestnewsandaffairs.site/public/pfp3.jpg"}" alt="${y}'s profile" />
            </div>
            <div class="reply-content">
              <div class="reply-header">
                <span class="reply-username">${y}</span>
                <span class="reply-timestamp">${this.getTimeAgo(new Date(p.timestamp))}</span>
              </div>
              <p class="reply-text">${p.reply||"No reply"}</p>
            </div>
            <button class="like-reply-btn" @click="likeReply('${n}', '${s.commentId}', '${O}')">
              ❤️ <span class="like-count">${p.hearts||0}</span>
            </button>
          </div>
        `:""}).join(""):"<p>No replies yet</p>";return`
    <div id="comment-${s.commentId}" class="comment-inner">
      <div class="comment-profile">
        <img src="${f}" alt="${l}'s profile" />
      </div>
      <div class="comment-content">
        <div class="comment-header">
          <span class="comment-username">${l}</span>
          <span class="comment-timestamp">${c}</span>
        </div>
        <div class="comment-text">${s.comment||"No comment"}</div>
        <div class="comment-actions">
          <button class="like-comment-btn">❤️ <span class="like-count">${s.hearts||0}</span></button>
          <button class="reply-btn">💬 ${o.length>0?`(${o.length})`:""}</button>
          ${s.username===this.loggedInUsername||this.sessionId===s.sessionId?`
            <button class="delete-comment-btn">🗑️ Delete</button>
          `:""}
        </div>
        <div class="replies" style="display: ${s.showReplies?"block":"none"};">
          ${d}
        </div>
      </div>
    </div>
  `},async fetchPosts(n=1,s="newest"){try{const o=await fetch(`https://sports321.vercel.app/api/posts?page=${n}&limit=16&sort=${s}`);if(!o.ok)throw new Error("Failed to load posts");return await o.json()}catch(o){return console.error("Error fetching posts:",o),{posts:[],hasMorePosts:!1}}},showLoading(){this.loading=!0},hideLoading(){this.loading=!1},async loadMorePosts(){if(this.loading||!this.hasMorePosts)return;this.showLoading();const n=await this.fetchPosts(this.currentPage,this.sortOption);n&&n.posts.length>0?(n.posts.forEach(s=>{s.showComments=!1,s.commentInput="",s.comments=s.comments||[],s.likes=s.likes||0,s.dislikes=s.dislikes||0,s.views=s.views||0,s.comments.forEach(o=>{o.showReplies=!1,o.replies=Array.isArray(o.replies)?o.replies:[]}),this.posts.push(s)}),this.currentPage++,this.hasMorePosts=n.hasMorePosts):this.hasMorePosts=!1,this.hideLoading()},sortPosts(n){this.sortOption=n,this.posts=[],this.currentPage=1,this.hasMorePosts=!0,this.loadMorePosts()},async postOpinion(){if(!this.sessionId||!this.loggedInUsername){this.showNotification("Error: Session ID and Username are required",!0);return}document.getElementById("submitBtn");const n=document.getElementById("file-input");let s=null;if(n.files.length>0){const o=n.files[0],c=new FileReader;c.onloadend=async()=>{try{s=await this.blobToBase64(await this.resizeImageToMaxSize(c.result,65)),await this.submitPost(this.postText.trim(),s)}catch{this.showNotification("Error processing image.",!0)}},c.readAsDataURL(o)}else await this.submitPost(this.postText.trim(),null)},async submitPost(n,s){if(!n&&!s){this.showNotification("Post content cannot be empty!",!0);return}const o=document.getElementById("submitBtn");o.classList.add("button-clicked");try{const c={message:n,username:this.loggedInUsername,sessionId:this.sessionId,photo:s},l=await fetch("https://sports321.vercel.app/api/postOpinion",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(c),credentials:"include"});if(!l.ok){this.showNotification("Error: Failed to submit post",!0);return}const f=await l.json();this.lastSentPostId=f._id,f.showComments=!1,f.commentInput="",f.comments=f.comments||[],f.likes=f.likes||0,f.dislikes=f.dislikes||0,f.views=f.views||0,f.comments.forEach(p=>{p.showReplies=!1,p.replies=Array.isArray(p.replies)?p.replies:[]}),this.posts.unshift(f),this.showNotification("Post submitted successfully!",!1),(await fetch("https://2damnit.vercel.app/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"send-push-notification"})})).ok||console.error("Error sending push notification.")}catch(c){this.showNotification("Error submitting post: "+c.message,!0)}finally{o.classList.remove("button-clicked"),this.resetForm()}},resetForm(){this.postText="",this.imagePreview=null;const n=document.getElementById("file-input");n&&(n.value="")},resizeImageToMaxSize(n,s=65){return new Promise((o,c)=>{const l=new Image;l.src=n,l.onload=()=>{const f=document.createElement("canvas"),d=f.getContext("2d"),y=200/l.width;f.width=l.width*y,f.height=l.height*y,d.drawImage(l,0,0,f.width,f.height),f.toBlob(O=>{O.size/1024<=s?o(O):c("Image exceeds max size after resizing.")},"image/webp",.4)},l.onerror=()=>c("Error loading image.")})},blobToBase64(n){return new Promise((s,o)=>{const c=new FileReader;c.onloadend=()=>s(c.result),c.onerror=o,c.readAsDataURL(n)})},handleImageUpload(n){const s=n.target.files[0];if(s){const o=new FileReader;o.onload=c=>{this.imagePreview=c.target.result},o.readAsDataURL(s)}},formatTimestamp(n){const s=new Date(n);if(isNaN(s))return console.error("Invalid timestamp",n),"Invalid Date";const o={day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"};return s.toLocaleString("en-GB",o)},getTimeAgo(n){const o=Math.floor((new Date-n)/1e3),c=Math.floor(o/(60*60*24*365)),l=Math.floor(o/(60*60*24)),f=Math.floor(o/(60*60)),d=Math.floor(o/60);return c>0?`${c} year${c>1?"s":""} ago`:l>0?`${l} day${l>1?"s":""} ago`:f>0?`${f} hour${f>1?"s":""} ago`:d>0?`${d} minute${d>1?"s":""} ago`:"Just now"},toggleComments(n){const s=this.posts.find(o=>o._id===n);s&&(s.showComments=!s.showComments)},closeComments(n){const s=this.posts.find(o=>o._id===n);s&&(s.showComments=!1)},addComment(n){const s=this.posts.find(o=>o._id===n);s&&s.commentInput.trim()&&(s.comments.push({commentId:`temp-${Date.now()}`,username:this.loggedInUsername,comment:s.commentInput,timestamp:new Date().toISOString(),hearts:0,replies:[],showReplies:!1}),s.commentInput="")},hoverComment(n){n.currentTarget.style.backgroundColor="#333",n.currentTarget.style.transform="scale(1.02)"},leaveComment(n){n.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)",n.currentTarget.style.transform="scale(1)"},showNotification(n,s){console.log(`${s?"Error":"Success"}: ${n}`)},likePost(n){const s=this.posts.find(o=>o._id===n);s&&s.likes++},dislikePost(n){const s=this.posts.find(o=>o._id===n);s&&s.dislikes++},editPost(n,s){console.log(`Editing post ${n} by ${s}`)},deletePost(n){console.log(`Deleting post ${n}`)},showUserProfile(n,s){window.location.href=`search2.html?username=${encodeURIComponent(n)}`},likeComment(n,s,o){console.log(`Liking comment ${s} on post ${n} by ${o}`)},toggleReplies(n,s,o){const c=this.posts.find(l=>l._id===n);if(c){const l=c.comments.find(f=>f.commentId===s);l&&(l.showReplies=!l.showReplies)}},likeReply(n,s,o){console.log(`Liking reply ${o} on comment ${s} in post ${n}`)},deleteComment(n,s){console.log(`Deleting comment ${s} on post ${n}`)}},created(){this.loadMorePosts();const n=document.createElement("style");n.textContent=`
      .post-header { padding: 5px 10px; display: flex; align-items: center; }
      .profile-picture { cursor: pointer; }
      .profile-picture img { width: 30px; height: 30px; border-radius: 50%; }
      .username { font-size: 14px; margin-left: 5px; }
      .username strong { color: #fff; }
      .comment { margin-bottom: 6px; background-color: rgba(255, 255, 255, 0.1); color: #fff; font-size: 12px; border-radius: 0; transition: background-color 0.3s ease, transform 0.2s ease; }
      .comment:hover { background-color: #333; transform: scale(1.02); }
      .comment-inner { display: flex; background-color: #000; padding: 10px 15px; margin: 0; width: 100%; border-radius: 0; }
      .comment-profile { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; margin-right: 12px; }
      .comment-profile img { width: 100%; height: 100%; object-fit: cover; }
      .comment-content { flex: 1; color: #fff; display: flex; flex-direction: column; }
      .comment-header { display: flex; justify-content: space-between; align-items: center; margin: 0; }
      .comment-username { font-weight: bold; font-size: 16px; margin: 0; }
      .comment-timestamp { font-size: 12px; color: #ccc; margin-left: auto; }
      .comment-text { font-size: 14px; color: #fff; margin-top: 5px; margin-left: 0; }
      .comment-actions { font-size: 12px; margin-top: 8px; display: flex; align-items: center; gap: 10px; }
      .like-comment-btn, .reply-btn, .delete-comment-btn { background: none; border: none; color: #fff; cursor: pointer; padding: 0; }
      .reply-btn { margin-left: 50px; font-size: 13px; }
      .delete-comment-btn { font-size: 12px; margin-left: 10px; }
      .replies { margin-top: 10px; }
      .reply { margin-left: 20px; display: flex; background-color: #222; padding: 10px 15px; border-radius: 8px; position: relative; }
      .reply-profile { width: 30px; height: 30px; border-radius: 50%; overflow: hidden; margin-right: 10px; }
      .reply-profile img { width: 100%; height: 100%; object-fit: cover; }
      .reply-content { flex: 1; color: #fff; font-size: 14px; }
      .reply-header { display: flex; justify-content: space-between; align-items: center; }
      .reply-username { font-weight: bold; }
      .reply-timestamp { font-size: 12px; color: #ccc; }
      .reply-text { margin-top: 5px; }
      .like-reply-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #fff; font-size: 12px; cursor: pointer; padding: 0; }
      .comments-section { padding: 0; background: #000; border-radius: 0; font-size: 14px; margin-bottom: 20px; }
      .comments-list { padding: 0; background-color: #000; font-size: 14px; margin: 0; width: 100%; height: auto; overflow-y: auto; }
      .comment-input-container { position: absolute; bottom: 20px; left: 0; width: 100%; padding: 10px 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
      .comment-input { width: 80%; padding: 10px 15px; border-radius: 25px; border: 1px solid #444; background-color: #333; color: #fff; font-size: 14px; transition: all 0.3s ease; box-sizing: border-box; outline: none; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
      .comment-input-container button { background-color: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 25px; transition: background-color 0.3s ease; cursor: pointer; font-size: 14px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
      .close-comments-btn { position: absolute; top: 10px; right: 10px; background-color: #ff4c4c; color: white; border: none; padding: 5px 10px; border-radius: 20px; cursor: pointer; }
    `,document.head.appendChild(n)},mounted(){window.addEventListener("scroll",this.handleScroll)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll)},handleScroll(){window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&!this.loading&&this.hasMorePosts&&this.loadMorePosts()}},kg={class:"posts-section"},Eg={id:"sort-options",style:{gap:"15%"}},Ig=["data-id"],xg=["innerHTML"],Lg={class:"post-message"},Ng=["src","onClick"],Ug={class:"post-timestamp"},Bg={class:"actions"},Dg=["onClick"],Hg=["onClick"],Gg=["onClick"],jg={class:"view-btn"},qg=["onClick"],Fg=["onClick"],Vg=["id"],Wg={class:"comments-list"},$g=["innerHTML"],Kg={class:"comment-input-container"},zg=["id","onUpdate:modelValue","onKeyup"],Jg=["onClick"],Qg=["onClick"],Yg={key:0,id:"loading",class:"loading"};function Xg(n,s,o,c,l,f){return he(),we("section",kg,[A("div",Eg,[A("button",{class:Je(["sort-button",{active:l.sortOption==="most-liked"}]),onClick:s[0]||(s[0]=d=>f.sortPosts("most-liked"))},"𝓖𝓮𝓷𝓮𝓻𝓪𝓵",2),A("button",{class:Je(["sort-button",{active:l.sortOption==="most-comments"}]),onClick:s[1]||(s[1]=d=>f.sortPosts("most-comments"))},"𝓣𝓻𝓮𝓷𝓭𝓲𝓷𝓰",2),A("button",{class:Je(["sort-button",{active:l.sortOption==="newest"}]),onClick:s[2]||(s[2]=d=>f.sortPosts("newest"))},"𝓝𝓮𝔀𝓮𝓼𝓽",2)]),(he(!0),we(ze,null,Nn(f.filteredPosts,d=>(he(),we("div",{key:d._id,class:"post-card hover-scale","data-id":d._id},[A("div",{innerHTML:f.getPostHeaderHtml(d)},null,8,xg),A("p",Lg,Te(d.message||""),1),d.photo?(he(),we("img",{key:0,src:d.photo,alt:"Post Image",class:"post-image",onClick:p=>n.openFullScreen(d.photo)},null,8,Ng)):it("",!0),A("div",Ug,[A("small",null,Te(f.formatTimestamp(d.timestamp)),1)]),A("div",Bg,[A("button",{onClick:p=>f.likePost(d._id),class:"like-btn"},[s[5]||(s[5]=A("span",null,"👍",-1)),A("span",null,Te(d.likes),1)],8,Dg),A("button",{onClick:p=>f.dislikePost(d._id),class:"dislike-btn"},[s[6]||(s[6]=A("span",null,"👎",-1)),A("span",null,Te(d.dislikes),1)],8,Hg),A("button",{onClick:p=>f.toggleComments(d._id),class:"comment-btn"},[s[7]||(s[7]=A("span",null,"💬",-1)),A("span",null,Te(d.comments.length),1)],8,Gg),A("button",jg,[s[8]||(s[8]=A("span",null,"💫",-1)),A("span",null,Te(d.views),1)]),d.username===o.loggedInUsername||d.sessionId===o.sessionId?(he(),we("button",{key:0,onClick:p=>f.editPost(d._id,d.username)}," Edit ",8,qg)):it("",!0),d.username===o.loggedInUsername||d.sessionId===o.sessionId?(he(),we("button",{key:1,onClick:p=>f.deletePost(d._id)}," Delete ",8,Fg)):it("",!0)]),je(ni,{name:"fade"},{default:ps(()=>[d.showComments?(he(),we("div",{key:0,class:"comments",id:`comments-${d._id}`},[A("div",Wg,[(he(!0),we(ze,null,Nn(d.comments,p=>(he(),we("div",{key:p.commentId,class:"comment",innerHTML:f.getCommentHtml(d._id,p),onMouseenter:s[3]||(s[3]=(...y)=>f.hoverComment&&f.hoverComment(...y)),onMouseleave:s[4]||(s[4]=(...y)=>f.leaveComment&&f.leaveComment(...y))},null,40,$g))),128))]),A("div",Kg,[Nt(A("input",{id:`commentInput-${d._id}`,"onUpdate:modelValue":p=>d.commentInput=p,placeholder:"Add a comment...",class:"comment-input",onKeyup:ii(p=>f.addComment(d._id),["enter"])},null,40,zg),[[Wr,d.commentInput]]),A("button",{onClick:p=>f.addComment(d._id)},"Post",8,Jg)]),A("button",{onClick:p=>f.closeComments(d._id),class:"close-comments-btn"}," Close ",8,Qg)],8,Vg)):it("",!0)]),_:2},1024)],8,Ig))),128)),l.loading?(he(),we("div",Yg,s[9]||(s[9]=[A("div",{class:"spinner"},null,-1)]))):it("",!0)])}const Zg=_s(Pg,[["render",Xg]]),ep={props:["searchQuery"],data(){return{videos:[{id:1,title:"Cool Video",description:"A cool video description",thumbnail:"https://via.placeholder.com/300x200",url:"https://www.w3schools.com/html/mov_bbb.mp4"}],showVideoModal:!1,selectedVideo:{}}},computed:{filteredVideos(){return this.videos.filter(n=>n.title.toLowerCase().includes(this.searchQuery.toLowerCase())||n.description.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{openVideoModal(n){this.selectedVideo=n,this.showVideoModal=!0}}},tp={class:"videos-section"},np=["onClick"],sp=["src"],ip={class:"content"},rp={key:0,class:"video-modal"},op={class:"modal-content"},ap={controls:""},cp=["src"];function lp(n,s,o,c,l,f){return he(),we("section",tp,[(he(!0),we(ze,null,Nn(f.filteredVideos,d=>(he(),we("div",{key:d.id,class:"video-card hover-scale",onClick:p=>f.openVideoModal(d)},[A("img",{src:d.thumbnail,alt:"Video Thumbnail"},null,8,sp),A("div",ip,[A("h3",null,Te(d.title),1),A("p",null,Te(d.description),1)])],8,np))),128)),je(ni,{name:"fade"},{default:ps(()=>[l.showVideoModal?(he(),we("div",rp,[A("div",op,[A("h2",null,Te(l.selectedVideo.title),1),A("video",ap,[A("source",{src:l.selectedVideo.url,type:"video/mp4"},null,8,cp)]),A("button",{onClick:s[0]||(s[0]=d=>l.showVideoModal=!1)},"Close")])])):it("",!0)]),_:1})])}const up=_s(ep,[["render",lp]]);var Wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$s={exports:{}};/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

Ably JavaScript Library v2.9.0
https://github.com/ably/ably-js

Released under the Apache Licence v2.0*/var hp=$s.exports,Qa;function fp(){return Qa||(Qa=1,function(n,s){(function(o,c){n.exports=c()})(hp,()=>{var o={},c={exports:o},l=Object.defineProperty,f=Object.defineProperties,d=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertyNames,O=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,B=(e,t,i)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,U=(e,t)=>{for(var i in t||(t={}))v.call(t,i)&&B(e,i,t[i]);if(O)for(var i of O(t))T.call(t,i)&&B(e,i,t[i]);return e},J=(e,t)=>f(e,p(t)),re=(e,t)=>{var i={};for(var r in e)v.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&O)for(var r of O(e))t.indexOf(r)<0&&T.call(e,r)&&(i[r]=e[r]);return i},Me=(e,t)=>{for(var i in t)l(e,i,{get:t[i],enumerable:!0})},ce=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of y(t))!v.call(e,a)&&a!==i&&l(e,a,{get:()=>t[a],enumerable:!(r=d(t,a))||r.enumerable});return e},pe=e=>ce(l({},"__esModule",{value:!0}),e),fe={};Me(fe,{ErrorInfo:()=>R,Realtime:()=>Hi,Rest:()=>xi,default:()=>zh,makeProtocolMessageFromDeserialized:()=>Go,msgpack:()=>Ki}),c.exports=pe(fe);var _=class{},me=typeof Wt<"u"?Wt:typeof window<"u"?window:self;function Pe(e,t){return`${e}`.padStart(t?3:2,"0")}function De(e){return _.Config.logTimestamps?function(t){const i=new Date;e(Pe(i.getHours())+":"+Pe(i.getMinutes())+":"+Pe(i.getSeconds())+"."+Pe(i.getMilliseconds(),1)+" "+t)}:function(t){e(t)}}var Fe=()=>{var e;let t,i;return typeof((e=me==null?void 0:me.console)==null?void 0:e.log)=="function"?(t=function(...r){console.log.apply(console,r)},i=console.warn?function(...r){console.warn.apply(console,r)}:t):t=i=function(){},[t,i].map(De)},te=class ss{constructor(){this.deprecated=(t,i)=>{this.deprecationWarning(`${t} is deprecated and will be removed in a future version. ${i}`)},this.shouldLog=t=>t<=this.logLevel,this.setLog=(t,i)=>{t!==void 0&&(this.logLevel=t),i!==void 0&&(this.logHandler=this.logErrorHandler=i)},this.logLevel=ss.defaultLogLevel,this.logHandler=ss.defaultLogHandler,this.logErrorHandler=ss.defaultLogErrorHandler}static initLogHandlers(){const[t,i]=Fe();this.defaultLogHandler=t,this.defaultLogErrorHandler=i,this.defaultLogger=new ss}static logActionNoStrip(t,i,r,a){t.logAction(i,r,a)}logAction(t,i,r){this.shouldLog(t)&&(t===1?this.logErrorHandler:this.logHandler)("Ably: "+i+": "+r,t)}renamedClientOption(t,i){this.deprecationWarning(`The \`${t}\` client option has been renamed to \`${i}\`. Please update your code to use \`${i}\` instead. \`${t}\` will be removed in a future version.`)}renamedMethod(t,i,r){this.deprecationWarning(`\`${t}\`’s \`${i}\` method has been renamed to \`${r}\`. Please update your code to use \`${r}\` instead. \`${i}\` will be removed in a future version.`)}deprecationWarning(t){this.shouldLog(1)&&this.logErrorHandler(`Ably: Deprecation warning - ${t}`,1)}};te.defaultLogLevel=1,te.LOG_NONE=0,te.LOG_ERROR=1,te.LOG_MAJOR=2,te.LOG_MINOR=3,te.LOG_MICRO=4,te.logAction=(e,t,i,r)=>{te.logActionNoStrip(e,t,i,r)};var de=te,h=de,W={};Me(W,{Format:()=>x,allSame:()=>N,allToLowerCase:()=>Ue,allToUpperCase:()=>ot,arrChooseN:()=>ae,arrDeleteValue:()=>Ht,arrEquals:()=>Kr,arrIntersect:()=>fn,arrIntersectOb:()=>Un,arrPopRandomElement:()=>L,arrWithoutValue:()=>$r,cheapRandStr:()=>K,containsValue:()=>Xt,copy:()=>le,createMissingPluginError:()=>Rs,dataSizeBytes:()=>q,decodeBody:()=>se,encodeBody:()=>Ae,ensureArray:()=>wt,forInOwnNonNullProperties:()=>M,getBackoffCoefficient:()=>at,getGlobalObject:()=>He,getJitterCoefficient:()=>Gt,getRetryTime:()=>dn,inherits:()=>yi,inspectBody:()=>z,inspectError:()=>P,intersect:()=>Zt,isEmpty:()=>Tt,isErrorInfoOrPartialErrorInfo:()=>D,isNil:()=>ke,isObject:()=>mt,keysArray:()=>b,matchDerivedChannel:()=>Bn,mixin:()=>$,parseQueryString:()=>H,prototypicalClone:()=>Os,randomString:()=>Z,shallowClone:()=>Ss,shallowEquals:()=>ct,throwMissingPluginError:()=>Ve,toBase64:()=>As,toQueryString:()=>j,valuesArray:()=>w,whenPromiseSettles:()=>oe,withTimeoutAsync:()=>zr});function ve(e){let t="["+e.constructor.name;return e.message&&(t+=": "+e.message),e.statusCode&&(t+="; statusCode="+e.statusCode),e.code&&(t+="; code="+e.code),e.cause&&(t+="; cause="+P(e.cause)),e.href&&!(e.message&&e.message.indexOf("help.ably.io")>-1)&&(t+="; see "+e.href+" "),t+="]",t}var R=class Cr extends Error{constructor(t,i,r,a){super(t),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,Cr.prototype),this.code=i,this.statusCode=r,this.cause=a}toString(){return ve(this)}static fromValues(t){const{message:i,code:r,statusCode:a}=t;if(typeof i!="string"||typeof r!="number"||typeof a!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+_.Config.inspect(t));const u=Object.assign(new Cr(i,r,a),t);return u.code&&!u.href&&(u.href="https://help.ably.io/error/"+u.code),u}},_e=class _r extends Error{constructor(t,i,r,a){super(t),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,_r.prototype),this.code=i,this.statusCode=r,this.cause=a}toString(){return ve(this)}static fromValues(t){const{message:i,code:r,statusCode:a}=t;if(typeof i!="string"||!ke(r)&&typeof r!="number"||!ke(a)&&typeof a!="number")throw new Error("PartialErrorInfo.fromValues(): invalid values: "+_.Config.inspect(t));const u=Object.assign(new _r(i,r,a),t);return u.code&&!u.href&&(u.href="https://help.ably.io/error/"+u.code),u}};function Le(e){return Math.floor(Math.random()*e.length)}function $(e,...t){for(let i=0;i<t.length;i++){const r=t[i];if(!r)break;for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}function le(e){return $({},e)}function wt(e){return ke(e)?[]:Array.isArray(e)?e:[e]}function mt(e){return Object.prototype.toString.call(e)=="[object Object]"}function Tt(e){for(const t in e)return!1;return!0}function ke(e){return e==null}function Ss(e){const t=new Object;for(const i in e)t[i]=e[i];return t}function Os(e,t){class i{}i.prototype=e;const r=new i;return t&&$(r,t),r}var yi=function(e,t){if(_.Config.inherits){_.Config.inherits(e,t);return}e.super_=t,e.prototype=Os(t.prototype,{constructor:e})};function Xt(e,t){for(const i in e)if(e[i]==t)return!0;return!1}function Zt(e,t){return Array.isArray(t)?fn(e,t):Un(e,t)}function fn(e,t){const i=[];for(let r=0;r<e.length;r++){const a=e[r];t.indexOf(a)!=-1&&i.push(a)}return i}function Un(e,t){const i=[];for(let r=0;r<e.length;r++){const a=e[r];a in t&&i.push(a)}return i}function Ht(e,t){const i=e.indexOf(t),r=i!=-1;return r&&e.splice(i,1),r}function $r(e,t){const i=e.slice();return Ht(i,t),i}function b(e,t){const i=[];for(const r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||i.push(r);return i}function w(e,t){const i=[];for(const r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||i.push(e[r]);return i}function M(e,t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&e[i]&&t(i)}function N(e,t){if(e.length===0)return!0;const i=e[0][t];return e.every(function(r){return r[t]===i})}var x=(e=>(e.msgpack="msgpack",e.json="json",e))(x||{});function L(e){return e.splice(Le(e),1)[0]}function j(e){const t=[];if(e)for(const i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.length?"?"+t.join("&"):""}function H(e){let t;const i=/([^?&=]+)=?([^&]*)/g,r={};for(;t=i.exec(e);)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r}function D(e){return typeof e=="object"&&e!==null&&(e instanceof R||e instanceof _e)}function P(e){var t,i;return e instanceof Error||((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="ErrorInfo"||((i=e==null?void 0:e.constructor)==null?void 0:i.name)==="PartialErrorInfo"?e.toString():_.Config.inspect(e)}function z(e){return _.BufferUtils.isBuffer(e)?e.toString():typeof e=="string"?e:_.Config.inspect(e)}function q(e){if(_.BufferUtils.isBuffer(e))return _.BufferUtils.byteLength(e);if(typeof e=="string")return _.Config.stringByteSize(e);if(typeof e=="number")return 8;if(typeof e=="boolean")return 1;throw new Error(`Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: ${typeof e}`)}function K(){return String(Math.random()).substr(2)}var Z=async e=>{const t=await _.Config.getRandomArrayBuffer(e);return _.BufferUtils.base64Encode(t)};function ae(e,t){const i=Math.min(t,e.length),r=e.slice(),a=[];for(let u=0;u<i;u++)a.push(L(r));return a}function oe(e,t){e.then(i=>{t==null||t(null,i)}).catch(i=>{t==null||t(i)})}function se(e,t,i){return i=="msgpack"?(t||Ve("MsgPack"),t.decode(e)):JSON.parse(String(e))}function Ae(e,t,i){return i=="msgpack"?(t||Ve("MsgPack"),t.encode(e,!0)):JSON.stringify(e)}function Ue(e){return e.map(function(t){return t&&t.toLowerCase()})}function ot(e){return e.map(function(t){return t&&t.toUpperCase()})}function at(e){return Math.min((e+2)/3,2)}function Gt(){return 1-Math.random()*.2}function dn(e,t){return e*at(t)*Gt()}function He(){return typeof Wt<"u"?Wt:typeof window<"u"?window:self}function ct(e,t){return Object.keys(e).every(i=>e[i]===t[i])&&Object.keys(t).every(i=>t[i]===e[i])}function Bn(e){const t=/^(\[([^?]*)(?:(.*))\])?(.+)$/,i=e.match(t);if(!i||!i.length||i.length<5)throw new R("regex match failed",400,40010);if(i[2])throw new R(`cannot use a derived option with a ${i[2]} channel`,400,40010);return{qualifierParam:i[3]||"",channelName:i[4]}}function As(e){const t=_.BufferUtils,i=t.utf8Encode(e);return t.base64Encode(i)}function Kr(e,t){return e.length===t.length&&e.every(function(i,r){return i===t[r]})}function Rs(e){return new R(`${e} plugin not provided`,40019,400)}function Ve(e){throw Rs(e)}async function zr(e,t=5e3,i="Timeout expired"){const r=new R(i,5e4,500);return Promise.race([e,new Promise((a,u)=>setTimeout(()=>u(r),t))])}var Jr="2.9.0",gl="ably-js/"+Jr,We={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:Jr,protocolVersion:3,agent:gl,getHost:Qr,getPort:pl,getHttpScheme:ml,environmentFallbackHosts:Yr,getFallbackHosts:Xr,getHosts:yl,checkHost:Zr,objectifyOptions:wl,normaliseOptions:Cl,defaultGetHeaders:_l,defaultPostHeaders:Sl};function Qr(e,t,i){return i?t=t==e.restHost&&e.realtimeHost||t||e.realtimeHost:t=t||e.restHost,t}function pl(e,t){return t||e.tls?e.tlsPort:e.port}function ml(e){return e.tls?"https://":"http://"}function Yr(e){return[e+"-a-fallback.ably-realtime.com",e+"-b-fallback.ably-realtime.com",e+"-c-fallback.ably-realtime.com",e+"-d-fallback.ably-realtime.com",e+"-e-fallback.ably-realtime.com"]}function Xr(e){const t=e.fallbackHosts,i=typeof e.httpMaxRetryCount<"u"?e.httpMaxRetryCount:We.httpMaxRetryCount;return t?ae(t,i):[]}function yl(e,t){const i=[e.restHost].concat(Xr(e));return t?i.map(r=>Qr(e,r,!0)):i}function Zr(e){if(typeof e!="string")throw new R("host must be a string; was a "+typeof e,4e4,400);if(!e.length)throw new R("host must not be zero-length",4e4,400)}function bl(e,t,i,r){return e.realtimeHost?e.realtimeHost:e.restHost?(h.logAction(r,h.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+e.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+e.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),e.restHost):t?We.REALTIME_HOST:i+"-"+We.REALTIME_HOST}function vl(e){const t={};for(const i in We.TIMEOUTS)t[i]=e[i]||We.TIMEOUTS[i];return t}function bi(e){let t=We.agent;if(e.agents)for(var i in e.agents)t+=" "+i+"/"+e.agents[i];return t}function wl(e,t,i,r,a){if(e===void 0){const g=t?`${i} must be initialized with either a client options object, an Ably API key, or an Ably Token`:`${i} must be initialized with a client options object`;throw h.logAction(r,h.LOG_ERROR,`${i}()`,g),new Error(g)}let u;if(typeof e=="string")if(e.indexOf(":")==-1){if(!t){const g=`${i} cannot be initialized with just an Ably Token; you must provide a client options object with a \`plugins\` property. (Set this Ably Token as the object’s \`token\` property.)`;throw h.logAction(r,h.LOG_ERROR,`${i}()`,g),new Error(g)}u={token:e}}else{if(!t){const g=`${i} cannot be initialized with just an Ably API key; you must provide a client options object with a \`plugins\` property. (Set this Ably API key as the object’s \`key\` property.)`;throw h.logAction(r,h.LOG_ERROR,`${i}()`,g),new Error(g)}u={key:e}}else u=e;return a&&(u=J(U({},u),{plugins:U(U({},a),u.plugins)})),u}function Cl(e,t,i){const r=i??h.defaultLogger;typeof e.recover=="function"&&e.closeOnUnload===!0&&(h.logAction(r,h.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),e.recover=void 0),"closeOnUnload"in e||(e.closeOnUnload=!e.recover),"queueMessages"in e||(e.queueMessages=!0);const a=e.environment&&String(e.environment).toLowerCase()||We.ENVIRONMENT,u=!a||a==="production";!e.fallbackHosts&&!e.restHost&&!e.realtimeHost&&!e.port&&!e.tlsPort&&(e.fallbackHosts=u?We.FALLBACK_HOSTS:Yr(a));const g=e.restHost||(u?We.REST_HOST:a+"-"+We.REST_HOST),m=bl(e,u,a,r);(e.fallbackHosts||[]).concat(g,m).forEach(Zr),e.port=e.port||We.PORT,e.tlsPort=e.tlsPort||We.TLS_PORT,"tls"in e||(e.tls=!0);const S=vl(e);t?"useBinaryProtocol"in e?e.useBinaryProtocol=_.Config.supportsBinary&&e.useBinaryProtocol:e.useBinaryProtocol=_.Config.preferBinary:e.useBinaryProtocol=!1;const C={};e.clientId&&(C["X-Ably-ClientId"]=_.BufferUtils.base64Encode(_.BufferUtils.utf8Encode(e.clientId))),"idempotentRestPublishing"in e||(e.idempotentRestPublishing=!0);let I=null,E=e.connectivityCheckUrl;if(e.connectivityCheckUrl){let[k,F]=e.connectivityCheckUrl.split("?");I=F?H(F):{},k.indexOf("://")===-1&&(k="https://"+k),E=k}let G=e.wsConnectivityCheckUrl;return G&&G.indexOf("://")===-1&&(G="wss://"+G),J(U({},e),{realtimeHost:m,restHost:g,maxMessageSize:e.maxMessageSize||We.maxMessageSize,timeouts:S,connectivityCheckParams:I,connectivityCheckUrl:E,wsConnectivityCheckUrl:G,headers:C})}function Ts(e,t,i){const r=i||{};if(r.cipher){e||Ve("Crypto");const a=e.getCipher(r.cipher,t);r.cipher=a.cipherParams,r.channelCipher=a.cipher}else"cipher"in r&&(r.cipher=void 0,r.channelCipher=null);return r}var eo={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Ms={format:"json",protocolVersion:We.protocolVersion};function _l(e,{format:t=Ms.format,protocolVersion:i=Ms.protocolVersion}={}){return{accept:eo[t],"X-Ably-Version":i.toString(),"Ably-Agent":bi(e)}}function Sl(e,{format:t=Ms.format,protocolVersion:i=Ms.protocolVersion}={}){let r;return{accept:r=eo[t],"content-type":r,"X-Ably-Version":i.toString(),"Ably-Agent":bi(e)}}var ee=We;function Ol(e){return Object.assign(We,e)}var Al=class cl{constructor(t,i){this.logger=t,this.members=i||[]}call(t,i){for(const r of this.members)if(r)try{r(t,i)}catch(a){h.logAction(this.logger,h.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}push(...t){this.members.push(...t)}createPromise(){return new Promise((t,i)=>{this.push((r,a)=>{r?i(r):t(a)})})}resolveAll(t){this.call(null,t)}rejectAll(t){this.call(t)}static create(t,i){const r=new cl(t,i);return Object.assign((a,u)=>r.call(a,u),{push:a=>r.push(a),createPromise:()=>r.createPromise(),resolveAll:a=>r.resolveAll(a),rejectAll:a=>r.rejectAll(a)})}},vi=Al,to=(e=>(e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch",e))(to||{}),Ee=to,no=(e=>(e[e.Success=200]="Success",e[e.NoContent=204]="NoContent",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.RequestTimeout=408]="RequestTimeout",e[e.InternalServerError=500]="InternalServerError",e))(no||{});function Rl(e){return e>=200&&e<400}var Ps=no,wi=Math.pow(2,17);function Tl(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function Ml(e){return!!e.connection}function so(e){return D(e)?(e.code||(e.statusCode===403?e.code=40300:(e.code=40170,e.statusCode=401)),e):new R(P(e),e.code||40170,e.statusCode||401)}var Pl=(e,t)=>{const i=_.BufferUtils,r=i.utf8Encode(e),a=i.utf8Encode(t),u=i.hmacSha256(r,a);return i.base64Encode(u)};function io(e){if(!e)return"";typeof e=="string"&&(e=JSON.parse(e));const t=Object.create(null),i=b(e,!0);if(!i)return"";i.sort();for(let r=0;r<i.length;r++)t[i[r]]=e[i[r]].sort();return JSON.stringify(t)}function ro(e,t){if(e.authCallback)h.logAction(t,h.LOG_MINOR,"Auth()","using token auth with authCallback");else if(e.authUrl)h.logAction(t,h.LOG_MINOR,"Auth()","using token auth with authUrl");else if(e.key)h.logAction(t,h.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(e.tokenDetails)h.logAction(t,h.LOG_MINOR,"Auth()","using token auth with supplied token only");else{const i="authOptions must include valid authentication parameters";throw h.logAction(t,h.LOG_ERROR,"Auth()",i),new Error(i)}}function kl(e){return"useTokenAuth"in e&&!e.useTokenAuth}function oo(e){return e.useTokenAuth||!kl(e)&&(e.authCallback||e.authUrl||e.token||e.tokenDetails)}function El(e){return!e.key&&!e.authCallback&&!e.authUrl}var Il=0;function xl(){return Il++}var Ll=class{constructor(e,t){if(this.authOptions={},this.client=e,this.tokenParams=t.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,oo(t))El(t)&&h.logAction(this.logger,h.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(t.defaultTokenParams,t),ro(this.authOptions,this.logger);else{if(!t.key){const i="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw h.logAction(this.logger,h.LOG_ERROR,"Auth()",i),new R(i,40160,401)}h.logAction(this.logger,h.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(t)}}get logger(){return this.client.logger}async authorize(e,t){if(t&&t.key&&this.authOptions.key!==t.key)throw new R("Unable to update auth options with incompatible key",40102,401);try{let i=await this._forceNewToken(e??null,t??null);return Ml(this.client)?new Promise((r,a)=>{this.client.connection.connectionManager.onAuthUpdated(i,(u,g)=>u?a(u):r(g))}):i}catch(i){throw this.client.connection&&i.statusCode===Ps.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(i),i}}async _forceNewToken(e,t){this.tokenDetails=null,this._saveTokenOptions(e,t),ro(this.authOptions,this.logger);try{return this._ensureValidAuthCredentials(!0)}finally{delete this.tokenParams.timestamp,delete this.authOptions.queryTime}}async requestToken(e,t){const i=t||this.authOptions,r=e||le(this.tokenParams);let a,u=this.client;if(i.authCallback)h.logAction(this.logger,h.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),a=i.authCallback;else if(i.authUrl)h.logAction(this.logger,h.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),a=(m,S)=>{const C=$({accept:"application/json, text/plain"},i.authHeaders),I=i.authMethod&&i.authMethod.toLowerCase()==="post";let E;const G=i.authUrl.indexOf("?");G>-1&&(E=H(i.authUrl.slice(G)),i.authUrl=i.authUrl.slice(0,G),I||(i.authParams=$(E,i.authParams)));const k=$({},i.authParams||{},m),F=V=>{var Y,ue;let be=(Y=V.body)!=null?Y:null,Se=null;if(V.error)h.logAction(this.logger,h.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+P(V.error));else{const $e=(ue=V.headers["content-type"])!=null?ue:null;Array.isArray($e)?Se=$e.join(", "):Se=$e,h.logAction(this.logger,h.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+Se+"; body: "+z(be))}if(V.error){S(V.error,null);return}if(V.unpacked){S(null,be);return}if(_.BufferUtils.isBuffer(be)&&(be=be.toString()),!Se){S(new R("authUrl response is missing a content-type header",40170,401),null);return}const ne=Se.indexOf("application/json")>-1,ut=Se.indexOf("text/plain")>-1||Se.indexOf("application/jwt")>-1;if(!ne&&!ut){S(new R("authUrl responded with unacceptable content-type "+Se+", should be either text/plain, application/jwt or application/json",40170,401),null);return}if(ne){if(be.length>wi){S(new R("authUrl response exceeded max permitted length",40170,401),null);return}try{be=JSON.parse(be)}catch($e){S(new R("Unexpected error processing authURL response; err = "+$e.message,40170,401),null);return}}S(null,be,Se)};if(h.logAction(this.logger,h.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+i.authUrl+"; Params: "+JSON.stringify(k)+"; method: "+(I?"POST":"GET")),I){const V=C||{};V["content-type"]="application/x-www-form-urlencoded";const Y=j(k).slice(1);oe(this.client.http.doUri(Ee.Post,i.authUrl,V,Y,E),(ue,be)=>F(ue||be))}else oe(this.client.http.doUri(Ee.Get,i.authUrl,C||{},null,k),(V,Y)=>F(V||Y))};else if(i.key)h.logAction(this.logger,h.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),a=(m,S)=>{oe(this.createTokenRequest(m,i),(C,I)=>S(C,I??null))};else{const m="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";throw h.logAction(this.logger,h.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new R(m,40171,403)}"capability"in r&&(r.capability=io(r.capability));const g=(m,S)=>{const C=m.keyName,I="/keys/"+C+"/requestToken",E=function(k){return u.baseUri(k)+I},G=ee.defaultPostHeaders(this.client.options);i.requestHeaders&&$(G,i.requestHeaders),h.logAction(this.logger,h.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+I+"; Token params: "+JSON.stringify(m)),oe(this.client.http.do(Ee.Post,E,G,JSON.stringify(m),null),(k,F)=>k?S(k):S(F.error,F.body,F.unpacked))};return new Promise((m,S)=>{let C=!1,I=this.client.options.timeouts.realtimeRequestTimeout,E=setTimeout(()=>{C=!0;const G="Token request callback timed out after "+I/1e3+" seconds";h.logAction(this.logger,h.LOG_ERROR,"Auth.requestToken()",G),S(new R(G,40170,401))},I);a(r,(G,k,F)=>{if(C)return;if(clearTimeout(E),G){h.logAction(this.logger,h.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+P(G)),S(so(G));return}if(typeof k=="string"){k.length===0?S(new R("Token string is empty",40170,401)):k.length>wi?S(new R("Token string exceeded max permitted length (was "+k.length+" bytes)",40170,401)):k==="undefined"||k==="null"?S(new R("Token string was literal null/undefined",40170,401)):k[0]==="{"&&!(F&&F.indexOf("application/jwt")>-1)?S(new R("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):m({token:k});return}if(typeof k!="object"||k===null){const Y="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof k;h.logAction(this.logger,h.LOG_ERROR,"Auth.requestToken()",Y),S(new R(Y,40170,401));return}const V=JSON.stringify(k).length;if(V>wi&&!i.suppressMaxLengthCheck){S(new R("Token request/details object exceeded max permitted stringified size (was "+V+" bytes)",40170,401));return}if("issued"in k){m(k);return}if(!("keyName"in k)){const Y="Expected token request callback to call back with a token string, token request object, or token details object";h.logAction(this.logger,h.LOG_ERROR,"Auth.requestToken()",Y),S(new R(Y,40170,401));return}g(k,(Y,ue,be)=>{if(Y){h.logAction(this.logger,h.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+P(Y)),S(so(Y));return}be||(ue=JSON.parse(ue)),h.logAction(this.logger,h.LOG_MINOR,"Auth.getToken()","token received"),m(ue)})})})}async createTokenRequest(e,t){t=t||this.authOptions,e=e||le(this.tokenParams);const i=t.key;if(!i)throw new R("No key specified",40101,403);const r=i.split(":"),a=r[0],u=r[1];if(!u)throw new R("Invalid key specified",40101,403);if(e.clientId==="")throw new R("clientId can’t be an empty string",40012,400);"capability"in e&&(e.capability=io(e.capability));const g=$({keyName:a},e),m=e.clientId||"",S=e.ttl||"",C=e.capability||"";g.timestamp||(g.timestamp=await this._getTimestamp(t&&t.queryTime));const I=g.nonce||(g.nonce=Tl()),E=g.timestamp,G=g.keyName+`
`+S+`
`+C+`
`+m+`
`+E+`
`+I+`
`;return g.mac=g.mac||Pl(G,u),h.logAction(this.logger,h.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),g}async getAuthParams(){if(this.method=="basic")return{key:this.key};{let e=await this._ensureValidAuthCredentials(!1);if(!e)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{access_token:e.token}}}async getAuthHeaders(){if(this.method=="basic")return{authorization:"Basic "+this.basicKey};{const e=await this._ensureValidAuthCredentials(!1);if(!e)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{authorization:"Bearer "+As(e.token)}}}_saveBasicOptions(e){this.method="basic",this.key=e.key,this.basicKey=As(e.key),this.authOptions=e||{},"clientId"in e&&this._userSetClientId(e.clientId)}_saveTokenOptions(e,t){this.method="token",e&&(this.tokenParams=e),t&&(t.token&&(t.tokenDetails=typeof t.token=="string"?{token:t.token}:t.token),t.tokenDetails&&(this.tokenDetails=t.tokenDetails),"clientId"in t&&this._userSetClientId(t.clientId),this.authOptions=t)}async _ensureValidAuthCredentials(e){const t=this.tokenDetails;if(t){if(this._tokenClientIdMismatch(t.clientId))throw new R("Mismatch between clientId in token ("+t.clientId+") and current clientId ("+this.clientId+")",40102,403);if(!this.client.isTimeOffsetSet()||!t.expires||t.expires>=this.client.getTimestampUsingOffset())return h.logAction(this.logger,h.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+t.expires),t;h.logAction(this.logger,h.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}const i=(this.waitingForTokenRequest||(this.waitingForTokenRequest=vi.create(this.logger))).createPromise();if(this.currentTokenRequestId!==null&&!e)return i;const r=this.currentTokenRequestId=xl();let a,u=null;try{a=await this.requestToken(this.tokenParams,this.authOptions)}catch(m){u=m}if(this.currentTokenRequestId>r)return h.logAction(this.logger,h.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),i;this.currentTokenRequestId=null;const g=this.waitingForTokenRequest;return this.waitingForTokenRequest=null,u?(g==null||g.rejectAll(u),i):(g==null||g.resolveAll(this.tokenDetails=a),i)}_userSetClientId(e){if(typeof e=="string"||e===null){if(e==="*")throw new R('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);{const t=this._uncheckedSetClientId(e);if(t)throw t}}else throw new R("clientId must be either a string or null",40012,400)}_uncheckedSetClientId(e){if(this._tokenClientIdMismatch(e)){const t="Unexpected clientId mismatch: client has "+this.clientId+", requested "+e,i=new R(t,40102,401);return h.logAction(this.logger,h.LOG_ERROR,"Auth._uncheckedSetClientId()",t),i}else return this.clientId=this.tokenParams.clientId=e,null}_tokenClientIdMismatch(e){return!!(this.clientId&&this.clientId!=="*"&&e&&e!=="*"&&this.clientId!==e)}static isTokenErr(e){return e.code&&e.code>=40140&&e.code<40150}revokeTokens(e,t){return this.client.rest.revokeTokens(e,t)}async _getTimestamp(e){return this.client.getTimestamp(e||!!this.authOptions.queryTime)}},Mt=Ll;function Ci(e){const t=[];if(e)for(const i in e)t.push(i+"="+e[i]);return t.join("&")}function gn(e,t){return e+(t?"?":"")+Ci(t)}function Nl(e,t,i,r,a){e.error?h.logActionNoStrip(a,h.LOG_MICRO,"Http."+t+"()","Received Error; "+gn(i,r)+"; Error: "+P(e.error)):h.logActionNoStrip(a,h.LOG_MICRO,"Http."+t+"()","Received; "+gn(i,r)+"; Headers: "+Ci(e.headers)+"; StatusCode: "+e.statusCode+"; Body"+(_.BufferUtils.isBuffer(e.body)?" (Base64): "+_.BufferUtils.base64Encode(e.body):": "+e.body))}function Ul(e,t,i,r,a){a.shouldLog(h.LOG_MICRO)&&h.logActionNoStrip(a,h.LOG_MICRO,"Http."+e+"()","Sending; "+gn(t,r)+"; Body"+(_.BufferUtils.isBuffer(i)?" (Base64): "+_.BufferUtils.base64Encode(i):": "+i))}var _i=class{constructor(e){this.client=e,this.platformHttp=new _.Http(e),this.checkConnectivity=this.platformHttp.checkConnectivity?()=>this.platformHttp.checkConnectivity():void 0}get logger(){var e,t;return(t=(e=this.client)==null?void 0:e.logger)!=null?t:h.defaultLogger}get supportsAuthHeaders(){return this.platformHttp.supportsAuthHeaders}get supportsLinkHeaders(){return this.platformHttp.supportsLinkHeaders}_getHosts(e){const t=e.connection,i=t&&t.connectionManager.host;return i?[i].concat(ee.getFallbackHosts(e.options)):ee.getHosts(e.options)}async do(e,t,i,r,a){try{const u=this.client;if(!u)return{error:new R("http.do called without client",5e4,500)};const g=typeof t=="function"?t:function(E){return u.baseUri(E)+t},m=u._currentFallback;if(m)if(m.validUntil>Date.now()){const E=await this.doUri(e,g(m.host),i,r,a);return E.error&&this.platformHttp.shouldFallback(E.error)?(u._currentFallback=null,this.do(e,t,i,r,a)):E}else u._currentFallback=null;const S=this._getHosts(u);if(S.length===1)return this.doUri(e,g(S[0]),i,r,a);let C=null;const I=async(E,G)=>{const k=E.shift();C=C??new Date;const F=await this.doUri(e,g(k),i,r,a);return F.error&&this.platformHttp.shouldFallback(F.error)&&E.length?Date.now()-C.getTime()>u.options.timeouts.httpMaxRetryDuration?{error:new R(`Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${u.options.timeouts.httpMaxRetryDuration}ms limit`,50003,500)}:I(E,!0):(G&&(u._currentFallback={host:k,validUntil:Date.now()+u.options.timeouts.fallbackRetryTimeout}),F)};return I(S)}catch(u){return{error:new R(`Unexpected error in Http.do: ${P(u)}`,500,5e4)}}}async doUri(e,t,i,r,a){try{Ul(e,t,r,a,this.logger);const u=await this.platformHttp.doUri(e,t,i,r,a);return this.logger.shouldLog(h.LOG_MICRO)&&Nl(u,e,t,a,this.logger),u}catch(u){return{error:new R(`Unexpected error in Http.doUri: ${P(u)}`,500,5e4)}}}};function Bl(e,t,i,r){try{i.apply(t,r)}catch(a){h.logAction(e,h.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+a+"; stack = "+(a&&a.stack))}}function Si(e,t,i){let r,a,u;for(let g=0;g<e.length;g++)if(r=e[g],i&&(r=r[i]),Array.isArray(r)){for(;(a=r.indexOf(t))!==-1;)r.splice(a,1);i&&r.length===0&&delete e[g][i]}else if(mt(r))for(u in r)Object.prototype.hasOwnProperty.call(r,u)&&Array.isArray(r[u])&&Si([r],t,u)}var Dl=class{constructor(e){this.logger=e,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}on(...e){if(e.length===1){const t=e[0];if(typeof t=="function")this.any.push(t);else throw new Error("EventListener.on(): Invalid arguments: "+_.Config.inspect(e))}if(e.length===2){const[t,i]=e;if(typeof i!="function")throw new Error("EventListener.on(): Invalid arguments: "+_.Config.inspect(e));if(ke(t))this.any.push(i);else if(Array.isArray(t))t.forEach(r=>{this.on(r,i)});else{if(typeof t!="string")throw new Error("EventListener.on(): Invalid arguments: "+_.Config.inspect(e));(this.events[t]||(this.events[t]=[])).push(i)}}}off(...e){if(e.length==0||ke(e[0])&&ke(e[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}const[t,i]=e;let r=null,a=null;if(e.length===1||!i)typeof t=="function"?r=t:a=t;else{if(typeof i!="function")throw new Error("EventEmitter.off(): invalid arguments:"+_.Config.inspect(e));[a,r]=[t,i]}if(r&&ke(a)){Si([this.any,this.events,this.anyOnce,this.eventsOnce],r);return}if(Array.isArray(a)){a.forEach(u=>{this.off(u,r)});return}if(typeof a!="string")throw new Error("EventEmitter.off(): invalid arguments:"+_.Config.inspect(e));r?Si([this.events,this.eventsOnce],r,a):(delete this.events[a],delete this.eventsOnce[a])}listeners(e){if(e){const t=this.events[e]||[];return this.eventsOnce[e]&&Array.prototype.push.apply(t,this.eventsOnce[e]),t.length?t:null}return this.any.length?this.any:null}emit(e,...t){const i={event:e},r=[];this.anyOnce.length&&(Array.prototype.push.apply(r,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(r,this.any);const a=this.eventsOnce[e];a&&(Array.prototype.push.apply(r,a),delete this.eventsOnce[e]);const u=this.events[e];u&&Array.prototype.push.apply(r,u),r.forEach(g=>{Bl(this.logger,i,g,t)})}once(...e){const t=e.length;if(t===0||t===1&&typeof e[0]!="function"){const a=e[0];return new Promise(u=>{this.once(a,u)})}const[i,r]=e;if(e.length===1&&typeof i=="function")this.anyOnce.push(i);else if(ke(i)){if(typeof r!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+_.Config.inspect(e));this.anyOnce.push(r)}else if(Array.isArray(i)){const a=this,u=function(){const g=Array.prototype.slice.call(arguments);if(i.forEach(function(m){a.off(m,u)}),typeof r!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+_.Config.inspect(e));r.apply(this,g)};i.forEach(function(g){a.on(g,u)})}else{if(typeof i!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+_.Config.inspect(e));const a=this.eventsOnce[i]||(this.eventsOnce[i]=[]);if(r){if(typeof r!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+_.Config.inspect(e));a.push(r)}}}async whenState(e,t){if(typeof e!="string"||typeof t!="string")throw new Error("whenState requires a valid state String argument");return e===t?null:this.once(e)}},Be=Dl,Q={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18,OBJECT:19,OBJECT_SYNC:20,ANNOTATION:21},ao=[];Object.keys(Q).forEach(function(e){ao[Q[e]]=e});var tt={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,HAS_OBJECTS:128,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19,ANNOTATION_PUBLISH:1<<21,ANNOTATION_SUBSCRIBE:1<<22,OBJECT_SUBSCRIBE:1<<24,OBJECT_PUBLISH:1<<25},Hl=Object.keys(tt);tt.MODE_ALL=tt.PRESENCE|tt.PUBLISH|tt.SUBSCRIBE|tt.PRESENCE_SUBSCRIBE|tt.ANNOTATION_PUBLISH|tt.ANNOTATION_SUBSCRIBE|tt.OBJECT_SUBSCRIBE|tt.OBJECT_PUBLISH;var co=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE","ANNOTATION_PUBLISH","ANNOTATION_SUBSCRIBE","OBJECT_SUBSCRIBE","OBJECT_PUBLISH"];function Gl(e){return!e||!e.channelOptions?{channelOptions:e,plugins:{},baseEncodedPreviousPayload:void 0}:e}function lo(e,t,i){if(i&&i.cipher){e||Ve("Crypto");const r=e.getCipher(i.cipher,t);return{cipher:r.cipherParams,channelCipher:r.cipher}}return i??{}}async function jl(e,t){const{data:i,encoding:r}=await uo(e.data,e.encoding,t);return e.data=i,e.encoding=r,e}async function uo(e,t,i){let r=i.channelCipher,a=e,u=t?t+"/":"";_.BufferUtils.isBuffer(a)||(a=_.BufferUtils.utf8Encode(String(a)),u=u+"utf-8/");const g=await r.encrypt(a);return u=u+"cipher+"+r.algorithm,{data:g,encoding:u}}async function Oi(e,t){const i=typeof e.data=="string"||_.BufferUtils.isBuffer(e.data)||e.data===null||e.data===void 0,{data:r,encoding:a}=ho(e.data,e.encoding,i);return e.data=r,e.encoding=a,t!=null&&t.cipher?jl(e,t):e}function ho(e,t,i){if(i)return{data:e,encoding:t};if(mt(e)||Array.isArray(e))return{data:JSON.stringify(e),encoding:t?t+"/json":"json"};throw new R("Data type is unsupported",40013,400)}async function Ai(e,t){const{data:i,encoding:r,error:a}=await fo(e.data,e.encoding,t);if(e.data=i,e.encoding=r,a)throw a}async function fo(e,t,i){const r=Gl(i);let a=e,u=e,g=t,m;if(t){const S=t.split("/");let C,I=S.length,E="";try{for(;(C=I)>0;){const G=S[--I].match(/([-\w]+)(\+([\w-]+))?/);if(!G)break;switch(E=G[1],E){case"base64":u=_.BufferUtils.base64Decode(String(u)),C==S.length&&(a=u);continue;case"utf-8":u=_.BufferUtils.utf8Decode(u);continue;case"json":u=JSON.parse(u);continue;case"cipher":if(r.channelOptions!=null&&r.channelOptions.cipher&&r.channelOptions.channelCipher){const k=G[3],F=r.channelOptions.channelCipher;if(k!=F.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");u=await F.decrypt(u);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!r.plugins||!r.plugins.vcdiff)throw new R("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new R("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{let k=r.baseEncodedPreviousPayload;typeof k=="string"&&(k=_.BufferUtils.utf8Encode(k));const F=_.BufferUtils.toBuffer(k);u=_.BufferUtils.toBuffer(u),u=_.BufferUtils.arrayBufferViewToBuffer(r.plugins.vcdiff.decode(u,F)),a=u}catch(k){throw new R("Vcdiff delta decode failed with "+k,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(G){const k=G;m=new R(`Error processing the ${E} encoding, decoder returned ‘${k.message}’`,k.code||40013,400)}finally{g=C<=0?null:S.slice(0,C).join("/")}}return m?{error:m,data:u,encoding:g}:(r.baseEncodedPreviousPayload=a,{data:u,encoding:g})}function Ri(...e){const t=e.length>0?"json":"msgpack",{data:i,encoding:r}=go(this.data,this.encoding,t);return Object.assign({},this,{encoding:r,data:i})}function go(e,t,i){return!e||!_.BufferUtils.isBuffer(e)?{data:e,encoding:t}:i==="msgpack"?{data:_.BufferUtils.toBuffer(e),encoding:t}:{data:_.BufferUtils.base64Encode(e),encoding:t?t+"/base64":"base64"}}var ks={encryptData:uo,encodeData:ho,encodeDataForWire:go,decodeData:fo};function Es(e){const{id:t,connectionId:i,timestamp:r}=e;let a;switch(e.action){case Q.MESSAGE:{a=e.messages;break}case Q.PRESENCE:case Q.SYNC:a=e.presence;break;case Q.ANNOTATION:a=e.annotations;break;case Q.OBJECT:case Q.OBJECT_SYNC:a=e.state;break;default:throw new R("Unexpected action "+e.action,4e4,400)}for(let u=0;u<a.length;u++){const g=a[u];g.connectionId||(g.connectionId=i),g.timestamp||(g.timestamp=r),t&&!g.id&&(g.id=t+":"+u)}}function pn(e,t){let i="["+t;for(const r in e)r==="data"?typeof e.data=="string"?i+="; data="+e.data:_.BufferUtils.isBuffer(e.data)?i+="; data (buffer)="+_.BufferUtils.base64Encode(e.data):typeof e.data<"u"&&(i+="; data (json)="+JSON.stringify(e.data)):r&&(r==="extras"||r==="operation")?i+="; "+r+"="+JSON.stringify(e[r]):e[r]!==void 0&&(i+="; "+r+"="+e[r]);return i+="]",i}var mn=class{},po=class{constructor(e){this.Platform=_,this.ErrorInfo=R,this.Logger=h,this.Defaults=ee,this.Utils=W,this.EventEmitter=Be,this.MessageEncoding=ks;var t,i,r,a,u,g,m,S,C,I;this._additionalHTTPRequestImplementations=(t=e.plugins)!=null?t:null,this.logger=new h,this.logger.setLog(e.logLevel,e.logHandler),h.logAction(this.logger,h.LOG_MICRO,"BaseClient()","initialized with clientOptions "+_.Config.inspect(e)),this._MsgPack=(r=(i=e.plugins)==null?void 0:i.MsgPack)!=null?r:null;const E=this.options=ee.normaliseOptions(e,this._MsgPack,this.logger);if(E.key){const G=E.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!G){const k="invalid key parameter";throw h.logAction(this.logger,h.LOG_ERROR,"BaseClient()",k),new R(k,40400,404)}E.keyName=G[1],E.keySecret=G[2]}if("clientId"in E)if(typeof E.clientId=="string"||E.clientId===null){if(E.clientId==="*")throw new R('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new R("clientId must be either a string or null",40012,400);h.logAction(this.logger,h.LOG_MINOR,"BaseClient()","started; version = "+ee.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new _i(this),this.auth=new Mt(this,E),this._rest=(a=e.plugins)!=null&&a.Rest?new e.plugins.Rest(this):null,this._Crypto=(g=(u=e.plugins)==null?void 0:u.Crypto)!=null?g:null,this.__FilteredSubscriptions=(S=(m=e.plugins)==null?void 0:m.MessageInteractions)!=null?S:null,this._Annotations=(I=(C=e.plugins)==null?void 0:C.Annotations)!=null?I:null}get rest(){return this._rest||Ve("Rest"),this._rest}get _FilteredSubscriptions(){return this.__FilteredSubscriptions||Ve("MessageInteractions"),this.__FilteredSubscriptions}get channels(){return this.rest.channels}get push(){return this.rest.push}device(){var e;return(!((e=this.options.plugins)!=null&&e.Push)||!this.push.LocalDevice)&&Ve("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}baseUri(e){return ee.getHttpScheme(this.options)+e+":"+ee.getPort(this.options,!1)}async stats(e){return this.rest.stats(e)}async time(e){return this.rest.time(e)}async request(e,t,i,r,a,u){return this.rest.request(e,t,i,r,a,u)}batchPublish(e){return this.rest.batchPublish(e)}batchPresence(e){return this.rest.batchPresence(e)}setLog(e){this.logger.setLog(e.level,e.handler)}async getTimestamp(e){return!this.isTimeOffsetSet()&&e?this.time():this.getTimestampUsingOffset()}getTimestampUsingOffset(){return Date.now()+(this.serverTimeOffset||0)}isTimeOffsetSet(){return this.serverTimeOffset!==null}};po.Platform=_;var mo=po,ql=class Rn{toJSON(){var t,i,r;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(t=this.push)==null?void 0:t.recipient,state:(i=this.push)==null?void 0:i.state,error:(r=this.push)==null?void 0:r.error}}}toString(){var t,i,r,a;let u="[DeviceDetails";return this.id&&(u+="; id="+this.id),this.platform&&(u+="; platform="+this.platform),this.formFactor&&(u+="; formFactor="+this.formFactor),this.clientId&&(u+="; clientId="+this.clientId),this.metadata&&(u+="; metadata="+this.metadata),this.deviceIdentityToken&&(u+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(t=this.push)!=null&&t.recipient&&(u+="; push.recipient="+JSON.stringify(this.push.recipient)),(i=this.push)!=null&&i.state&&(u+="; push.state="+this.push.state),(r=this.push)!=null&&r.error&&(u+="; push.error="+JSON.stringify(this.push.error)),(a=this.push)!=null&&a.metadata&&(u+="; push.metadata="+this.push.metadata),u+="]",u}static toRequestBody(t,i,r){return Ae(t,i,r)}static fromResponseBody(t,i,r){return r&&(t=se(t,i,r)),Array.isArray(t)?Rn.fromValuesArray(t):Rn.fromValues(t)}static fromValues(t){return t.error=t.error&&R.fromValues(t.error),Object.assign(new Rn,t)}static fromLocalDevice(t){return Object.assign(new Rn,t)}static fromValuesArray(t){const i=t.length,r=new Array(i);for(let a=0;a<i;a++)r[a]=Rn.fromValues(t[a]);return r}},yn=ql;async function yo(e,t,i,r){if(e.http.supportsAuthHeaders){const a=await e.auth.getAuthHeaders();return r($(a,t),i)}else{const a=await e.auth.getAuthParams();return r(t,$(a,i))}}function Fl(e,t,i){if(e.err&&!e.body)return{err:e.err};if(e.statusCode===Ps.NoContent)return J(U({},e),{body:[],unpacked:!0});let r=e.body;if(!e.unpacked)try{r=se(r,t,i)}catch(m){return D(m)?{err:m}:{err:new _e(P(m),null)}}if(!r)return{err:new _e("unenvelope(): Response body is missing",null)};const{statusCode:a,response:u,headers:g}=r;if(a===void 0)return J(U({},e),{body:r,unpacked:!0});if(a<200||a>=300){let m=u&&u.error||e.err;return m||(m=new Error("Error in unenveloping "+r),m.statusCode=a),{err:m,body:u,headers:g,unpacked:!0,statusCode:a}}return{err:e.err,body:u,headers:g,unpacked:!0,statusCode:a}}function Vl(e,t,i,r,a){e.err?h.logAction(a,h.LOG_MICRO,"Resource."+t+"()","Received Error; "+gn(i,r)+"; Error: "+P(e.err)):h.logAction(a,h.LOG_MICRO,"Resource."+t+"()","Received; "+gn(i,r)+"; Headers: "+Ci(e.headers)+"; StatusCode: "+e.statusCode+"; Body: "+(_.BufferUtils.isBuffer(e.body)?" (Base64): "+_.BufferUtils.base64Encode(e.body):": "+_.Config.inspect(e.body)))}var Wl=class Tn{static async get(t,i,r,a,u,g){return Tn.do(Ee.Get,t,i,null,r,a,u,g??!1)}static async delete(t,i,r,a,u,g){return Tn.do(Ee.Delete,t,i,null,r,a,u,g)}static async post(t,i,r,a,u,g,m){return Tn.do(Ee.Post,t,i,r,a,u,g,m)}static async patch(t,i,r,a,u,g,m){return Tn.do(Ee.Patch,t,i,r,a,u,g,m)}static async put(t,i,r,a,u,g,m){return Tn.do(Ee.Put,t,i,r,a,u,g,m)}static async do(t,i,r,a,u,g,m,S){m&&((g=g||{}).envelope=m);const C=i.logger;async function I(G,k){var F;if(C.shouldLog(h.LOG_MICRO)){let Y=a;if(((F=G["content-type"])==null?void 0:F.indexOf("msgpack"))>0)try{i._MsgPack||Ve("MsgPack"),Y=i._MsgPack.decode(a)}catch(ue){h.logAction(C,h.LOG_MICRO,"Resource."+t+"()","Sending MsgPack Decoding Error: "+P(ue))}h.logAction(C,h.LOG_MICRO,"Resource."+t+"()","Sending; "+gn(r,k)+"; Body: "+Y)}const V=await i.http.do(t,r,G,a,k);return V.error&&Mt.isTokenErr(V.error)?(await i.auth.authorize(null,null),yo(i,G,k,I)):{err:V.error,body:V.body,headers:V.headers,unpacked:V.unpacked,statusCode:V.statusCode}}let E=await yo(i,u,g,I);if(m&&(E=Fl(E,i._MsgPack,m)),C.shouldLog(h.LOG_MICRO)&&Vl(E,t,r,g,C),S){if(E.err)throw E.err;{const G=U({},E);return delete G.err,G}}return E}},Ne=Wl;function $l(e){const t=e.match(/^\.\/(\w+)\?(.*)$/);return t&&t[2]&&H(t[2])}function Kl(e){typeof e=="string"&&(e=e.split(","));const t={};for(let i=0;i<e.length;i++){const r=e[i].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(r){const a=$l(r[1]);a&&(t[r[2]]=a)}}return t}function zl(e,t,i){return!(i&&(t||typeof e.code=="number"))}var Jl=class{constructor(e,t,i,r,a,u){this.client=e,this.path=t,this.headers=i,this.envelope=r??null,this.bodyHandler=a,this.useHttpPaginatedResponse=u||!1}get logger(){return this.client.logger}async get(e){const t=await Ne.get(this.client,this.path,this.headers,e,this.envelope,!1);return this.handlePage(t)}async delete(e){const t=await Ne.delete(this.client,this.path,this.headers,e,this.envelope,!1);return this.handlePage(t)}async post(e,t){const i=await Ne.post(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(i)}async put(e,t){const i=await Ne.put(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(i)}async patch(e,t){const i=await Ne.patch(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(i)}async handlePage(e){if(e.err&&zl(e.err,e.body,this.useHttpPaginatedResponse))throw h.logAction(this.logger,h.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+P(e.err)),e.err;let t,i,r;try{t=e.statusCode==Ps.NoContent?[]:await this.bodyHandler(e.body,e.headers||{},e.unpacked)}catch(a){throw e.err||a}return e.headers&&(i=e.headers.Link||e.headers.link)&&(r=Kl(i)),this.useHttpPaginatedResponse?new Ql(this,t,e.headers||{},e.statusCode,r,e.err):new bo(this,t,r)}},bo=class{constructor(e,t,i){this.resource=e,this.items=t,this._relParams=i}async first(){if(this.hasFirst())return this.get(this._relParams.first);throw new R("No link to the first page of results",40400,404)}async current(){if(this.hasCurrent())return this.get(this._relParams.current);throw new R("No link to the current page of results",40400,404)}async next(){return this.hasNext()?this.get(this._relParams.next):null}hasFirst(){return this._relParams!=null&&"first"in this._relParams}hasCurrent(){return this._relParams!=null&&"current"in this._relParams}hasNext(){return this._relParams!=null&&"next"in this._relParams}isLast(){return!this.hasNext()}async get(e){const t=this.resource,i=await Ne.get(t.client,t.path,t.headers,e,t.envelope,!1);return t.handlePage(i)}},Ql=class extends bo{constructor(e,t,i,r,a,u){super(e,t,a),this.statusCode=r,this.success=r<300&&r>=200,this.headers=i,this.errorCode=u&&u.code,this.errorMessage=u&&u.message}toJSON(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}},Ct=Jl,vo=class is{toJSON(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}toString(){let t="[PushChannelSubscription";return this.channel&&(t+="; channel="+this.channel),this.deviceId&&(t+="; deviceId="+this.deviceId),this.clientId&&(t+="; clientId="+this.clientId),t+="]",t}static fromResponseBody(t,i,r){return r&&(t=se(t,i,r)),Array.isArray(t)?is.fromValuesArray(t):is.fromValues(t)}static fromValues(t){return Object.assign(new is,t)}static fromValuesArray(t){const i=t.length,r=new Array(i);for(let a=0;a<i;a++)r[a]=is.fromValues(t[a]);return r}};vo.toRequestBody=Ae;var Yl=vo,Is=Yl,Xl=class{constructor(e){var t;this.client=e,this.admin=new Zl(e),_.Config.push&&((t=e.options.plugins)!=null&&t.Push)&&(this.stateMachine=new e.options.plugins.Push.ActivationStateMachine(e),this.LocalDevice=e.options.plugins.Push.localDeviceFactory(yn))}async activate(e,t){await new Promise((i,r)=>{var a;if(!((a=this.client.options.plugins)!=null&&a.Push)){r(Rs("Push"));return}if(!this.stateMachine){r(new R("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.activatedCallback){r(new R("Activation already in progress",4e4,400));return}this.stateMachine.activatedCallback=u=>{if(u){r(u);return}i()},this.stateMachine.updateFailedCallback=t,this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledActivate(this.stateMachine,e))})}async deactivate(e){await new Promise((t,i)=>{var r;if(!((r=this.client.options.plugins)!=null&&r.Push)){i(Rs("Push"));return}if(!this.stateMachine){i(new R("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.deactivatedCallback){i(new R("Deactivation already in progress",4e4,400));return}this.stateMachine.deactivatedCallback=a=>{if(a){i(a);return}t()},this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine,e))})}},Zl=class{constructor(e){this.client=e,this.deviceRegistrations=new eu(e),this.channelSubscriptions=new tu(e)}async publish(e,t){const i=this.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=ee.defaultPostHeaders(i.options,{format:r}),u={},g=$({recipient:e},t);$(a,i.options.headers),i.options.pushFullWait&&$(u,{fullWait:"true"});const m=Ae(g,i._MsgPack,r);await Ne.post(i,"/push/publish",m,a,u,null,!0)}},eu=class{constructor(e){this.client=e}async save(e){const t=this.client,i=yn.fromValues(e),r=t.options.useBinaryProtocol?"msgpack":"json",a=ee.defaultPostHeaders(t.options,{format:r}),u={};$(a,t.options.headers),t.options.pushFullWait&&$(u,{fullWait:"true"});const g=Ae(i,t._MsgPack,r),m=await Ne.put(t,"/push/deviceRegistrations/"+encodeURIComponent(e.id),g,a,u,null,!0);return yn.fromResponseBody(m.body,t._MsgPack,m.unpacked?void 0:r)}async get(e){const t=this.client,i=t.options.useBinaryProtocol?"msgpack":"json",r=ee.defaultGetHeaders(t.options,{format:i}),a=e.id||e;if(typeof a!="string"||!a.length)throw new R("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);$(r,t.options.headers);const u=await Ne.get(t,"/push/deviceRegistrations/"+encodeURIComponent(a),r,{},null,!0);return yn.fromResponseBody(u.body,t._MsgPack,u.unpacked?void 0:i)}async list(e){const t=this.client,i=t.options.useBinaryProtocol?"msgpack":"json",r=this.client.http.supportsLinkHeaders?void 0:i,a=ee.defaultGetHeaders(t.options,{format:i});return $(a,t.options.headers),new Ct(t,"/push/deviceRegistrations",a,r,async function(u,g,m){return yn.fromResponseBody(u,t._MsgPack,m?void 0:i)}).get(e)}async remove(e){const t=this.client,i=t.options.useBinaryProtocol?"msgpack":"json",r=ee.defaultGetHeaders(t.options,{format:i}),a={},u=e.id||e;if(typeof u!="string"||!u.length)throw new R("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);$(r,t.options.headers),t.options.pushFullWait&&$(a,{fullWait:"true"}),await Ne.delete(t,"/push/deviceRegistrations/"+encodeURIComponent(u),r,a,null,!0)}async removeWhere(e){const t=this.client,i=t.options.useBinaryProtocol?"msgpack":"json",r=ee.defaultGetHeaders(t.options,{format:i});$(r,t.options.headers),t.options.pushFullWait&&$(e,{fullWait:"true"}),await Ne.delete(t,"/push/deviceRegistrations",r,e,null,!0)}},tu=class ll{constructor(t){this.remove=ll.prototype.removeWhere,this.client=t}async save(t){const i=this.client,r=Is.fromValues(t),a=i.options.useBinaryProtocol?"msgpack":"json",u=ee.defaultPostHeaders(i.options,{format:a}),g={};$(u,i.options.headers),i.options.pushFullWait&&$(g,{fullWait:"true"});const m=Ae(r,i._MsgPack,a),S=await Ne.post(i,"/push/channelSubscriptions",m,u,g,null,!0);return Is.fromResponseBody(S.body,i._MsgPack,S.unpacked?void 0:a)}async list(t){const i=this.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:r,u=ee.defaultGetHeaders(i.options,{format:r});return $(u,i.options.headers),new Ct(i,"/push/channelSubscriptions",u,a,async function(g,m,S){return Is.fromResponseBody(g,i._MsgPack,S?void 0:r)}).get(t)}async removeWhere(t){const i=this.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=ee.defaultGetHeaders(i.options,{format:r});$(a,i.options.headers),i.options.pushFullWait&&$(t,{fullWait:"true"}),await Ne.delete(i,"/push/channelSubscriptions",a,t,null,!0)}async listChannels(t){const i=this.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:r,u=ee.defaultGetHeaders(i.options,{format:r});return $(u,i.options.headers),i.options.pushFullWait&&$(t,{fullWait:"true"}),new Ct(i,"/push/channels",u,a,async function(g,m,S){const C=!S&&r?se(g,i._MsgPack,r):g;for(let I=0;I<C.length;I++)C[I]=String(C[I]);return C}).get(t)}},nu=Xl,wo=["absent","present","enter","leave","update"];async function Co(e,t,i,r){const a=lo(t,e,r??null);return Dn.fromValues(i).decode(a,e)}async function su(e,t,i,r){return Promise.all(i.map(function(a){return Co(e,t,a,r)}))}async function iu(e,t){return Dn.fromValues(e).decode(t.channelOptions,t.logger)}async function _o(e,t){return Promise.all(e.map(function(i){return iu(i,t)}))}var So=class rs extends mn{isSynthesized(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId}parseId(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");const t=this.id.split(":");return{connectionId:t[0],msgSerial:parseInt(t[1],10),index:parseInt(t[2],10)}}async encode(t){const i=Object.assign(new Dn,this,{action:wo.indexOf(this.action||"present")});return Oi(i,t)}static fromValues(t){return Object.assign(new rs,t)}static fromValuesArray(t){return t.map(i=>rs.fromValues(i))}static fromData(t){return t instanceof rs?t:rs.fromValues({data:t})}toString(){return pn(this,"PresenceMessage")}},Dn=class Sr extends mn{toJSON(...t){return Ri.call(this,...t)}static fromValues(t){return Object.assign(new Sr,t)}static fromValuesArray(t){return t.map(i=>Sr.fromValues(i))}async decode(t,i){const r=Object.assign(new So,J(U({},this),{action:wo[this.action]}));try{await Ai(r,t)}catch(a){h.logAction(i,h.LOG_ERROR,"WirePresenceMessage.decode()",P(a))}return r}toString(){return pn(this,"WirePresenceMessage")}},jt=So,ru=class{constructor(e){this.channel=e}get logger(){return this.channel.logger}async get(e){h.logAction(this.logger,h.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name);const t=this.channel.client,i=t.options.useBinaryProtocol?"msgpack":"json",r=this.channel.client.http.supportsLinkHeaders?void 0:i,a=ee.defaultGetHeaders(t.options,{format:i});return $(a,t.options.headers),new Ct(t,this.channel.client.rest.presenceMixin.basePath(this),a,r,async(u,g,m)=>{const S=m?u:se(u,t._MsgPack,i);return _o(S,this.channel)}).get(e)}async history(e){return h.logAction(this.logger,h.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),this.channel.client.rest.presenceMixin.history(this,e)}},ou=ru,Oo=["message.create","message.update","message.delete","meta","message.summary"];function au(e){return Oo[e||0]||"unknown"}function cu(e){let t=0;return e.name&&(t+=e.name.length),e.clientId&&(t+=e.clientId.length),e.extras&&(t+=JSON.stringify(e.extras).length),e.data&&(t+=q(e.data)),t}async function Ao(e,t,i,r){const a=lo(t,e,r??null);return Hn.fromValues(i).decode(a,e)}async function lu(e,t,i,r){return Promise.all(i.map(function(a){return Ao(e,t,a,r)}))}async function uu(e,t){return Hn.fromValues(e).decode(t.channelOptions,t.logger)}async function hu(e,t){return Promise.all(e.map(function(i){return uu(i,t)}))}async function Ro(e,t){return Promise.all(e.map(i=>i.encode(t)))}var fu=Ae;function Ti(e){let t,i=0;for(let r=0;r<e.length;r++)t=e[r],i+=t.size||(t.size=cu(t));return i}var To=class Or extends mn{expandFields(){this.action==="message.create"&&(this.version&&!this.serial&&(this.serial=this.version),this.timestamp&&!this.createdAt&&(this.createdAt=this.timestamp))}async encode(t){const i=Object.assign(new Hn,this,{action:Oo.indexOf(this.action||"message.create")});return Oi(i,t)}static fromValues(t){return Object.assign(new Or,t)}static fromValuesArray(t){return t.map(i=>Or.fromValues(i))}toString(){return pn(this,"Message")}},Hn=class Ar extends mn{toJSON(...t){return Ri.call(this,...t)}static fromValues(t){return Object.assign(new Ar,t)}static fromValuesArray(t){return t.map(i=>Ar.fromValues(i))}async decodeWithErr(t,i){const r=Object.assign(new To,J(U({},this),{action:au(this.action)}));let a;try{await Ai(r,t)}catch(u){h.logAction(i,h.LOG_ERROR,"WireMessage.decode()",P(u)),a=u}return r.expandFields(),{decoded:r,err:a}}async decode(t,i){const{decoded:r}=await this.decodeWithErr(t,i);return r}toString(){return pn(this,"WireMessage")}},qt=To,du=9;function gu(e){return e.every(function(t){return!t.id})}var pu=class{constructor(e,t,i){this._annotations=null;var r,a;h.logAction(e.logger,h.LOG_MINOR,"RestChannel()","started; name = "+t),this.name=t,this.client=e,this.presence=new ou(this),this.channelOptions=Ts((r=e._Crypto)!=null?r:null,this.logger,i),(a=e.options.plugins)!=null&&a.Push&&(this._push=new e.options.plugins.Push.PushChannel(this)),e._Annotations&&(this._annotations=new e._Annotations.RestAnnotations(this))}get annotations(){return this._annotations||Ve("Annotations"),this._annotations}get push(){return this._push||Ve("Push"),this._push}get logger(){return this.client.logger}setOptions(e){var t;this.channelOptions=Ts((t=this.client._Crypto)!=null?t:null,this.logger,e)}async history(e){return h.logAction(this.logger,h.LOG_MICRO,"RestChannel.history()","channel = "+this.name),this.client.rest.channelMixin.history(this,e)}async publish(...e){const t=e[0],i=e[1];let r,a;if(typeof t=="string"||t===null)r=[qt.fromValues({name:t,data:i})],a=e[2];else if(mt(t))r=[qt.fromValues(t)],a=e[1];else if(Array.isArray(t))r=qt.fromValuesArray(t),a=e[1];else throw new R("The single-argument form of publish() expects a message object or an array of message objects",40013,400);a||(a={});const u=this.client,g=u.options,m=g.useBinaryProtocol?"msgpack":"json",S=u.options.idempotentRestPublishing,C=ee.defaultPostHeaders(u.options,{format:m});if($(C,g.headers),S&&gu(r)){const k=await Z(du);r.forEach(function(F,V){F.id=k+":"+V.toString()})}const I=await Ro(r,this.channelOptions),E=Ti(I),G=g.maxMessageSize;if(E>G)throw new R(`Maximum size of messages that can be published at once exceeded (was ${E} bytes; limit is ${G} bytes)`,40009,400);await this._publish(fu(I,u._MsgPack,m),C,a)}async _publish(e,t,i){await Ne.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",e,t,i,null,!0)}async status(){return this.client.rest.channelMixin.status(this)}},mu=pu,yu=class ul{constructor(t){this.entries=t&&t.entries||void 0,this.schema=t&&t.schema||void 0,this.appId=t&&t.appId||void 0,this.inProgress=t&&t.inProgress||void 0,this.unit=t&&t.unit||void 0,this.intervalId=t&&t.intervalId||void 0}static fromValues(t){return new ul(t)}},bu=yu,Mo=class{static basePath(e){return"/channels/"+encodeURIComponent(e.name)}static history(e,t){const i=e.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=e.client.http.supportsLinkHeaders?void 0:r,u=ee.defaultGetHeaders(i.options,{format:r});return $(u,i.options.headers),new Ct(i,this.basePath(e)+"/messages",u,a,async function(g,m,S){const C=S?g:se(g,i._MsgPack,r);return hu(C,e)}).get(t)}static async status(e){const t=e.client.options.useBinaryProtocol?"msgpack":"json",i=ee.defaultPostHeaders(e.client.options,{format:t});return(await Ne.get(e.client,this.basePath(e),i,{},t,!0)).body}},vu=class{static basePath(e){return Mo.basePath(e.channel)+"/presence"}static async history(e,t){const i=e.channel.client,r=i.options.useBinaryProtocol?"msgpack":"json",a=e.channel.client.http.supportsLinkHeaders?void 0:r,u=ee.defaultGetHeaders(i.options,{format:r});return $(u,i.options.headers),new Ct(i,this.basePath(e)+"/history",u,a,async(g,m,S)=>{const C=S?g:se(g,i._MsgPack,r);return _o(C,e.channel)}).get(t)}},Po=class{constructor(e){this.channelMixin=Mo,this.presenceMixin=vu,this.Resource=Ne,this.PaginatedResource=Ct,this.DeviceDetails=yn,this.PushChannelSubscription=Is,this.client=e,this.channels=new wu(this.client),this.push=new nu(this.client)}async stats(e){const t=ee.defaultGetHeaders(this.client.options),i=this.client.options.useBinaryProtocol?"msgpack":"json",r=this.client.http.supportsLinkHeaders?void 0:i;return $(t,this.client.options.headers),new Ct(this.client,"/stats",t,r,function(a,u,g){const m=g?a:JSON.parse(a);for(let S=0;S<m.length;S++)m[S]=bu.fromValues(m[S]);return m}).get(e)}async time(e){const t=ee.defaultGetHeaders(this.client.options);this.client.options.headers&&$(t,this.client.options.headers);const i=m=>this.client.baseUri(m)+"/time";let{error:r,body:a,unpacked:u}=await this.client.http.do(Ee.Get,i,t,null,e);if(r)throw r;u||(a=JSON.parse(a));const g=a[0];if(!g)throw new R("Internal error (unexpected result type from GET /time)",5e4,500);return this.client.serverTimeOffset=g-Date.now(),g}async request(e,t,i,r,a,u){var g;const[m,S,C]=this.client.options.useBinaryProtocol?(this.client._MsgPack||Ve("MsgPack"),[this.client._MsgPack.encode,this.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"],I=this.client.http.supportsLinkHeaders?void 0:C;r=r||{};const E=e.toLowerCase(),G=E=="get"?ee.defaultGetHeaders(this.client.options,{format:C,protocolVersion:i}):ee.defaultPostHeaders(this.client.options,{format:C,protocolVersion:i});typeof a!="string"&&(a=(g=m(a))!=null?g:null),$(G,this.client.options.headers),u&&$(G,u);const k=new Ct(this.client,t,G,I,async function(F,V,Y){return wt(Y?F:S(F))},!0);if(!_.Http.methods.includes(E))throw new R("Unsupported method "+E,40500,405);return _.Http.methodsWithBody.includes(E)?k[E](r,a):k[E](r)}async batchPublish(e){let t,i;Array.isArray(e)?(t=e,i=!1):(t=[e],i=!0);const r=this.client.options.useBinaryProtocol?"msgpack":"json",a=ee.defaultPostHeaders(this.client.options,{format:r});this.client.options.headers&&$(a,this.client.options.headers);const u=Ae(t,this.client._MsgPack,r),g=await Ne.post(this.client,"/messages",u,a,{},null,!0),m=g.unpacked?g.body:se(g.body,this.client._MsgPack,r);return i?m[0]:m}async batchPresence(e){const t=this.client.options.useBinaryProtocol?"msgpack":"json",i=ee.defaultPostHeaders(this.client.options,{format:t});this.client.options.headers&&$(i,this.client.options.headers);const r=e.join(","),a=await Ne.get(this.client,"/presence",i,{channels:r},null,!0);return a.unpacked?a.body:se(a.body,this.client._MsgPack,t)}async revokeTokens(e,t){if(oo(this.client.options))throw new R("Cannot revoke tokens when using token auth",40162,401);const i=this.client.options.keyName;let r=t??{};const a=U({targets:e.map(C=>`${C.type}:${C.value}`)},r),u=this.client.options.useBinaryProtocol?"msgpack":"json",g=ee.defaultPostHeaders(this.client.options,{format:u});this.client.options.headers&&$(g,this.client.options.headers);const m=Ae(a,this.client._MsgPack,u),S=await Ne.post(this.client,`/keys/${i}/revokeTokens`,m,g,{},null,!0);return S.unpacked?S.body:se(S.body,this.client._MsgPack,u)}},wu=class{constructor(e){this.client=e,this.all=Object.create(null)}get(e,t){e=String(e);let i=this.all[e];return i?t&&i.setOptions(t):this.all[e]=i=new mu(this.client,e,t),i}release(e){delete this.all[String(e)]}},Cu=class extends mo{constructor(e){super(ee.objectifyOptions(e,!1,"BaseRest",h.defaultLogger,{Rest:Po}))}},ko={Rest:Po},Eo=class extends qt{static async fromEncoded(e,t){return Ao(h.defaultLogger,_.Crypto,e,t)}static async fromEncodedArray(e,t){return lu(h.defaultLogger,_.Crypto,e,t)}static fromValues(e){return qt.fromValues(e)}},Io=class extends jt{static async fromEncoded(e,t){return Co(h.defaultLogger,_.Crypto,e,t)}static async fromEncodedArray(e,t){return su(h.defaultLogger,_.Crypto,e,t)}static fromValues(e){return jt.fromValues(e)}},xo=["annotation.create","annotation.delete"];async function Lo(e,t,i){return bn.fromValues(t).decode(i||{},e)}async function _u(e,t,i){return Promise.all(t.map(function(r){return Lo(e,r,i)}))}async function Su(e,t){return bn.fromValues(e).decode(t.channelOptions,t.logger)}async function Ou(e,t){return Promise.all(e.map(function(i){return Su(i,t)}))}var No=class Rr extends mn{async encode(){const t=Object.assign(new bn,this,{action:xo.indexOf(this.action||"annotation.create")});return Oi(t,{})}static fromValues(t){return Object.assign(new Rr,t)}static fromValuesArray(t){return t.map(i=>Rr.fromValues(i))}toString(){return pn(this,"Annotation")}},bn=class Tr extends mn{toJSON(...t){return Ri.call(this,...t)}static fromValues(t){return Object.assign(new Tr,t)}static fromValuesArray(t){return t.map(i=>Tr.fromValues(i))}async decode(t,i){const r=Object.assign(new No,J(U({},this),{action:xo[this.action]}));try{await Ai(r,t)}catch(a){h.logAction(i,h.LOG_ERROR,"WireAnnotation.decode()",P(a))}return r}toString(){return pn(this,"WireAnnotation")}},Gn=No,Uo=class extends Gn{static async fromEncoded(e,t){return Lo(h.defaultLogger,e,t)}static async fromEncodedArray(e,t){return _u(h.defaultLogger,e,t)}static fromValues(e){return Gn.fromValues(e)}};function Bo(e){let t;switch(typeof e){case"string":t=e;break;case"object":t=e.serial;break}if(!t||typeof t!="string")throw new R("First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)",40003,400);return t}function Do(e,t){const i=Bo(e);if(!t||typeof t!="object")throw new R("Second argument of annotations.publish() must be an object (the intended annotation to publish)",40003,400);const r=Gn.fromValues(t);return r.messageSerial=i,r.action||(r.action="annotation.create"),r}function Ho(e,t){return e.client.rest.channelMixin.basePath(e)+"/messages/"+encodeURIComponent(t)+"/annotations"}var Au=class{constructor(e){this.channel=e}async publish(e,t){const i=Do(e,t),r=await i.encode(),a=this.channel.client,u=a.options,g=u.useBinaryProtocol?"msgpack":"json",m=ee.defaultPostHeaders(a.options,{format:g}),S={};$(m,a.options.headers);const C=Ae([r],a._MsgPack,g);await Ne.post(a,Ho(this.channel,i.messageSerial),C,m,S,null,!0)}async delete(e,t){return t.action="annotation.delete",this.publish(e,t)}async get(e,t){const i=this.channel.client,r=Bo(e),a=i.options.useBinaryProtocol?"msgpack":"json",u=i.http.supportsLinkHeaders?void 0:a,g=ee.defaultGetHeaders(i.options,{format:a});return $(g,i.options.headers),new Ct(i,Ho(this.channel,r),g,u,async(m,S,C)=>{const I=C?m:se(m,i._MsgPack,a);return Ou(I,this.channel)}).get(t)}},Mi=Au,Ru=Ae;function xs(e){const t=[];if(e)for(let i=0;i<e.length;i++)t.push(e[i].toString());return"[ "+t.join(", ")+" ]"}function Tu(e,t,i,r,a,u){const g=se(e,t,u);return Pi(g,i,r,a)}function Pi(e,t,i,r){let a;e.error&&(a=R.fromValues(e.error));let u;e.messages&&(u=Hn.fromValuesArray(e.messages));let g;t&&e.presence&&(g=t.WirePresenceMessage.fromValuesArray(e.presence));let m;i&&e.annotations&&(m=i.WireAnnotation.fromValuesArray(e.annotations));let S;return r&&e.state&&(S=r.ObjectMessage.fromValuesArray(e.state,W,ks)),Object.assign(new Ei,J(U({},e),{presence:g,messages:u,annotations:m,state:S,error:a}))}function Go(e){return t=>{var i;return Pi(t,{WirePresenceMessage:Dn},{WireAnnotation:bn},(i=e==null?void 0:e.ObjectsPlugin)!=null?i:null)}}function lt(e){return Object.assign(new Ei,e)}function ki(e,t,i,r){let a="[ProtocolMessage";e.action!==void 0&&(a+="; action="+ao[e.action]||e.action);const u=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"];let g;for(let m=0;m<u.length;m++)g=u[m],e[g]!==void 0&&(a+="; "+g+"="+e[g]);if(e.messages&&(a+="; messages="+xs(Hn.fromValuesArray(e.messages))),e.presence&&t&&(a+="; presence="+xs(t.WirePresenceMessage.fromValuesArray(e.presence))),e.annotations&&i&&(a+="; annotations="+xs(i.WireAnnotation.fromValuesArray(e.annotations))),e.state&&r&&(a+="; state="+xs(r.ObjectMessage.fromValuesArray(e.state,W,ks))),e.error&&(a+="; error="+R.fromValues(e.error).toString()),e.auth&&e.auth.accessToken&&(a+="; token="+e.auth.accessToken),e.flags&&(a+="; flags="+Hl.filter(e.hasFlag).join(",")),e.params){let m="";M(e.params,function(S){m.length>0&&(m+="; "),m+=S+"="+e.params[S]}),m.length>0&&(a+="; params=["+m+"]")}return a+="]",a}var Ei=class{constructor(){this.hasFlag=e=>(this.flags&tt[e])>0}setFlag(e){return this.flags=this.flags|tt[e]}getMode(){return(this.flags||0)&tt.MODE_ALL}encodeModesToFlags(e){e.forEach(t=>this.setFlag(t))}decodeModesFromFlags(){const e=[];return co.forEach(t=>{this.hasFlag(t)&&e.push(t)}),e.length>0?e:void 0}},Mu=Ei,Pu=class{constructor(e,t,i,r,a){this.previous=e,this.current=t,t==="attached"&&(this.resumed=i,this.hasBacklog=r),a&&(this.reason=a)}},Ii=Pu,jo=function(){};function ku(e){if(e&&"params"in e&&!mt(e.params))return new R("options.params must be an object",4e4,400);if(e&&"modes"in e){if(!Array.isArray(e.modes))return new R("options.modes must be an array",4e4,400);for(let t=0;t<e.modes.length;t++){const i=e.modes[t];if(!i||typeof i!="string"||!co.includes(String.prototype.toUpperCase.call(i)))return new R("Invalid channel mode: "+i,4e4,400)}}}var Eu=class Mr extends Be{constructor(t,i,r){var a,u,g;super(t.logger),this._annotations=null,this._mode=0,this.retryCount=0,this.history=async function(m){h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name);const S=this.client.rest.channelMixin;if(m&&m.untilAttach){if(this.state!=="attached")throw new R("option untilAttach requires the channel to be attached",4e4,400);if(!this.properties.attachSerial)throw new R("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);delete m.untilAttach,m.from_serial=this.properties.attachSerial}return S.history(this,m)},this.whenState=m=>Be.prototype.whenState.call(this,m,this.state),h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel()","started; name = "+i),this.name=i,this.channelOptions=Ts((a=t._Crypto)!=null?a:null,this.logger,r),this.client=t,this._presence=t._RealtimePresence?new t._RealtimePresence.RealtimePresence(this):null,t._Annotations&&(this._annotations=new t._Annotations.RealtimeAnnotations(this)),this.connectionManager=t.connection.connectionManager,this.state="initialized",this.subscriptions=new Be(this.logger),this.syncChannelSerial=void 0,this.properties={attachSerial:void 0,channelSerial:void 0},this.setOptions(r),this.errorReason=null,this._attachResume=!1,this._decodingContext={channelOptions:this.channelOptions,plugins:t.options.plugins||{},baseEncodedPreviousPayload:void 0},this._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},this._allChannelChanges=new Be(this.logger),(u=t.options.plugins)!=null&&u.Push&&(this._push=new t.options.plugins.Push.PushChannel(this)),(g=t.options.plugins)!=null&&g.Objects&&(this._objects=new t.options.plugins.Objects.Objects(this))}get presence(){return this._presence||Ve("RealtimePresence"),this._presence}get annotations(){return this._annotations||Ve("Annotations"),this._annotations}get push(){return this._push||Ve("Push"),this._push}get objects(){return this._objects||Ve("Objects"),this._objects}invalidStateError(){return new R("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}static processListenerArgs(t){return t=Array.prototype.slice.call(t),typeof t[0]=="function"&&t.unshift(null),t}async setOptions(t){var i;const r=this.channelOptions,a=ku(t);if(a)throw a;if(this.channelOptions=Ts((i=this.client._Crypto)!=null?i:null,this.logger,t),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(t,r))return this.attachImpl(),new Promise((u,g)=>{this._allChannelChanges.once(["attached","update","detached","failed"],function(m){switch(this.event){case"update":case"attached":u();break;default:g(m.reason)}})})}_shouldReattachToSetOptions(t,i){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(t!=null&&t.params){const r=qo(t.params),a=qo(i.params);if(Object.keys(r).length!==Object.keys(a).length||!ct(a,r))return!0}return!!(t!=null&&t.modes&&(!i.modes||!Kr(t.modes,i.modes)))}async publish(...t){let i;if(t.length==1)if(mt(t[0]))i=[qt.fromValues(t[0])];else if(Array.isArray(t[0]))i=qt.fromValuesArray(t[0]);else throw new R("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else i=[qt.fromValues({name:t[0],data:t[1]})];const a=this.client.options.maxMessageSize,u=await Ro(i,this.channelOptions),g=Ti(u);if(g>a)throw new R(`Maximum size of messages that can be published at once exceeded (was ${g} bytes; limit is ${a} bytes)`,40009,400);this.throwIfUnpublishableState(),h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+this.state+", message count = "+u.length);const m=lt({action:Q.MESSAGE,channel:this.name,messages:u});return this.sendMessage(m)}throwIfUnpublishableState(){if(!this.connectionManager.activeState())throw this.connectionManager.getError();if(this.state==="failed"||this.state==="suspended")throw this.invalidStateError()}onEvent(t){h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.onEvent()","received message");const i=this.subscriptions;for(let r=0;r<t.length;r++){const a=t[r];i.emit(a.name,a)}}async attach(){return this.state==="attached"?null:new Promise((t,i)=>{this._attach(!1,null,(r,a)=>r?i(r):t(a))})}_attach(t,i,r){r||(r=u=>{u&&h.logAction(this.logger,h.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+u.toString())});const a=this.connectionManager;if(!a.activeState()){r(a.getError());return}(this.state!=="attaching"||t)&&this.requestState("attaching",i),this.once(function(u){switch(this.event){case"attached":r==null||r(null,u);break;case"detached":case"suspended":case"failed":r==null||r(u.reason||a.getError()||new R("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":r==null||r(new R("Attach request superseded by a subsequent detach request",9e4,409));break}})}attachImpl(){h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");const t=lt({action:Q.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this.channelOptions.modes&&t.encodeModesToFlags(ot(this.channelOptions.modes)),this._attachResume&&t.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(t.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(t).catch(jo)}async detach(){const t=this.connectionManager;if(!t.activeState())throw t.getError();switch(this.state){case"suspended":this.notifyState("detached");return;case"detached":return;case"failed":throw new R("Unable to detach; channel state = failed",90001,400);default:this.requestState("detaching");case"detaching":return new Promise((i,r)=>{this.once(function(a){switch(this.event){case"detached":i();break;case"attached":case"suspended":case"failed":r(a.reason||t.getError()||new R("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":r(new R("Detach request superseded by a subsequent attach request",9e4,409));break}})})}}detachImpl(){h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");const t=lt({action:Q.DETACH,channel:this.name});this.sendMessage(t).catch(jo)}async subscribe(...t){const[i,r]=Mr.processListenerArgs(t);if(this.state==="failed")throw R.fromValues(this.invalidStateError());return i&&typeof i=="object"&&!Array.isArray(i)?this.client._FilteredSubscriptions.subscribeFilter(this,i,r):this.subscriptions.on(i,r),this.channelOptions.attachOnSubscribe!==!1?this.attach():null}unsubscribe(...t){var i;const[r,a]=Mr.processListenerArgs(t);if(typeof r=="object"&&!a||(i=this.filteredSubscriptions)!=null&&i.has(a)){this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,r,a).forEach(u=>this.subscriptions.off(u));return}this.subscriptions.off(r,a)}sync(){switch(this.state){case"initialized":case"detaching":case"detached":throw new _e("Unable to sync to channel; not attached",4e4)}const t=this.connectionManager;if(!t.activeState())throw t.getError();const i=lt({action:Q.SYNC,channel:this.name});this.syncChannelSerial&&(i.channelSerial=this.syncChannelSerial),t.send(i)}async sendMessage(t){return new Promise((i,r)=>{this.connectionManager.send(t,this.client.options.queueMessages,a=>{a?r(a):i()})})}async sendPresence(t){const i=lt({action:Q.PRESENCE,channel:this.name,presence:t});return this.sendMessage(i)}sendState(t){const i=lt({action:Q.OBJECT,channel:this.name,state:t});return this.sendMessage(i)}async processMessage(t){(t.action===Q.ATTACHED||t.action===Q.MESSAGE||t.action===Q.PRESENCE||t.action===Q.OBJECT||t.action===Q.ANNOTATION)&&this.setChannelSerial(t.channelSerial);let i,r=!1;switch(t.action){case Q.ATTACHED:{this.properties.attachSerial=t.channelSerial,this._mode=t.getMode(),this.params=t.params||{};const a=t.decodeModesFromFlags();this.modes=a&&Ue(a)||void 0;const u=t.hasFlag("RESUMED"),g=t.hasFlag("HAS_PRESENCE"),m=t.hasFlag("HAS_BACKLOG"),S=t.hasFlag("HAS_OBJECTS");if(this.state==="attached"){u||(this._presence&&this._presence.onAttached(g),this._objects&&this._objects.onAttached(S));const C=new Ii(this.state,this.state,u,m,t.error);this._allChannelChanges.emit("update",C),(!u||this.channelOptions.updateOnAttached)&&this.emit("update",C)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",t.error,u,g,m,S);break}case Q.DETACHED:{const a=t.error?R.fromValues(t.error):new R("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",a):this.state==="attaching"?this.notifyState("suspended",a):(this.state==="attached"||this.state==="suspended")&&this.requestState("attaching",a);break}case Q.SYNC:if(r=!0,i=this.syncChannelSerial=t.channelSerial,!t.presence)break;case Q.PRESENCE:{if(!t.presence)break;Es(t);const a=this.channelOptions;if(this._presence){const u=await Promise.all(t.presence.map(g=>g.decode(a,this.logger)));this._presence.setPresence(u,r,i)}break}case Q.OBJECT:case Q.OBJECT_SYNC:{if(!this._objects||!t.state)return;Es(t);const a=t.state,u=this.client.connection.connectionManager.getActiveTransportFormat();await Promise.all(a.map(g=>this.client._objectsPlugin.ObjectMessage.decode(g,this.client,this.logger,h,W,u))),t.action===Q.OBJECT?this._objects.handleObjectMessages(a):this._objects.handleObjectSyncMessages(a,t.channelSerial);break}case Q.MESSAGE:{if(this.state!=="attached"){h.logAction(this.logger,h.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+t.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}Es(t);const a=t.messages,u=a[0],g=a[a.length-1];if(u.extras&&u.extras.delta&&u.extras.delta.from!==this._lastPayload.messageId){const S='Delta message decode failure - previous message not available for message "'+t.id+'" on this channel "'+this.name+'".';h.logAction(this.logger,h.LOG_ERROR,"RealtimeChannel.processMessage()",S),this._startDecodeFailureRecovery(new R(S,40018,400));break}let m=[];for(let S=0;S<a.length;S++){const{decoded:C,err:I}=await a[S].decodeWithErr(this._decodingContext,this.logger);if(m[S]=C,I)switch(I.code){case 40018:this._startDecodeFailureRecovery(I);return;case 40019:case 40021:this.notifyState("failed",I);return}}this._lastPayload.messageId=g.id,this._lastPayload.protocolMessageChannelSerial=t.channelSerial,this.onEvent(m);break}case Q.ANNOTATION:{Es(t);const a=this.channelOptions;if(this._annotations){const u=await Promise.all((t.annotations||[]).map(g=>g.decode(a,this.logger)));this._annotations._processIncoming(u)}break}case Q.ERROR:{const a=t.error;a&&a.code==80016?this.checkPendingState():this.notifyState("failed",R.fromValues(a));break}default:h.logAction(this.logger,h.LOG_MAJOR,"RealtimeChannel.processMessage()","Protocol error: unrecognised message action ("+t.action+")")}}_startDecodeFailureRecovery(t){this._lastPayload.decodeFailureRecoveryInProgress||(h.logAction(this.logger,h.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,t,()=>{this._lastPayload.decodeFailureRecoveryInProgress=!1}))}onAttached(){h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}notifyState(t,i,r,a,u,g){if(h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+t),this.clearStateTimer(),["detached","suspended","failed"].includes(t)&&(this.properties.channelSerial=null),t===this.state)return;this._presence&&this._presence.actOnChannelState(t,a,i),this._objects&&this._objects.actOnChannelState(t,g),t==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),i&&(this.errorReason=i);const m=new Ii(this.state,t,r,u,i),S='Channel state for channel "'+this.name+'"',C=t+(i?"; reason: "+i:"");t==="failed"?h.logAction(this.logger,h.LOG_ERROR,S,C):h.logAction(this.logger,h.LOG_MAJOR,S,C),t!=="attaching"&&t!=="suspended"&&(this.retryCount=0),t==="attached"&&this.onAttached(),t==="attached"?this._attachResume=!0:(t==="detaching"||t==="failed")&&(this._attachResume=!1),this.state=t,this._allChannelChanges.emit(t,m),this.emit(t,m)}requestState(t,i){h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+t),this.notifyState(t,i),this.checkPendingState()}checkPendingState(){if(!this.connectionManager.state.sendEvents){h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}}timeoutPendingState(){switch(this.state){case"attaching":{const t=new R("Channel attach timed out",90007,408);this.notifyState("suspended",t);break}case"detaching":{const t=new R("Channel detach timed out",90007,408);this.notifyState("attached",t);break}default:this.checkPendingState();break}}startStateTimerIfNotRunning(){this.stateTimer||(this.stateTimer=setTimeout(()=>{h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),this.stateTimer=null,this.timeoutPendingState()},this.client.options.timeouts.realtimeRequestTimeout))}clearStateTimer(){const t=this.stateTimer;t&&(clearTimeout(t),this.stateTimer=null)}startRetryTimer(){if(this.retryTimer)return;this.retryCount++;const t=dn(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(()=>{this.state==="suspended"&&this.connectionManager.state.sendEvents&&(this.retryTimer=null,h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),this.requestState("attaching"))},t)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}getReleaseErr(){const t=this.state;return t==="initialized"||t==="detached"||t==="failed"?null:new R("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+t,90001,400)}setChannelSerial(t){h.logAction(this.logger,h.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+t+"; previous = "+this.properties.channelSerial),t&&(this.properties.channelSerial=t)}async status(){return this.client.rest.channelMixin.status(this)}};function qo(e){const t=e||{},{agent:i}=t;return re(t,["agent"])}var jn=Eu,Iu=class{constructor(e){this.channel=e,this.logger=e.logger,this.subscriptions=new Be(this.logger)}async publish(e,t){const i=this.channel.name,r=Do(e,t),a=await r.encode();this.channel.throwIfUnpublishableState(),h.logAction(this.logger,h.LOG_MICRO,"RealtimeAnnotations.publish()","channelName = "+i+", sending annotation with messageSerial = "+r.messageSerial+", type = "+r.type);const u=lt({action:Q.ANNOTATION,channel:i,annotations:[a]});return this.channel.sendMessage(u)}async delete(e,t){return t.action="annotation.delete",this.publish(e,t)}async subscribe(...e){const t=jn.processListenerArgs(e),i=t[0],r=t[1],a=this.channel;if(a.state==="failed")throw R.fromValues(a.invalidStateError());if(this.subscriptions.on(i,r),this.channel.channelOptions.attachOnSubscribe!==!1&&await a.attach(),(this.channel.state==="attached"&&this.channel._mode&tt.ANNOTATION_SUBSCRIBE)===0)throw new R("You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)",93001,400)}unsubscribe(...e){const t=jn.processListenerArgs(e),i=t[0],r=t[1];this.subscriptions.off(i,r)}_processIncoming(e){for(const t of e)this.subscriptions.emit(t.type||"",t)}async get(e,t){return Mi.prototype.get.call(this,e,t)}},Fo=Iu,en=class Ks extends Cu{constructor(t){var i,r;if(!Ks._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");super(ee.objectifyOptions(t,!0,"Rest",h.defaultLogger,J(U({},ko),{Crypto:(i=Ks.Crypto)!=null?i:void 0,MsgPack:(r=Ks._MsgPack)!=null?r:void 0,Annotations:{Annotation:Gn,WireAnnotation:bn,RealtimeAnnotations:Fo,RestAnnotations:Mi}})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(t){this._Crypto=t}};en._Crypto=null,en.Message=Eo,en.PresenceMessage=Io,en.Annotation=Uo,en._MsgPack=null,en._Http=_i;var xi=en,xu=class extends Be{constructor(e){super(e),this.messages=[]}count(){return this.messages.length}push(e){this.messages.push(e)}shift(){return this.messages.shift()}last(){return this.messages[this.messages.length-1]}copyAll(){return this.messages.slice()}append(e){this.messages.push.apply(this.messages,e)}prepend(e){this.messages.unshift.apply(this.messages,e)}completeMessages(e,t,i){h.logAction(this.logger,h.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+e+"; count = "+t),i=i||null;const r=this.messages;if(r.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");const a=r[0];if(a){const u=a.message.msgSerial,g=e+t;if(g>u){const m=r.splice(0,g-u);for(const S of m)S.callback(i)}r.length==0&&this.emit("idle")}}completeAllMessages(e){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,e)}resetSendAttempted(){for(let e of this.messages)e.sendAttempted=!1}clear(){h.logAction(this.logger,h.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}},Vo=xu,Wo=class{constructor(e,t){this.message=e,this.callback=t,this.merged=!1;const i=e.action;this.sendAttempted=!1,this.ackRequired=typeof i=="number"&&[Q.MESSAGE,Q.PRESENCE,Q.ANNOTATION,Q.OBJECT].includes(i)}},Lu=class extends Be{constructor(e){super(e.logger),this.transport=e,this.messageQueue=new Vo(this.logger),e.on("ack",(t,i)=>{this.onAck(t,i)}),e.on("nack",(t,i,r)=>{this.onNack(t,i,r)})}onAck(e,t){h.logAction(this.logger,h.LOG_MICRO,"Protocol.onAck()","serial = "+e+"; count = "+t),this.messageQueue.completeMessages(e,t)}onNack(e,t,i){h.logAction(this.logger,h.LOG_ERROR,"Protocol.onNack()","serial = "+e+"; count = "+t+"; err = "+P(i)),i||(i=new R("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(e,t,i)}onceIdle(e){const t=this.messageQueue;if(t.count()===0){e();return}t.once("idle",e)}send(e){e.ackRequired&&this.messageQueue.push(e),this.logger.shouldLog(h.LOG_MICRO)&&h.logActionNoStrip(this.logger,h.LOG_MICRO,"Protocol.send()","sending msg; "+ki(e.message,this.transport.connectionManager.realtime._RealtimePresence,this.transport.connectionManager.realtime._Annotations,this.transport.connectionManager.realtime._objectsPlugin)),e.sendAttempted=!0,this.transport.send(e.message)}getTransport(){return this.transport}getPendingMessages(){return this.messageQueue.copyAll()}clearPendingMessages(){return this.messageQueue.clear()}finish(){const e=this.transport;this.onceIdle(function(){e.disconnect()})}},Nu=Lu,Uu=class{constructor(e,t,i,r){this.previous=e,this.current=t,i&&(this.retryIn=i),r&&(this.reason=r)}},Ls=Uu,Ft={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},Bu={disconnected:()=>R.fromValues({statusCode:400,code:Ft.DISCONNECTED,message:"Connection to server temporarily unavailable"}),suspended:()=>R.fromValues({statusCode:400,code:Ft.SUSPENDED,message:"Connection to server unavailable"}),failed:()=>R.fromValues({statusCode:400,code:Ft.FAILED,message:"Connection failed or disconnected by server"}),closing:()=>R.fromValues({statusCode:400,code:Ft.CLOSING,message:"Connection closing"}),closed:()=>R.fromValues({statusCode:400,code:Ft.CLOSED,message:"Connection closed"}),unknownConnectionErr:()=>R.fromValues({statusCode:500,code:Ft.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"}),unknownChannelErr:()=>R.fromValues({statusCode:500,code:Ft.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})};function Du(e){return!e.statusCode||!e.code||e.statusCode>=500?!0:Object.values(Ft).includes(e.code)}var tn=Bu,Hu=lt({action:Q.CLOSE}),Gu=lt({action:Q.DISCONNECT}),ju=class extends Be{constructor(e,t,i,r){super(e.logger),r&&(i.format=void 0,i.heartbeats=!0),this.connectionManager=e,this.auth=t,this.params=i,this.timeouts=i.options.timeouts,this.format=i.format,this.isConnected=!1,this.isFinished=!1,this.isDisposed=!1,this.maxIdleInterval=null,this.idleTimer=null,this.lastActivity=null}connect(){}close(){this.isConnected&&this.requestClose(),this.finish("closed",tn.closed())}disconnect(e){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",e||tn.disconnected())}fail(e){this.isConnected&&this.requestDisconnect(),this.finish("failed",e||tn.failed())}finish(e,t){var i;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((i=this.idleTimer)!=null?i:void 0),this.idleTimer=null,this.emit(e,t),this.dispose())}onProtocolMessage(e){switch(this.logger.shouldLog(h.LOG_MICRO)&&h.logActionNoStrip(this.logger,h.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+ki(e,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),e.action){case Q.HEARTBEAT:h.logActionNoStrip(this.logger,h.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",e.id);break;case Q.CONNECTED:this.onConnect(e),this.emit("connected",e.error,e.connectionId,e.connectionDetails,e);break;case Q.CLOSED:this.onClose(e);break;case Q.DISCONNECTED:this.onDisconnect(e);break;case Q.ACK:this.emit("ack",e.msgSerial,e.count);break;case Q.NACK:this.emit("nack",e.msgSerial,e.count,e.error);break;case Q.SYNC:this.connectionManager.onChannelMessage(e,this);break;case Q.ACTIVATE:break;case Q.AUTH:oe(this.auth.authorize(),t=>{t&&h.logAction(this.logger,h.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+P(t))});break;case Q.ERROR:if(h.logAction(this.logger,h.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+_.Config.inspect(e.error)+(e.channel?", channel: "+e.channel:"")),e.channel===void 0){this.onFatalError(e);break}this.connectionManager.onChannelMessage(e,this);break;default:this.connectionManager.onChannelMessage(e,this)}}onConnect(e){if(this.isConnected=!0,!e.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");const t=e.connectionDetails.maxIdleInterval;t&&(this.maxIdleInterval=t+this.timeouts.realtimeRequestTimeout,this.onActivity())}onDisconnect(e){const t=e&&e.error;h.logAction(this.logger,h.LOG_MINOR,"Transport.onDisconnect()","err = "+P(t)),this.finish("disconnected",t)}onFatalError(e){const t=e&&e.error;h.logAction(this.logger,h.LOG_MINOR,"Transport.onFatalError()","err = "+P(t)),this.finish("failed",t)}onClose(e){const t=e&&e.error;h.logAction(this.logger,h.LOG_MINOR,"Transport.onClose()","err = "+P(t)),this.finish("closed",t)}requestClose(){h.logAction(this.logger,h.LOG_MINOR,"Transport.requestClose()",""),this.send(Hu)}requestDisconnect(){h.logAction(this.logger,h.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(Gu)}ping(e){const t={action:Q.HEARTBEAT};e&&(t.id=e),this.send(lt(t))}dispose(){h.logAction(this.logger,h.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}onActivity(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}setIdleTimer(e){this.idleTimer||(this.idleTimer=setTimeout(()=>{this.onIdleTimerExpire()},e))}onIdleTimerExpire(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;const e=Date.now()-this.lastActivity,t=this.maxIdleInterval-e;if(t<=0){const i="No activity seen from realtime in "+e+"ms; assuming connection has dropped";h.logAction(this.logger,h.LOG_ERROR,"Transport.onIdleTimerExpire()",i),this.disconnect(new R(i,80003,408))}else this.setIdleTimer(t+100)}static tryConnect(e,t,i,r,a){const u=new e(t,i,r);let g;const m=function(C){clearTimeout(g),a({event:this.event,error:C})},S=t.options.timeouts.realtimeRequestTimeout;return g=setTimeout(()=>{u.off(["preconnect","disconnected","failed"]),u.dispose(),m.call({event:"disconnected"},new R("Timeout waiting for transport to indicate itself viable",5e4,500))},S),u.on(["failed","disconnected"],m),u.on("preconnect",function(){h.logAction(t.logger,h.LOG_MINOR,"Transport.tryConnect()","viable transport "+u),clearTimeout(g),u.off(["failed","disconnected"],m),a(null,u)}),u.connect(),u}static isAvailable(){throw new R("isAvailable not implemented for transport",5e4,500)}},vn=ju,nt;(e=>{e.WebSocket="web_socket",e.Comet="comet",e.XhrPolling="xhr_polling"})(nt||(nt={}));var qu=typeof Wt<"u"?Wt:typeof window<"u"?window:self,Li=()=>{var e;return typeof _.WebStorage<"u"&&((e=_.WebStorage)==null?void 0:e.localSupported)},qn=()=>{var e;return typeof _.WebStorage<"u"&&((e=_.WebStorage)==null?void 0:e.sessionSupported)},$o=function(){},Ni="ably-transport-preference";function Fu(e,t,i){let r;if(e.channel!==t.channel||(r=e.action)!==Q.PRESENCE&&r!==Q.MESSAGE||r!==t.action)return!1;const a=r===Q.PRESENCE?"presence":"messages",u=e[a].concat(t[a]);return Ti(u)>i||!N(u,"clientId")||!u.every(function(m){return!m.id})?!1:(e[a]=u,!0)}function Ui(e){try{return JSON.parse(e)}catch{return null}}var Vu=class{constructor(e,t,i,r){this.options=e,this.host=t,this.mode=i,this.connectionKey=r,this.format=e.useBinaryProtocol?"msgpack":"json"}getConnectParams(e){const t=e?le(e):{},i=this.options;switch(this.mode){case"resume":t.resume=this.connectionKey;break;case"recover":{const r=Ui(i.recover);r&&(t.recover=r.connectionKey);break}}return i.clientId!==void 0&&(t.clientId=i.clientId),i.echoMessages===!1&&(t.echo="false"),this.format!==void 0&&(t.format=this.format),this.stream!==void 0&&(t.stream=this.stream),this.heartbeats!==void 0&&(t.heartbeats=this.heartbeats),t.v=ee.protocolVersion,t.agent=bi(this.options),i.transportParams!==void 0&&$(t,i.transportParams),t}toString(){let e="[mode="+this.mode;return this.host&&(e+=",host="+this.host),this.connectionKey&&(e+=",connectionKey="+this.connectionKey),this.format&&(e+=",format="+this.format),e+="]",e}},Wu=class hl extends Be{constructor(t,i){super(t.logger),this.supportedTransports={},this.disconnectedRetryCount=0,this.pendingChannelMessagesState={isProcessing:!1,queue:[]},this.realtime=t,this.initTransports(),this.options=i;const r=i.timeouts,a=r.webSocketConnectTimeout+r.realtimeRequestTimeout;if(this.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:a,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:r.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:r.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:r.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},this.state=this.states.initialized,this.errorReason=null,this.queuedMessages=new Vo(this.logger),this.msgSerial=0,this.connectionDetails=void 0,this.connectionId=void 0,this.connectionKey=void 0,this.connectionStateTtl=r.connectionStateTtl,this.maxIdleInterval=null,this.transports=Zt(i.transports||ee.defaultTransports,this.supportedTransports),this.transportPreference=null,this.transports.includes(nt.WebSocket)&&(this.webSocketTransportAvailable=!0),this.transports.includes(nt.XhrPolling)?this.baseTransport=nt.XhrPolling:this.transports.includes(nt.Comet)&&(this.baseTransport=nt.Comet),this.httpHosts=ee.getHosts(i),this.wsHosts=ee.getHosts(i,!0),this.activeProtocol=null,this.host=null,this.lastAutoReconnectAttempt=null,this.lastActivity=null,this.forceFallbackHost=!1,this.connectCounter=0,this.wsCheckResult=null,this.webSocketSlowTimer=null,this.webSocketGiveUpTimer=null,this.abandonedWebSocket=!1,h.logAction(this.logger,h.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.logAction(this.logger,h.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(i.transports||ee.defaultTransports)+"]"),h.logAction(this.logger,h.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+this.transports+"]"),h.logAction(this.logger,h.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+this.httpHosts+"]"),!this.transports.length){const g="no requested transports available";throw h.logAction(this.logger,h.LOG_ERROR,"realtime.ConnectionManager()",g),new Error(g)}const u=_.Config.addEventListener;u&&(qn()&&typeof i.recover=="function"&&u("beforeunload",this.persistConnection.bind(this)),i.closeOnUnload===!0&&u("beforeunload",()=>{h.logAction(this.logger,h.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),this.requestState({state:"closing"})}),u("online",()=>{var g;this.state==this.states.disconnected||this.state==this.states.suspended?(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),this.requestState({state:"connecting"})):this.state==this.states.connecting&&((g=this.pendingTransport)==null||g.off(),this.disconnectAllTransports(),this.startConnect())}),u("offline",()=>{this.state==this.states.connected&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),this.disconnectAllTransports())}))}static supportedTransports(t){const i={supportedTransports:{}};return this.initTransports(t,i),i.supportedTransports}static initTransports(t,i){const r=U(U({},_.Transports.bundledImplementations),t);[nt.WebSocket,..._.Transports.order].forEach(a=>{const u=r[a];u&&u.isAvailable()&&(i.supportedTransports[a]=u)})}initTransports(){hl.initTransports(this.realtime._additionalTransportImplementations,this)}createTransportParams(t,i){return new Vu(this.options,t,i,this.connectionKey)}getTransportParams(t){(r=>{if(this.connectionKey){r("resume");return}if(typeof this.options.recover=="string"){r("recover");return}const a=this.options.recover,u=this.getSessionRecoverData(),g=this.sessionRecoveryName();if(u&&typeof a=="function"){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+g+")"),a(u,m=>{m?(this.options.recover=u.recoveryKey,r("recover")):r("clean")});return}r("clean")})(r=>{const a=this.createTransportParams(null,r);if(r==="recover"){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+this.options.recover);const u=Ui(this.options.recover);u&&(this.msgSerial=u.msgSerial)}else h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+a.toString());t(a)})}tryATransport(t,i,r){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+i),this.proposedTransport=vn.tryConnect(this.supportedTransports[i],this,this.realtime.auth,t,(a,u)=>{const g=this.state;if(g==this.states.closing||g==this.states.closed||g==this.states.failed){u&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+g.state+" while we were attempting the transport; closing "+u),u.close()),r(!0);return}if(a){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+i+" "+a.event+", err: "+a.error.toString()),Mt.isTokenErr(a.error)&&!(this.errorReason&&Mt.isTokenErr(this.errorReason))?(this.errorReason=a.error,oe(this.realtime.auth._forceNewToken(null,null),m=>{if(m){this.actOnErrorFromAuthorize(m);return}this.tryATransport(t,i,r)})):a.event==="failed"?(this.notifyState({state:"failed",error:a.error}),r(!0)):a.event==="disconnected"&&(Du(a.error)?r(!1):(this.notifyState({state:this.states.connecting.failState,error:a.error}),r(!0)));return}h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+i+"; setting pending"),this.setTransportPending(u,t),r(null,u)})}setTransportPending(t,i){const r=i.mode;h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+t+"; mode = "+r),this.pendingTransport=t,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),t.once("connected",(u,g,m)=>{this.activateTransport(u,t,g,m),r==="recover"&&this.options.recover&&(delete this.options.recover,this.unpersistConnection())});const a=this;t.on(["disconnected","closed","failed"],function(u){a.deactivateTransport(t,this.event,u)}),this.emit("transport.pending",t)}activateTransport(t,i,r,a){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+i),t&&h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+t),r&&h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+r),a&&h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(a)),this.persistTransportPreference(i);const u=this.state,g=this.states.connected.state;if(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+u.state),u.state==this.states.closing.state||u.state==this.states.closed.state||u.state==this.states.failed.state)return h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),i.disconnect(),!1;if(delete this.pendingTransport,!i.isConnected)return h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+i+" since it appears to no longer be connected"),!1;const m=this.activeProtocol;this.activeProtocol=new Nu(i),this.host=i.params.host;const S=a.connectionKey;if(S&&this.connectionKey!=S&&this.setConnection(r,a,!!t),this.onConnectionDetailsUpdate(a,i),_.Config.nextTick(()=>{i.on("connected",(C,I,E)=>{this.onConnectionDetailsUpdate(E,i),this.emit("update",new Ls(g,g,null,C))})}),u.state===this.states.connected.state?t&&(this.errorReason=this.realtime.connection.errorReason=t,this.emit("update",new Ls(g,g,null,t))):(this.notifyState({state:"connected",error:t}),this.errorReason=this.realtime.connection.errorReason=t||null),this.emit("transport.active",i),m)if(m.messageQueue.count()>0&&h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+m.transport.shortName+", new one is "+i.shortName+") finishing with "+m.messageQueue.count()+" messages still pending"),m.transport===i){const C="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+i.shortName+"; stack = "+new Error().stack;h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.activateTransport()",C)}else m.finish();return!0}deactivateTransport(t,i,r){const a=this.activeProtocol,u=a&&a.getTransport()===t,g=t===this.pendingTransport,m=this.noTransportsScheduledForActivation();if(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+t),h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+i+(u?"; was active":g?"; was pending":"")+(m?"":"; another transport is scheduled for activation")),r&&r.message&&h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+r.message),u&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(a.getPendingMessages()),a.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",t),u&&m||u&&i==="failed"||i==="closed"||a===null&&g){if(i==="disconnected"&&r&&r.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:i,error:r,retryImmediately:!0});return}const S=i==="failed"&&Mt.isTokenErr(r)?"disconnected":i;this.notifyState({state:S,error:r});return}}noTransportsScheduledForActivation(){return!this.pendingTransport||!this.pendingTransport.isConnected}setConnection(t,i,r){const a=this.connectionId;(a&&a!==t||!a&&r)&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==t&&h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=t,this.realtime.connection.key=this.connectionKey=i.connectionKey}clearConnection(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}createRecoveryKey(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}checkConnectionStateFreshness(){if(!this.lastActivity||!this.connectionId)return;const t=Date.now()-this.lastActivity;t>this.connectionStateTtl+this.maxIdleInterval&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+t+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}persistConnection(){if(qn()){const t=this.createRecoveryKey();t&&this.setSessionRecoverData({recoveryKey:t,disconnectedAt:Date.now(),location:qu.location,clientId:this.realtime.auth.clientId})}}unpersistConnection(){this.clearSessionRecoverData()}getActiveTransportFormat(){var t;return(t=this.activeProtocol)==null?void 0:t.getTransport().format}getError(){if(this.errorReason){const t=_e.fromValues(this.errorReason);return t.cause=this.errorReason,t}return this.getStateError()}getStateError(){var t,i;return(i=(t=tn)[this.state.state])==null?void 0:i.call(t)}activeState(){return this.state.queueEvents||this.state.sendEvents}enactStateChange(t){const i="Connection state",r=t.current+(t.reason?"; reason: "+t.reason:"");t.current==="failed"?h.logAction(this.logger,h.LOG_ERROR,i,r):h.logAction(this.logger,h.LOG_MAJOR,i,r),h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+t.current+"; reason = "+(t.reason&&t.reason.message));const a=this.state=this.states[t.current];t.reason&&(this.errorReason=t.reason,this.realtime.connection.errorReason=t.reason),(a.terminal||a.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",t)}startTransitionTimer(t){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+t.state),this.transitionTimer&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(()=>{this.transitionTimer&&(this.transitionTimer=null,h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager "+t.state+" timer expired","requesting new state: "+t.failState),this.notifyState({state:t.failState}))},t.retryDelay)}cancelTransitionTimer(){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}startSuspendTimer(){this.suspendTimer||(this.suspendTimer=setTimeout(()=>{this.suspendTimer&&(this.suspendTimer=null,h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),this.states.connecting.failState="suspended",this.notifyState({state:"suspended"}))},this.connectionStateTtl))}checkSuspendTimer(t){t!=="disconnected"&&t!=="suspended"&&t!=="connecting"&&this.cancelSuspendTimer()}cancelSuspendTimer(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}startRetryTimer(t){this.retryTimer=setTimeout(()=>{h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),this.retryTimer=null,this.requestState({state:"connecting"})},t)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}startWebSocketSlowTimer(){this.webSocketSlowTimer=setTimeout(()=>{h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),this.checkWsConnectivity().then(()=>{h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),this.wsCheckResult=!0}).catch(()=>{h.logAction(this.logger,h.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),this.wsCheckResult=!1}),this.realtime.http.checkConnectivity&&oe(this.realtime.http.checkConnectivity(),(t,i)=>{t||!i?(h.logAction(this.logger,h.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),this.cancelWebSocketGiveUpTimer(),this.notifyState({state:"disconnected",error:new R("Unable to connect (network unreachable)",80003,404)})):h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")})},this.options.timeouts.webSocketSlowTimeout)}cancelWebSocketSlowTimer(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}startWebSocketGiveUpTimer(t){this.webSocketGiveUpTimer=setTimeout(()=>{var i,r;this.wsCheckResult||(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(this.baseTransport?"trying base transport":"")),this.baseTransport?(this.abandonedWebSocket=!0,(i=this.proposedTransport)==null||i.dispose(),(r=this.pendingTransport)==null||r.dispose(),this.connectBase(t,++this.connectCounter)):h.logAction(this.logger,h.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))},this.options.timeouts.webSocketConnectTimeout)}cancelWebSocketGiveUpTimer(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}notifyState(t){var i,r;const a=t.state,u=a==="disconnected"&&(this.state===this.states.connected||t.retryImmediately||this.state===this.states.connecting&&t.error&&Mt.isTokenErr(t.error)&&!(this.errorReason&&Mt.isTokenErr(this.errorReason)));if(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+a+(u?"; will retry connection immediately":"")),a==this.state.state||(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(t.state),(a==="suspended"||a==="connected")&&(this.disconnectedRetryCount=0),this.state.terminal))return;const g=this.states[t.state];let m=g.retryDelay;g.state==="disconnected"&&(this.disconnectedRetryCount++,m=dn(g.retryDelay,this.disconnectedRetryCount));const S=new Ls(this.state.state,g.state,m,t.error||((r=(i=tn)[g.state])==null?void 0:r.call(i)));if(u){const C=()=>{this.state===this.states.disconnected&&(this.lastAutoReconnectAttempt=Date.now(),this.requestState({state:"connecting"}))},I=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;I&&I<1e3?(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+I+"ms ago, waiting another "+(1e3-I)+"ms before trying again"),setTimeout(C,1e3-I)):_.Config.nextTick(C)}else(a==="disconnected"||a==="suspended")&&this.startRetryTimer(m);(a==="disconnected"&&!u||a==="suspended"||g.terminal)&&_.Config.nextTick(()=>{this.disconnectAllTransports()}),a=="connected"&&!this.activeProtocol&&h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(S),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(a,S.reason),this.failQueuedMessages(S.reason))}requestState(t){var i,r;const a=t.state;if(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+a+"; current state: "+this.state.state),a==this.state.state||(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(a),a=="connecting"&&this.state.state=="connected")||a=="closing"&&this.state.state=="closed")return;const u=this.states[a],g=new Ls(this.state.state,u.state,null,t.error||((r=(i=tn)[u.state])==null?void 0:r.call(i)));this.enactStateChange(g),a=="connecting"&&_.Config.nextTick(()=>{this.startConnect()}),a=="closing"&&this.closeImpl()}startConnect(){if(this.state!==this.states.connecting){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}const t=this.realtime.auth,i=++this.connectCounter,r=()=>{this.checkConnectionStateFreshness(),this.getTransportParams(a=>{if(a.mode==="recover"&&a.options.recover){const u=Ui(a.options.recover);u&&this.realtime.channels.recoverChannels(u.channelSerials)}i===this.connectCounter&&this.connectImpl(a,i)})};if(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),t.method==="basic")r();else{const a=u=>{i===this.connectCounter&&(u?this.actOnErrorFromAuthorize(u):r())};this.errorReason&&Mt.isTokenErr(this.errorReason)?oe(t._forceNewToken(null,null),a):oe(t._ensureValidAuthCredentials(!1),a)}}connectImpl(t,i){const r=this.state.state;if(r!==this.states.connecting.state){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+r);return}const a=this.getTransportPreference();a&&a===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then(()=>{this.unpersistTransportPreference(),this.state===this.states.connecting&&(h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+this.baseTransport),this.disconnectAllTransports(),this.connectWs(t,++this.connectCounter))}).catch($o),a&&a===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(t,i):this.connectWs(t,i)}connectWs(t,i){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(t),this.tryTransportWithFallbacks("web_socket",t,!0,i,()=>this.wsCheckResult!==!1&&!this.abandonedWebSocket)}connectBase(t,i){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,t,!1,i,()=>!0):this.notifyState({state:"disconnected",error:new R("No transports left to try",8e4,404)})}tryTransportWithFallbacks(t,i,r,a,u){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",t);const g=E=>{this.notifyState({state:this.states.connecting.failState,error:E})},m=r?this.wsHosts.slice():this.httpHosts.slice(),S=(E,G)=>{if(a===this.connectCounter){if(!u()){G&&G.dispose();return}!G&&!E&&I()}},C=m.shift();if(!C){g(new R("Unable to connect (no available host)",80003,404));return}i.host=C;const I=()=>{if(!m.length){g(new R("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!this.realtime.http.checkConnectivity){g(new _e("Internal error: Http.checkConnectivity not set",null,500));return}oe(this.realtime.http.checkConnectivity(),(E,G)=>{if(a===this.connectCounter&&u()){if(E){g(E);return}if(!G){g(new R("Unable to connect (network unreachable)",80003,404));return}i.host=L(m),this.tryATransport(i,t,S)}})};if(this.forceFallbackHost&&m.length){this.forceFallbackHost=!1,I();return}this.tryATransport(i,t,S)}closeImpl(){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}onAuthUpdated(t,i){var r;switch(this.state.state){case"connected":{h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");const a=(r=this.activeProtocol)==null?void 0:r.getTransport();a&&a.onAuthUpdated&&a.onAuthUpdated(t);const u=lt({action:Q.AUTH,auth:{accessToken:t.token}});this.send(u);const g=()=>{this.off(m),i(null,t)},m=S=>{S.current==="failed"&&(this.off(g),this.off(m),i(S.reason||this.getStateError()))};this.once("connectiondetails",g),this.on("connectionstate",m);break}case"connecting":h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");const a=u=>{switch(u.current){case"connected":this.off(a),i(null,t);break;case"failed":case"closed":case"suspended":this.off(a),i(u.reason||this.getStateError());break}};this.on("connectionstate",a),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}}disconnectAllTransports(){h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}send(t,i,r){r=r||$o;const a=this.state;if(a.sendEvents){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new Wo(t,r));return}if(!(i&&a.queueEvents)){const g="rejecting event, queueEvent was "+i+", state was "+a.state;h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.send()",g),r(this.errorReason||new R(g,9e4,400));return}this.logger.shouldLog(h.LOG_MICRO)&&h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+ki(t,this.realtime._RealtimePresence,this.realtime._Annotations,this.realtime._objectsPlugin)),this.queue(t,r)}sendImpl(t){const i=t.message;t.ackRequired&&!t.sendAttempted&&(i.msgSerial=this.msgSerial++);try{this.activeProtocol.send(t)}catch(r){h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+r.stack)}}queue(t,i){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.queue()","queueing event");const r=this.queuedMessages.last(),a=this.options.maxMessageSize;r&&!r.sendAttempted&&Fu(r.message,t,a)?(r.merged||(r.callback=vi.create(this.logger,[r.callback]),r.merged=!0),r.callback.push(i)):this.queuedMessages.push(new Wo(t,i))}sendQueuedMessages(){h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");let t;for(;t=this.queuedMessages.shift();)this.sendImpl(t)}queuePendingMessages(t){t&&t.length&&(h.logAction(this.logger,h.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+t.length+" pending messages"),this.queuedMessages.prepend(t))}failQueuedMessages(t){const i=this.queuedMessages.count();i>0&&(h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+i+" queued messages, err = "+P(t)),this.queuedMessages.completeAllMessages(t))}onChannelMessage(t,i){this.pendingChannelMessagesState.queue.push({message:t,transport:i}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}processNextPendingChannelMessage(){if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;const t=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(t.message).catch(i=>{h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",i)}).finally(()=>{this.pendingChannelMessagesState.isProcessing=!1,this.processNextPendingChannelMessage()})}}async processChannelMessage(t){await this.realtime.channels.processChannelMessage(t)}async ping(){var t;if(this.state.state!=="connected")throw new R("Unable to ping service; not connected",4e4,400);const i=(t=this.activeProtocol)==null?void 0:t.getTransport();if(!i)throw this.getStateError();h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.ping()","transport = "+i);const r=Date.now(),a=K();return zr(new Promise(u=>{const g=m=>{m===a&&(i.off("heartbeat",g),u(Date.now()-r))};i.on("heartbeat",g),i.ping(a)}),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response")}abort(t){this.activeProtocol.getTransport().fail(t)}getTransportPreference(){var t,i;return this.transportPreference||Li()&&((i=(t=_.WebStorage)==null?void 0:t.get)==null?void 0:i.call(t,Ni))}persistTransportPreference(t){var i,r;this.transportPreference=t.shortName,Li()&&((r=(i=_.WebStorage)==null?void 0:i.set)==null||r.call(i,Ni,t.shortName))}unpersistTransportPreference(){var t,i;this.transportPreference=null,Li()&&((i=(t=_.WebStorage)==null?void 0:t.remove)==null||i.call(t,Ni))}actOnErrorFromAuthorize(t){if(t.code===40171)this.notifyState({state:"failed",error:t});else if(t.code===40102)this.notifyState({state:"failed",error:t});else if(t.statusCode===Ps.Forbidden){const i="Client configured authentication provider returned 403; failing the connection";h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",i),this.notifyState({state:"failed",error:new R(i,80019,403,t)})}else{const i="Client configured authentication provider request failed";h.logAction(this.logger,h.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",i),this.notifyState({state:this.state.failState,error:new R(i,80019,401,t)})}}onConnectionDetailsUpdate(t,i){if(!t)return;this.connectionDetails=t,t.maxMessageSize&&(this.options.maxMessageSize=t.maxMessageSize);const r=t.clientId;if(r){const u=this.realtime.auth._uncheckedSetClientId(r);if(u){h.logAction(this.logger,h.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",u.message),i.fail(u);return}}const a=t.connectionStateTtl;a&&(this.connectionStateTtl=a),this.maxIdleInterval=t.maxIdleInterval,this.emit("connectiondetails",t)}checkWsConnectivity(){const t=this.options.wsConnectivityCheckUrl||ee.wsConnectivityCheckUrl,i=new _.Config.WebSocket(t);return new Promise((r,a)=>{let u=!1;i.onopen=()=>{u||(u=!0,r(),i.close())},i.onclose=i.onerror=()=>{u||(u=!0,a())}})}sessionRecoveryName(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}getSessionRecoverData(){var t,i;return qn()&&((i=(t=_.WebStorage)==null?void 0:t.getSession)==null?void 0:i.call(t,this.sessionRecoveryName()))}setSessionRecoverData(t){var i,r;return qn()&&((r=(i=_.WebStorage)==null?void 0:i.setSession)==null?void 0:r.call(i,this.sessionRecoveryName(),t))}clearSessionRecoverData(){var t,i;return qn()&&((i=(t=_.WebStorage)==null?void 0:t.removeSession)==null?void 0:i.call(t,this.sessionRecoveryName()))}},Ko=Wu,$u=class extends Be{constructor(e,t){super(e.logger),this.whenState=i=>Be.prototype.whenState.call(this,i,this.state),this.ably=e,this.connectionManager=new Ko(e,t),this.state=this.connectionManager.state.state,this.key=void 0,this.id=void 0,this.errorReason=null,this.connectionManager.on("connectionstate",i=>{const r=this.state=i.current;_.Config.nextTick(()=>{this.emit(r,i)})}),this.connectionManager.on("update",i=>{_.Config.nextTick(()=>{this.emit("update",i)})})}connect(){h.logAction(this.logger,h.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}async ping(){return h.logAction(this.logger,h.LOG_MINOR,"Connection.ping()",""),this.connectionManager.ping()}close(){h.logAction(this.logger,h.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}get recoveryKey(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}createRecoveryKey(){return this.connectionManager.createRecoveryKey()}},Ku=$u,zo=class fl extends mo{constructor(t){var i,r,a,u;if(super(ee.objectifyOptions(t,!1,"BaseRealtime",h.defaultLogger)),h.logAction(this.logger,h.LOG_MINOR,"Realtime()",""),typeof EdgeRuntime=="string")throw new R(`Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === 'string')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.`,4e4,400);this._additionalTransportImplementations=fl.transportImplementationsFromPlugins(this.options.plugins),this._RealtimePresence=(r=(i=this.options.plugins)==null?void 0:i.RealtimePresence)!=null?r:null,this._objectsPlugin=(u=(a=this.options.plugins)==null?void 0:a.Objects)!=null?u:null,this.connection=new Ku(this,this.options),this._channels=new Ju(this),this.options.autoConnect!==!1&&this.connect()}static transportImplementationsFromPlugins(t){const i={};return t!=null&&t.WebSocketTransport&&(i[nt.WebSocket]=t.WebSocketTransport),t!=null&&t.XHRPolling&&(i[nt.XhrPolling]=t.XHRPolling),i}get channels(){return this._channels}connect(){h.logAction(this.logger,h.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}close(){h.logAction(this.logger,h.LOG_MINOR,"Realtime.close()",""),this.connection.close()}};zo.EventEmitter=Be;var zu=zo,Ju=class extends Be{constructor(e){super(e.logger),this.realtime=e,this.all=Object.create(null),e.connection.connectionManager.on("transport.active",()=>{this.onTransportActive()})}channelSerials(){let e={};for(const t of b(this.all,!0)){const i=this.all[t];i.properties.channelSerial&&(e[t]=i.properties.channelSerial)}return e}recoverChannels(e){for(const t of b(e,!0)){const i=this.get(t);i.properties.channelSerial=e[t]}}async processChannelMessage(e){const t=e.channel;if(t===void 0){h.logAction(this.logger,h.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+e.action);return}const i=this.all[t];if(!i){h.logAction(this.logger,h.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+t);return}await i.processMessage(e)}onTransportActive(){for(const e in this.all){const t=this.all[e];t.state==="attaching"||t.state==="detaching"?t.checkPendingState():t.state==="suspended"?t._attach(!1,null):t.state==="attached"&&t.requestState("attaching")}}propogateConnectionInterruption(e,t){const i={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},r=["attaching","attached","detaching","suspended"],a=i[e];for(const u in this.all){const g=this.all[u];r.includes(g.state)&&g.notifyState(a,t)}}get(e,t){e=String(e);let i=this.all[e];if(!i)i=this.all[e]=new jn(this.realtime,e,t);else if(t){if(i._shouldReattachToSetOptions(t,i.channelOptions))throw new R("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);i.setOptions(t)}return i}getDerived(e,t,i){if(t.filter){const r=As(t.filter),a=Bn(e);e=`[filter=${r}${a.qualifierParam}]${a.channelName}`}return this.get(e,i)}release(e){e=String(e);const t=this.all[e];if(!t)return;const i=t.getReleaseErr();if(i)throw i;delete this.all[e]}},Qu=zu;function Yu(e,t){if(e.isSynthesized()||t.isSynthesized())return e.timestamp>=t.timestamp;const i=e.parseId(),r=t.parseId();return i.msgSerial===r.msgSerial?i.index>r.index:i.msgSerial>r.msgSerial}var Bi=class extends Be{constructor(e,t,i=Yu){super(e.logger),this.presence=e,this.map=Object.create(null),this.syncInProgress=!1,this.residualMembers=null,this.memberKey=t,this.newerThan=i}get(e){return this.map[e]}getClient(e){const t=this.map,i=[];for(const r in t){const a=t[r];a.clientId==e&&a.action!="absent"&&i.push(a)}return i}list(e){const t=this.map,i=e&&e.clientId,r=e&&e.connectionId,a=[];for(const u in t){const g=t[u];g.action!=="absent"&&(i&&i!=g.clientId||r&&r!=g.connectionId||a.push(g))}return a}put(e){(e.action==="enter"||e.action==="update")&&(e=jt.fromValues(e),e.action="present");const t=this.map,i=this.memberKey(e);this.residualMembers&&delete this.residualMembers[i];const r=t[i];return r&&!this.newerThan(e,r)?!1:(t[i]=e,!0)}values(){const e=this.map,t=[];for(const i in e){const r=e[i];r.action!="absent"&&t.push(r)}return t}remove(e){const t=this.map,i=this.memberKey(e),r=t[i];return r&&!this.newerThan(e,r)?!1:(this.syncInProgress?(e=jt.fromValues(e),e.action="absent",t[i]=e):delete t[i],!!r)}startSync(){const e=this.map,t=this.syncInProgress;h.logAction(this.logger,h.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),this.syncInProgress||(this.residualMembers=le(e),this.setInProgress(!0))}endSync(){const e=this.map,t=this.syncInProgress;if(h.logAction(this.logger,h.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t){for(const i in e)e[i].action==="absent"&&delete e[i];this.presence._synthesizeLeaves(w(this.residualMembers));for(const i in this.residualMembers)delete e[i];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}waitSync(e){const t=this.syncInProgress;if(h.logAction(this.logger,h.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),!t){e();return}this.once("sync",e)}clear(){this.map={},this.setInProgress(!1),this.residualMembers=null}setInProgress(e){h.logAction(this.logger,h.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+e),this.syncInProgress=e,this.presence.syncComplete=!e}};function Xu(e){return e.channel.client.auth.clientId}function Di(e){const t=e.channel.client,i=t.auth.clientId;return(!i||i==="*")&&t.connection.state==="connected"}function Zu(e,t,i){switch(e.state){case"attached":case"suspended":i();break;case"initialized":case"detached":case"detaching":case"attaching":oe(e.attach(),function(r){r?t(r):i()});break;default:t(R.fromValues(e.invalidStateError()))}}var eh=class extends Be{constructor(e){super(e.logger),this.channel=e,this.syncComplete=!1,this.members=new Bi(this,t=>t.clientId+":"+t.connectionId),this._myMembers=new Bi(this,t=>t.clientId),this.subscriptions=new Be(this.logger),this.pendingPresence=[]}async enter(e){if(Di(this))throw new R("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,e,"enter")}async update(e){if(Di(this))throw new R("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,e,"update")}async enterClient(e,t){return this._enterOrUpdateClient(void 0,e,t,"enter")}async updateClient(e,t){return this._enterOrUpdateClient(void 0,e,t,"update")}async _enterOrUpdateClient(e,t,i,r){const a=this.channel;if(!a.connectionManager.activeState())throw a.connectionManager.getError();h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence."+r+"Client()","channel = "+a.name+", id = "+e+", client = "+(t||"(implicit) "+Xu(this)));const u=jt.fromData(i);u.action=r,e&&(u.id=e),t&&(u.clientId=t);const g=await u.encode(a.channelOptions);switch(a.state){case"attached":return a.sendPresence([g]);case"initialized":case"detached":a.attach();case"attaching":return new Promise((m,S)=>{this.pendingPresence.push({presence:g,callback:C=>C?S(C):m()})});default:{const m=new _e("Unable to "+r+" presence channel while in "+a.state+" state",90001);throw m.code=90001,m}}}async leave(e){if(Di(this))throw new R("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,e)}async leaveClient(e,t){const i=this.channel;if(!i.connectionManager.activeState())throw i.connectionManager.getError();h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+e);const r=jt.fromData(t);r.action="leave",e&&(r.clientId=e);const a=await r.encode(i.channelOptions);switch(i.state){case"attached":return i.sendPresence([a]);case"attaching":return new Promise((u,g)=>{this.pendingPresence.push({presence:a,callback:m=>m?g(m):u()})});case"initialized":case"failed":throw new _e("Unable to leave presence channel (incompatible state)",90001);default:throw i.invalidStateError()}}async get(e){const t=!e||("waitForSync"in e?e.waitForSync:!0);return new Promise((i,r)=>{function a(u){i(e?u.list(e):u.values())}if(this.channel.state==="suspended"){t?r(R.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):a(this.members);return}Zu(this.channel,u=>r(u),()=>{const u=this.members;t?u.waitSync(function(){a(u)}):a(u)})})}async history(e){h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name);const t=this.channel.client.rest.presenceMixin;if(e&&e.untilAttach)if(this.channel.state==="attached")delete e.untilAttach,e.from_serial=this.channel.properties.attachSerial;else throw new R("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);return t.history(this,e)}setPresence(e,t,i){h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+e.length+" participants; syncChannelSerial = "+i);let r,a;const u=this.members,g=this._myMembers,m=[],S=this.channel.connectionManager.connectionId;t&&(this.members.startSync(),i&&(a=i.match(/^[\w-]+:(.*)$/))&&(r=a[1]));for(let C of e)switch(C.action){case"leave":u.remove(C)&&m.push(C),C.connectionId===S&&!C.isSynthesized()&&g.remove(C);break;case"enter":case"present":case"update":u.put(C)&&m.push(C),C.connectionId===S&&g.put(C);break}t&&!r&&(u.endSync(),this.channel.syncChannelSerial=null);for(let C=0;C<m.length;C++){const I=m[C];this.subscriptions.emit(I.action,I)}}onAttached(e){h.logAction(this.logger,h.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+e),e?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();const t=this.pendingPresence,i=t.length;if(i){this.pendingPresence=[];const r=[],a=vi.create(this.logger);h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence.onAttached","sending "+i+" queued presence messages");for(let u=0;u<i;u++){const g=t[u];r.push(g.presence),a.push(g.callback)}this.channel.sendPresence(r).then(()=>a()).catch(u=>a(u))}}actOnChannelState(e,t,i){switch(e){case"attached":this.onAttached(t);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(i);break}}failPendingPresence(e){if(this.pendingPresence.length){h.logAction(this.logger,h.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+P(e));for(let t=0;t<this.pendingPresence.length;t++)try{this.pendingPresence[t].callback(e)}catch{}this.pendingPresence=[]}}_clearMyMembers(){this._myMembers.clear()}_ensureMyMembersPresent(){const e=this._myMembers,t=this.channel.connectionManager.connectionId;for(const i in e.map){const r=e.map[i];h.logAction(this.logger,h.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+r.clientId+'" into the presence set');const a=r.connectionId===t?r.id:void 0;this._enterOrUpdateClient(a,r.clientId,r.data,"enter").catch(u=>{const g=new R("Presence auto re-enter failed",91004,400,u);h.logAction(this.logger,h.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()","Presence auto re-enter failed; reason = "+P(u));const m=new Ii(this.channel.state,this.channel.state,!0,!1,g);this.channel.emit("update",m)})}}_synthesizeLeaves(e){const t=this.subscriptions;e.forEach(function(i){const r=jt.fromValues({action:"leave",connectionId:i.connectionId,clientId:i.clientId,data:i.data,encoding:i.encoding,timestamp:Date.now()});t.emit("leave",r)})}async subscribe(...e){const t=jn.processListenerArgs(e),i=t[0],r=t[1],a=this.channel;if(a.state==="failed")throw R.fromValues(a.invalidStateError());this.subscriptions.on(i,r),a.channelOptions.attachOnSubscribe!==!1&&await a.attach()}unsubscribe(...e){const t=jn.processListenerArgs(e),i=t[0],r=t[1];this.subscriptions.off(i,r)}},th=eh,nh=nt.WebSocket;function sh(e){return!!e.on}var ih=class extends vn{constructor(e,t,i){super(e,t,i),this.shortName=nh,i.heartbeats=_.Config.useProtocolHeartbeats,this.wsHost=i.host}static isAvailable(){return!!_.Config.WebSocket}createWebSocket(e,t){return this.uri=e+j(t),new _.Config.WebSocket(this.uri)}toString(){return"WebSocketTransport; uri="+this.uri}connect(){h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.connect()","starting"),vn.prototype.connect.call(this);const e=this,t=this.params,i=t.options,a=(i.tls?"wss://":"ws://")+this.wsHost+":"+ee.getPort(i)+"/";h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.connect()","uri: "+a),oe(this.auth.getAuthParams(),function(u,g){if(e.isDisposed)return;let m="";for(const C in g)m+=" "+C+": "+g[C]+";";if(h.logAction(e.logger,h.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+m+" err: "+u),u){e.disconnect(u);return}const S=t.getConnectParams(g);try{const C=e.wsConnection=e.createWebSocket(a,S);C.binaryType=_.Config.binaryType,C.onopen=function(){e.onWsOpen()},C.onclose=function(I){e.onWsClose(I)},C.onmessage=function(I){e.onWsData(I.data)},C.onerror=function(I){e.onWsError(I)},sh(C)&&C.on("ping",function(){e.onActivity()})}catch(C){h.logAction(e.logger,h.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(C.stack||C.message)),e.disconnect(C)}})}send(e){const t=this.wsConnection;if(!t){h.logAction(this.logger,h.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{t.send(Ru(e,this.connectionManager.realtime._MsgPack,this.params.format))}catch(i){const r="Exception from ws connection when trying to send: "+P(i);h.logAction(this.logger,h.LOG_ERROR,"WebSocketTransport.send()",r),this.finish("disconnected",new R(r,5e4,500))}}onWsData(e){h.logAction(this.logger,h.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+e.length+"; type = "+typeof e);try{this.onProtocolMessage(Tu(e,this.connectionManager.realtime._MsgPack,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin,this.format))}catch(t){h.logAction(this.logger,h.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+t.stack)}}onWsOpen(){h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}onWsClose(e){let t,i;if(typeof e=="object"?(i=e.code,t=e.wasClean||i===1e3):(i=e,t=i==1e3),delete this.wsConnection,t){h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");const r=new R("Websocket closed",80003,400);this.finish("disconnected",r)}else{const r="Unclean disconnection of WebSocket ; code = "+i,a=new R(r,80003,400);h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.onWsClose()",r),this.finish("disconnected",a)}this.emit("disposed")}onWsError(e){h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+e.message),_.Config.nextTick(()=>{this.disconnect(Error(e.message))})}dispose(){h.logAction(this.logger,h.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;const e=this.wsConnection;e&&(e.onmessage=function(){},delete this.wsConnection,_.Config.nextTick(()=>{if(h.logAction(this.logger,h.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!e)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");e.close()}))}},Jo=ih,rh=class{static subscribeFilter(e,t,i){const r=a=>{var u,g,m,S,C,I;const E={name:a.name,refTimeserial:(g=(u=a.extras)==null?void 0:u.ref)==null?void 0:g.timeserial,refType:(S=(m=a.extras)==null?void 0:m.ref)==null?void 0:S.type,isRef:!!((I=(C=a.extras)==null?void 0:C.ref)!=null&&I.timeserial),clientId:a.clientId};Object.entries(t).find(([G,k])=>k!==void 0?E[G]!==k:!1)||i(a)};this.addFilteredSubscription(e,t,i,r),e.subscriptions.on(r)}static addFilteredSubscription(e,t,i,r){var a;if(e.filteredSubscriptions||(e.filteredSubscriptions=new Map),e.filteredSubscriptions.has(i)){const u=e.filteredSubscriptions.get(i);u.set(t,((a=u==null?void 0:u.get(t))==null?void 0:a.concat(r))||[r])}else e.filteredSubscriptions.set(i,new Map([[t,[r]]]))}static getAndDeleteFilteredSubscriptions(e,t,i){if(!e.filteredSubscriptions)return[];if(!i&&t)return Array.from(e.filteredSubscriptions.entries()).map(([u,g])=>{var m;let S=g.get(t);return g.delete(t),g.size===0&&((m=e.filteredSubscriptions)==null||m.delete(u)),S}).reduce((u,g)=>g?u.concat(...g):u,[]);if(!i||!e.filteredSubscriptions.has(i))return[];const r=e.filteredSubscriptions.get(i);if(!t){const u=Array.from(r.values()).reduce((g,m)=>g.concat(...m),[]);return e.filteredSubscriptions.delete(i),u}let a=r.get(t);return r.delete(t),a||[]}},dt=class Pr extends Qu{constructor(t){var i;const r=Pr._MsgPack;if(!r)throw new Error("Expected DefaultRealtime._MsgPack to have been set");super(ee.objectifyOptions(t,!0,"Realtime",h.defaultLogger,J(U({},ko),{Crypto:(i=Pr.Crypto)!=null?i:void 0,MsgPack:r,RealtimePresence:{RealtimePresence:th,PresenceMessage:jt,WirePresenceMessage:Dn},Annotations:{Annotation:Gn,WireAnnotation:bn,RealtimeAnnotations:Fo,RestAnnotations:Mi},WebSocketTransport:Jo,MessageInteractions:rh})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(t){this._Crypto=t}};dt.Utils=W,dt.ConnectionManager=Ko,dt.ProtocolMessage=Mu,dt._Crypto=null,dt.Message=Eo,dt.PresenceMessage=Io,dt.Annotation=Uo,dt._MsgPack=null,dt._Http=_i,dt._PresenceMap=Bi,dt._MessageEncoding=ks;var Hi=dt,Gi=Uint8Array,Fn=Uint32Array,ji=Math.pow,Qo=new Fn(8),Yo=[],Vn=new Fn(64);function Xo(e){return(e-(e|0))*ji(2,32)|0}for(var Wn=2,$n=0;$n<64;){for(qi=!0,Ns=2;Ns<=Wn/2;Ns++)Wn%Ns===0&&(qi=!1);qi&&($n<8&&(Qo[$n]=Xo(ji(Wn,1/2))),Yo[$n]=Xo(ji(Wn,1/3)),$n++),Wn++}var qi,Ns,oh=!!new Gi(new Fn([1]).buffer)[0];function Fi(e){return oh?e>>>24|(e>>>16&255)<<8|(e&65280)<<8|e<<24:e}function _t(e,t){return e>>>t|e<<32-t}function Us(e){var t=Qo.slice(),i=e.length,r=i*8,a=512-(r+64)%512-1+r+65,u=new Gi(a/8),g=new Fn(u.buffer);u.set(e,0),u[i]=128,g[g.length-1]=Fi(r);for(var m,S=0;S<a/32;S+=16){var C=t.slice();for(m=0;m<64;m++){var I;if(m<16)I=Fi(g[S+m]);else{var E=Vn[m-15],G=Vn[m-2];I=Vn[m-7]+Vn[m-16]+(_t(E,7)^_t(E,18)^E>>>3)+(_t(G,17)^_t(G,19)^G>>>10)}Vn[m]=I|=0;for(var k=(_t(C[4],6)^_t(C[4],11)^_t(C[4],25))+(C[4]&C[5]^~C[4]&C[6])+C[7]+I+Yo[m],F=(_t(C[0],2)^_t(C[0],13)^_t(C[0],22))+(C[0]&C[1]^C[2]&(C[0]^C[1])),V=7;V>0;V--)C[V]=C[V-1];C[0]=k+F|0,C[4]=C[4]+k|0}for(m=0;m<8;m++)t[m]=t[m]+C[m]|0}return new Gi(new Fn(t.map(function(Y){return Fi(Y)})).buffer)}function ah(e,t){if(e.length>64&&(e=Us(e)),e.length<64){const m=new Uint8Array(64);m.set(e,0),e=m}for(var i=new Uint8Array(64),r=new Uint8Array(64),a=0;a<64;a++)i[a]=54^e[a],r[a]=92^e[a];var u=new Uint8Array(t.length+64);u.set(i,0),u.set(t,64);var g=new Uint8Array(96);return g.set(r,0),g.set(Us(u),64),Us(g)}var ch=class{constructor(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}uint8ViewToBase64(e){let t="";const i=this.base64CharSet,r=e.byteLength,a=r%3,u=r-a;let g,m,S,C,I;for(let E=0;E<u;E=E+3)I=e[E]<<16|e[E+1]<<8|e[E+2],g=(I&16515072)>>18,m=(I&258048)>>12,S=(I&4032)>>6,C=I&63,t+=i[g]+i[m]+i[S]+i[C];return a==1?(I=e[u],g=(I&252)>>2,m=(I&3)<<4,t+=i[g]+i[m]+"=="):a==2&&(I=e[u]<<8|e[u+1],g=(I&64512)>>10,m=(I&1008)>>4,S=(I&15)<<2,t+=i[g]+i[m]+i[S]+"="),t}base64ToArrayBuffer(e){const t=atob==null?void 0:atob(e),i=t.length,r=new Uint8Array(i);for(let a=0;a<i;a++){const u=t.charCodeAt(a);r[a]=u}return this.toArrayBuffer(r)}isBuffer(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}toBuffer(e){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(this.toArrayBuffer(e));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}toArrayBuffer(e){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}base64Encode(e){return this.uint8ViewToBase64(this.toBuffer(e))}base64UrlEncode(e){return this.base64Encode(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64Decode(e){if(ArrayBuffer&&_.Config.atob)return this.base64ToArrayBuffer(e);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}hexEncode(e){return this.toBuffer(e).reduce((i,r)=>i+r.toString(16).padStart(2,"0"),"")}hexDecode(e){if(e.length%2!==0)throw new Error("Can't create a byte array from a hex string of odd length");const t=new Uint8Array(e.length/2);for(let i=0;i<t.length;i++)t[i]=parseInt(e.slice(2*i,2*(i+1)),16);return this.toArrayBuffer(t)}utf8Encode(e){if(_.Config.TextEncoder){const t=new _.Config.TextEncoder().encode(e);return this.toArrayBuffer(t)}else throw new Error("Expected TextEncoder to be configured")}utf8Decode(e){if(!this.isBuffer(e))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return new TextDecoder().decode(e);throw new Error("Expected TextDecoder to be configured")}areBuffersEqual(e,t){if(!e||!t)return!1;const i=this.toArrayBuffer(e),r=this.toArrayBuffer(t);if(i.byteLength!=r.byteLength)return!1;const a=new Uint8Array(i),u=new Uint8Array(r);for(var g=0;g<a.length;g++)if(a[g]!=u[g])return!1;return!0}byteLength(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}arrayBufferViewToBuffer(e){return this.toArrayBuffer(e)}concat(e){const t=e.reduce((a,u)=>a+u.byteLength,0),i=new Uint8Array(t);let r=0;for(const a of e){const u=this.toBuffer(a);i.set(u,r),r+=u.byteLength}return i.buffer}sha256(e){const t=Us(this.toBuffer(e));return this.toArrayBuffer(t)}hmacSha256(e,t){const i=ah(this.toBuffer(t),this.toBuffer(e));return this.toArrayBuffer(i)}},Zo=new ch,lh=function(e,t){var i="aes",r=256,a="cbc",u=16;function g(G){if(G.algorithm==="aes"&&G.mode==="cbc"){if(G.keyLength===128||G.keyLength===256)return;throw new Error("Unsupported key length "+G.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function m(G){return G.replace("_","/").replace("-","+")}function S(G){return G instanceof C}class C{constructor(k,F,V,Y){this.algorithm=k,this.keyLength=F,this.mode=V,this.key=Y}}class I{static getDefaultParams(k){var F;if(!k.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof k.key=="string"?F=t.toArrayBuffer(t.base64Decode(m(k.key))):k.key instanceof ArrayBuffer?F=k.key:F=t.toArrayBuffer(k.key);var V=k.algorithm||i,Y=F.byteLength*8,ue=k.mode||a,be=new C(V,Y,ue,F);if(k.keyLength&&k.keyLength!==be.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+k.keyLength+" was specified, but the key actually has length "+be.keyLength);return g(be),be}static async generateRandomKey(k){try{return e.getRandomArrayBuffer((k||r)/8)}catch(F){throw new R("Failed to generate random key: "+F.message,400,5e4,F)}}static getCipher(k,F){var V,Y=S(k)?k:this.getDefaultParams(k);return{cipherParams:Y,cipher:new E(Y,(V=k.iv)!=null?V:null,F)}}}I.CipherParams=C;class E{constructor(k,F,V){if(this.logger=V,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browser’s SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browser’s SubtleCrypto class is not available.");this.algorithm=k.algorithm+"-"+String(k.keyLength)+"-"+k.mode,this.webCryptoAlgorithm=k.algorithm+"-"+k.mode,this.key=t.toArrayBuffer(k.key),this.iv=F?t.toArrayBuffer(F):null}concat(k,F){const V=new ArrayBuffer(k.byteLength+F.byteLength),Y=new DataView(V),ue=new DataView(t.toArrayBuffer(k));for(let Se=0;Se<ue.byteLength;Se++)Y.setInt8(Se,ue.getInt8(Se));const be=new DataView(t.toArrayBuffer(F));for(let Se=0;Se<be.byteLength;Se++)Y.setInt8(ue.byteLength+Se,be.getInt8(Se));return V}async encrypt(k){h.logAction(this.logger,h.LOG_MICRO,"CBCCipher.encrypt()","");const F=await this.getIv(),V=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]),Y=await crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:F},V,k);return this.concat(F,Y)}async decrypt(k){h.logAction(this.logger,h.LOG_MICRO,"CBCCipher.decrypt()","");const F=t.toArrayBuffer(k),V=F.slice(0,u),Y=F.slice(u),ue=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);return crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:V},ue,Y)}async getIv(){if(this.iv){var k=this.iv;return this.iv=null,k}const F=await e.getRandomArrayBuffer(u);return t.toArrayBuffer(F)}}return I},ea=(e=>(e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",e))(ea||{}),Pt=ea;function ta(){return new R("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var Kn,na=(Kn=class{constructor(e){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1;var t;this.client=e??null;const i=(e==null?void 0:e.options.connectivityCheckUrl)||ee.connectivityCheckUrl,r=(t=e==null?void 0:e.options.connectivityCheckParams)!=null?t:null,a=!(e!=null&&e.options.connectivityCheckUrl),u=U(U({},na.bundledRequestImplementations),e==null?void 0:e._additionalHTTPRequestImplementations),g=u.XHRRequest,m=u.FetchRequest,S=!!(g||m);if(!S)throw ta();_.Config.xhrSupported&&g?(this.supportsAuthHeaders=!0,this.Request=async function(C,I,E,G,k){return new Promise(F=>{var V;const Y=g.createRequest(I,E,G,k,Pt.REQ_SEND,(V=e&&e.options.timeouts)!=null?V:null,this.logger,C);Y.once("complete",(ue,be,Se,ne,ut)=>F({error:ue,body:be,headers:Se,unpacked:ne,statusCode:ut})),Y.exec()})},e!=null&&e.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var C;h.logAction(this.logger,h.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+i);const I=await this.doUri(Ee.Get,i,null,null,r);let E=!1;return a?E=!I.error&&((C=I.body)==null?void 0:C.replace(/\n/,""))=="yes":E=!I.error&&Rl(I.statusCode),h.logAction(this.logger,h.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+E),E}):_.Config.fetchSupported&&m?(this.supportsAuthHeaders=!0,this.Request=async(C,I,E,G,k)=>m(C,e??null,I,E,G,k),e!=null&&e.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var C;h.logAction(this.logger,h.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+i);const I=await this.doUri(Ee.Get,i,null,null,null),E=!I.error&&((C=I.body)==null?void 0:C.replace(/\n/,""))=="yes";return h.logAction(this.logger,h.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+E),E}):this.Request=async()=>({error:S?new _e("no supported HTTP transports available",null,400):ta()})}get logger(){var e,t;return(t=(e=this.client)==null?void 0:e.logger)!=null?t:h.defaultLogger}async doUri(e,t,i,r,a){return this.Request?this.Request(e,t,i,a,r):{error:new _e("Request invoked before assigned to",null,500)}}shouldFallback(e){const t=e.statusCode;return t===408&&!e.code||t===400&&!e.code||t>=500&&t<=504}},Kn.methods=[Ee.Get,Ee.Delete,Ee.Post,Ee.Put,Ee.Patch],Kn.methodsWithoutBody=[Ee.Get,Ee.Delete],Kn.methodsWithBody=[Ee.Post,Ee.Put,Ee.Patch],Kn),sa=na,wn="ablyjs-storage-test",Cn=typeof Wt<"u"?Wt:typeof window<"u"?window:self,uh=class{constructor(){try{Cn.sessionStorage.setItem(wn,wn),Cn.sessionStorage.removeItem(wn),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{Cn.localStorage.setItem(wn,wn),Cn.localStorage.removeItem(wn),this.localSupported=!0}catch{this.localSupported=!1}}get(e){return this._get(e,!1)}getSession(e){return this._get(e,!0)}remove(e){return this._remove(e,!1)}removeSession(e){return this._remove(e,!0)}set(e,t,i){return this._set(e,t,i,!1)}setSession(e,t,i){return this._set(e,t,i,!0)}_set(e,t,i,r){const a={value:t};return i&&(a.expires=Date.now()+i),this.storageInterface(r).setItem(e,JSON.stringify(a))}_get(e,t){if(t&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!t&&!this.localSupported)throw new Error("Local Storage not supported");const i=this.storageInterface(t).getItem(e);if(!i)return null;const r=JSON.parse(i);return r.expires&&r.expires<Date.now()?(this.storageInterface(t).removeItem(e),null):r.value}_remove(e,t){return this.storageInterface(t).removeItem(e)}storageInterface(e){return e?Cn.sessionStorage:Cn.localStorage}},ia=new uh,Ie=He(),hh=typeof EdgeRuntime=="string";typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&!hh&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function fh(){const e=Ie.location;return!Ie.WebSocket||!e||!e.origin||e.origin.indexOf("http")>-1}function dh(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}var gh=Ie.navigator&&Ie.navigator.userAgent.toString(),ph=Ie.location&&Ie.location.href,mh={agent:"browser",logTimestamps:!0,userAgent:gh,currentUrl:ph,binaryType:"arraybuffer",WebSocket:Ie.WebSocket,fetchSupported:!!Ie.fetch,xhrSupported:Ie.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:fh(),useProtocolHeartbeats:!0,supportsBinary:!!Ie.TextDecoder,preferBinary:!1,ArrayBuffer:Ie.ArrayBuffer,atob:Ie.atob,nextTick:typeof Ie.setImmediate<"u"?Ie.setImmediate.bind(Ie):function(e){setTimeout(e,0)},addEventListener:Ie.addEventListener,inspect:JSON.stringify,stringByteSize:function(e){return Ie.TextDecoder&&new Ie.TextEncoder().encode(e).length||e.length},TextEncoder:Ie.TextEncoder,TextDecoder:Ie.TextDecoder,getRandomArrayBuffer:async function(e){const t=new Uint8Array(e);return Ie.crypto.getRandomValues(t),t.buffer},isWebworker:dh(),push:{platform:"browser",formFactor:"desktop",storage:ia}},ra=mh;function yh(e){const t=[80015,80017,80030];return e.code?Mt.isTokenErr(e)?!1:t.includes(e.code)?!0:e.code>=4e4&&e.code<5e4:!1}function Vi(e){return yh(e)?[lt({action:Q.ERROR,error:e})]:[lt({action:Q.DISCONNECTED,error:e})]}var bh=class extends vn{constructor(e,t,i){super(e,t,i,!0),this.onAuthUpdated=r=>{this.authParams={access_token:r.token}},this.stream="stream"in i?i.stream:!0,this.sendRequest=null,this.recvRequest=null,this.pendingCallback=null,this.pendingItems=null}connect(){h.logAction(this.logger,h.LOG_MINOR,"CometTransport.connect()","starting"),vn.prototype.connect.call(this);const e=this.params,t=e.options,i=ee.getHost(t,e.host),r=ee.getPort(t),a=t.tls?"https://":"http://";this.baseUri=a+i+":"+r+"/comet/";const u=this.baseUri+"connect";h.logAction(this.logger,h.LOG_MINOR,"CometTransport.connect()","uri: "+u),oe(this.auth.getAuthParams(),(g,m)=>{if(g){this.disconnect(g);return}if(this.isDisposed)return;this.authParams=m;const S=this.params.getConnectParams(m);"stream"in S&&(this.stream=S.stream),h.logAction(this.logger,h.LOG_MINOR,"CometTransport.connect()","connectParams:"+j(S));let C=!1;const I=this.recvRequest=this.createRequest(u,null,S,null,this.stream?Pt.REQ_RECV_STREAM:Pt.REQ_RECV);I.on("data",E=>{this.recvRequest&&(C||(C=!0,this.emit("preconnect")),this.onData(E))}),I.on("complete",E=>{if(this.recvRequest||(E=E||new R("Request cancelled",80003,400)),this.recvRequest=null,!C&&!E&&(C=!0,this.emit("preconnect")),this.onActivity(),E){E.code?this.onData(Vi(E)):this.disconnect(E);return}_.Config.nextTick(()=>{this.recv()})}),I.exec()})}requestClose(){h.logAction(this.logger,h.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}requestDisconnect(){h.logAction(this.logger,h.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}_requestCloseOrDisconnect(e){const t=e?this.closeUri:this.disconnectUri;if(t){const i=this.createRequest(t,null,this.authParams,null,Pt.REQ_SEND);i.on("complete",r=>{r&&(h.logAction(this.logger,h.LOG_ERROR,"CometTransport.request"+(e?"Close()":"Disconnect()"),"request returned err = "+P(r)),this.finish("disconnected",r))}),i.exec()}}dispose(){h.logAction(this.logger,h.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(h.logAction(this.logger,h.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",tn.disconnected()),_.Config.nextTick(()=>{this.emit("disposed")}))}onConnect(e){var t;if(this.isDisposed)return;const i=(t=e.connectionDetails)==null?void 0:t.connectionKey;vn.prototype.onConnect.call(this,e);const r=this.baseUri+i;h.logAction(this.logger,h.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+r),this.sendUri=r+"/send",this.recvUri=r+"/recv",this.closeUri=r+"/close",this.disconnectUri=r+"/disconnect"}send(e){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(e);return}const t=this.pendingItems||[];t.push(e),this.pendingItems=null,this.sendItems(t)}sendAnyPending(){const e=this.pendingItems;e&&(this.pendingItems=null,this.sendItems(e))}sendItems(e){const t=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(e),Pt.REQ_SEND);t.on("complete",(i,r)=>{if(i&&h.logAction(this.logger,h.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+P(i)),this.sendRequest=null,i){i.code?this.onData(Vi(i)):this.disconnect(i);return}r&&this.onData(r),this.pendingItems&&_.Config.nextTick(()=>{this.sendRequest||this.sendAnyPending()})}),t.exec()}recv(){if(this.recvRequest||!this.isConnected)return;const e=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?Pt.REQ_RECV_STREAM:Pt.REQ_RECV_POLL);e.on("data",t=>{this.onData(t)}),e.on("complete",t=>{if(this.recvRequest=null,this.onActivity(),t){t.code?this.onData(Vi(t)):this.disconnect(t);return}_.Config.nextTick(()=>{this.recv()})}),e.exec()}onData(e){try{const t=this.decodeResponse(e);if(t&&t.length)for(let i=0;i<t.length;i++)this.onProtocolMessage(Pi(t[i],this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin))}catch(t){h.logAction(this.logger,h.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+t.stack)}}encodeRequest(e){return JSON.stringify(e)}decodeResponse(e){return typeof e=="string"?JSON.parse(e):e}},vh=bh;function wh(e,t){return Ue(b(t)).includes("x-ably-errorcode")}function Ch(e,t){if(wh(e,t))return e.error&&R.fromValues(e.error)}var _h=function(){},Sh=0,oa={};function Oh(e,t){return e.getResponseHeader&&e.getResponseHeader(t)}function Ah(e){return e.getResponseHeader&&(e.getResponseHeader("transfer-encoding")||!e.getResponseHeader("content-length"))}function Rh(e){const t=e.getAllResponseHeaders().trim().split(`\r
`),i={};for(let r=0;r<t.length;r++){const a=t[r].split(":").map(u=>u.trim());i[a[0].toLowerCase()]=a[1]}return i}var Th=class dl extends Be{constructor(t,i,r,a,u,g,m,S){super(m),r=r||{},r.rnd=K(),this.uri=t+j(r),this.headers=i||{},this.body=a,this.method=S?S.toUpperCase():ke(a)?"GET":"POST",this.requestMode=u,this.timeouts=g,this.timedOut=!1,this.requestComplete=!1,this.id=String(++Sh),oa[this.id]=this}static createRequest(t,i,r,a,u,g,m,S){const C=g||ee.TIMEOUTS;return new dl(t,i,le(r),a,u,C,m,S)}complete(t,i,r,a,u){this.requestComplete||(this.requestComplete=!0,!t&&i&&this.emit("data",i),this.emit("complete",t,i,r,a,u),this.dispose())}abort(){this.dispose()}exec(){let t=this.headers;const i=this.requestMode==Pt.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,r=this.timer=setTimeout(()=>{this.timedOut=!0,u.abort()},i),a=this.method,u=this.xhr=new XMLHttpRequest,g=t.accept;let m=this.body,S="text";g?g.indexOf("application/x-msgpack")===0&&(S="arraybuffer"):t.accept="application/json",m&&(t["content-type"]||(t["content-type"]="application/json")).indexOf("application/json")>-1&&typeof m!="string"&&(m=JSON.stringify(m)),u.open(a,this.uri,!0),u.responseType=S,"authorization"in t&&(u.withCredentials=!0);for(const ne in t)u.setRequestHeader(ne,t[ne]);const C=(ne,ut,$e,Yn)=>{var _n;let zi=ut+" (event type: "+ne.type+")";(_n=this==null?void 0:this.xhr)!=null&&_n.statusText&&(zi+=", current statusText is "+this.xhr.statusText),h.logAction(this.logger,h.LOG_ERROR,"Request.on"+ne.type+"()",zi),this.complete(new _e(zi,$e,Yn))};u.onerror=function(ne){C(ne,"XHR error occurred",null,400)},u.onabort=ne=>{this.timedOut?C(ne,"Request aborted due to request timeout expiring",null,408):C(ne,"Request cancelled",null,400)},u.ontimeout=function(ne){C(ne,"Request timed out",null,408)};let I,E,G,k=0,F=!1;const V=()=>{if(clearTimeout(r),G=E<400,E==204){this.complete(null,null,null,null,E);return}I=this.requestMode==Pt.REQ_RECV_STREAM&&G&&Ah(u)},Y=()=>{let ne;try{const $e=Oh(u,"content-type");if($e?$e.indexOf("application/json")>=0:u.responseType=="text"){const _n=u.responseType==="arraybuffer"?_.BufferUtils.utf8Decode(u.response):String(u.responseText);_n.length?ne=JSON.parse(_n):ne=_n,F=!0}else ne=u.response;ne.response!==void 0?(E=ne.statusCode,G=E<400,t=ne.headers,ne=ne.response):t=Rh(u)}catch($e){this.complete(new _e("Malformed response body from server: "+$e.message,null,400));return}if(G||Array.isArray(ne)){this.complete(null,ne,t,F,E);return}let ut=Ch(ne,t);ut||(ut=new _e("Error response received from server: "+E+" body was: "+_.Config.inspect(ne),null,E)),this.complete(ut,ne,t,F,E)};function ue(){const ne=u.responseText,ut=ne.length-1;let $e,Yn;for(;k<ut&&($e=ne.indexOf(`
`,k))>-1;)Yn=ne.slice(k,$e),k=$e+1,be(Yn)}const be=ne=>{try{ne=JSON.parse(ne)}catch(ut){this.complete(new _e("Malformed response body from server: "+ut.message,null,400));return}this.emit("data",ne)},Se=()=>{ue(),this.streamComplete=!0,_.Config.nextTick(()=>{this.complete()})};u.onreadystatechange=function(){const ne=u.readyState;ne<3||u.status!==0&&(E===void 0&&(E=u.status,V()),ne==3&&I?ue():ne==4&&(I?Se():Y()))},u.send(m)}dispose(){const t=this.xhr;if(t){t.onreadystatechange=t.onerror=t.onabort=t.ontimeout=_h,this.xhr=null;const i=this.timer;i&&(clearTimeout(i),this.timer=null),this.requestComplete||t.abort()}delete oa[this.id]}},aa=Th,ca=nt.XhrPolling,Mh=class extends vh{constructor(e,t,i){super(e,t,i),this.shortName=ca,i.stream=!1,this.shortName=ca}static isAvailable(){return!!(_.Config.xhrSupported&&_.Config.allowComet)}toString(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}createRequest(e,t,i,r,a){return aa.createRequest(e,t,i,r,a,this.timeouts,this.logger)}},Ph=Mh,kh=["xhr_polling"],Eh={order:kh,bundledImplementations:{web_socket:Jo,xhr_polling:Ph}},Ih=Eh,xh={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[nt.XhrPolling,nt.WebSocket]},Lh=xh;function Nh(e){if(e===void 0)return"undefined";let t,i;if(e instanceof ArrayBuffer?(i="ArrayBuffer",t=new DataView(e)):e instanceof DataView&&(i="DataView",t=e),!t)return JSON.stringify(e);const r=[];for(let a=0;a<e.byteLength;a++){if(a>20){r.push("...");break}let u=t.getUint8(a).toString(16);u.length===1&&(u="0"+u),r.push(u)}return"<"+i+" "+r.join(" ")+">"}function zn(e,t,i){for(let r=0,a=i.length;r<a;r++){const u=i.charCodeAt(r);if(u<128){e.setUint8(t++,u>>>0&127|0);continue}if(u<2048){e.setUint8(t++,u>>>6&31|192),e.setUint8(t++,u>>>0&63|128);continue}if(u<65536){e.setUint8(t++,u>>>12&15|224),e.setUint8(t++,u>>>6&63|128),e.setUint8(t++,u>>>0&63|128);continue}if(u<1114112){e.setUint8(t++,u>>>18&7|240),e.setUint8(t++,u>>>12&63|128),e.setUint8(t++,u>>>6&63|128),e.setUint8(t++,u>>>0&63|128);continue}throw new Error("bad codepoint "+u)}}function la(e,t,i){let r="";for(let a=t,u=t+i;a<u;a++){const g=e.getUint8(a);if((g&128)===0){r+=String.fromCharCode(g);continue}if((g&224)===192){r+=String.fromCharCode((g&15)<<6|e.getUint8(++a)&63);continue}if((g&240)===224){r+=String.fromCharCode((g&15)<<12|(e.getUint8(++a)&63)<<6|(e.getUint8(++a)&63)<<0);continue}if((g&248)===240){r+=String.fromCharCode((g&7)<<18|(e.getUint8(++a)&63)<<12|(e.getUint8(++a)&63)<<6|(e.getUint8(++a)&63)<<0);continue}throw new Error("Invalid byte "+g.toString(16))}return r}function Wi(e){let t=0;for(let i=0,r=e.length;i<r;i++){const a=e.charCodeAt(i);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}throw new Error("bad codepoint "+a)}return t}function Uh(e,t){const i=Qn(e,t);if(i===0)return;const r=new ArrayBuffer(i),a=new DataView(r);return Jn(e,a,0,t),r}var $i=65536*65536,ua=1/$i;function Bh(e,t){return t=t||0,e.getInt32(t)*$i+e.getUint32(t+4)}function Dh(e,t){return t=t||0,e.getUint32(t)*$i+e.getUint32(t+4)}function Hh(e,t,i){i<9223372036854776e3?(e.setInt32(t,Math.floor(i*ua)),e.setInt32(t+4,i&-1)):(e.setUint32(t,2147483647),e.setUint32(t+4,2147483647))}function Gh(e,t,i){i<18446744073709552e3?(e.setUint32(t,Math.floor(i*ua)),e.setInt32(t+4,i&-1)):(e.setUint32(t,4294967295),e.setUint32(t+4,4294967295))}var jh=class{constructor(e,t){this.map=i=>{const r={};for(let a=0;a<i;a++){const u=this.parse();r[u]=this.parse()}return r},this.bin=i=>{const r=new ArrayBuffer(i);return new Uint8Array(r).set(new Uint8Array(this.view.buffer,this.offset,i),0),this.offset+=i,r},this.buf=this.bin,this.str=i=>{const r=la(this.view,this.offset,i);return this.offset+=i,r},this.array=i=>{const r=new Array(i);for(let a=0;a<i;a++)r[a]=this.parse();return r},this.ext=i=>(this.offset+=i,{type:this.view.getInt8(this.offset),data:this.buf(i)}),this.parse=()=>{const i=this.view.getUint8(this.offset);let r,a;if((i&128)===0)return this.offset++,i;if((i&240)===128)return a=i&15,this.offset++,this.map(a);if((i&240)===144)return a=i&15,this.offset++,this.array(a);if((i&224)===160)return a=i&31,this.offset++,this.str(a);if((i&224)===224)return r=this.view.getInt8(this.offset),this.offset++,r;switch(i){case 192:return this.offset++,null;case 193:this.offset++;return;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return a=this.view.getUint8(this.offset+1),this.offset+=2,this.bin(a);case 197:return a=this.view.getUint16(this.offset+1),this.offset+=3,this.bin(a);case 198:return a=this.view.getUint32(this.offset+1),this.offset+=5,this.bin(a);case 199:return a=this.view.getUint8(this.offset+1),this.offset+=2,this.ext(a);case 200:return a=this.view.getUint16(this.offset+1),this.offset+=3,this.ext(a);case 201:return a=this.view.getUint32(this.offset+1),this.offset+=5,this.ext(a);case 202:return r=this.view.getFloat32(this.offset+1),this.offset+=5,r;case 203:return r=this.view.getFloat64(this.offset+1),this.offset+=9,r;case 204:return r=this.view.getUint8(this.offset+1),this.offset+=2,r;case 205:return r=this.view.getUint16(this.offset+1),this.offset+=3,r;case 206:return r=this.view.getUint32(this.offset+1),this.offset+=5,r;case 207:return r=Dh(this.view,this.offset+1),this.offset+=9,r;case 208:return r=this.view.getInt8(this.offset+1),this.offset+=2,r;case 209:return r=this.view.getInt16(this.offset+1),this.offset+=3,r;case 210:return r=this.view.getInt32(this.offset+1),this.offset+=5,r;case 211:return r=Bh(this.view,this.offset+1),this.offset+=9,r;case 212:return a=1,this.offset++,this.ext(a);case 213:return a=2,this.offset++,this.ext(a);case 214:return a=4,this.offset++,this.ext(a);case 215:return a=8,this.offset++,this.ext(a);case 216:return a=16,this.offset++,this.ext(a);case 217:return a=this.view.getUint8(this.offset+1),this.offset+=2,this.str(a);case 218:return a=this.view.getUint16(this.offset+1),this.offset+=3,this.str(a);case 219:return a=this.view.getUint32(this.offset+1),this.offset+=5,this.str(a);case 220:return a=this.view.getUint16(this.offset+1),this.offset+=3,this.array(a);case 221:return a=this.view.getUint32(this.offset+1),this.offset+=5,this.array(a);case 222:return a=this.view.getUint16(this.offset+1),this.offset+=3,this.map(a);case 223:return a=this.view.getUint32(this.offset+1),this.offset+=5,this.map(a)}throw new Error("Unknown type 0x"+i.toString(16))},this.offset=t||0,this.view=e}};function qh(e){const t=new DataView(e),i=new jh(t),r=i.parse();if(i.offset!==e.byteLength)throw new Error(e.byteLength-i.offset+" trailing bytes");return r}function ha(e,t){return Object.keys(e).filter(function(i){const r=e[i],a=typeof r;return(!t||r!=null)&&(a!=="function"||!!r.toJSON)})}function Jn(e,t,i,r){const a=typeof e;if(typeof e=="string"){const u=Wi(e);if(u<32)return t.setUint8(i,u|160),zn(t,i+1,e),1+u;if(u<256)return t.setUint8(i,217),t.setUint8(i+1,u),zn(t,i+2,e),2+u;if(u<65536)return t.setUint8(i,218),t.setUint16(i+1,u),zn(t,i+3,e),3+u;if(u<4294967296)return t.setUint8(i,219),t.setUint32(i+1,u),zn(t,i+5,e),5+u}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){const u=e.byteLength;if(u<256)return t.setUint8(i,196),t.setUint8(i+1,u),new Uint8Array(t.buffer).set(new Uint8Array(e),i+2),2+u;if(u<65536)return t.setUint8(i,197),t.setUint16(i+1,u),new Uint8Array(t.buffer).set(new Uint8Array(e),i+3),3+u;if(u<4294967296)return t.setUint8(i,198),t.setUint32(i+1,u),new Uint8Array(t.buffer).set(new Uint8Array(e),i+5),5+u}if(typeof e=="number"){if(Math.floor(e)!==e)return t.setUint8(i,203),t.setFloat64(i+1,e),9;if(e>=0){if(e<128)return t.setUint8(i,e),1;if(e<256)return t.setUint8(i,204),t.setUint8(i+1,e),2;if(e<65536)return t.setUint8(i,205),t.setUint16(i+1,e),3;if(e<4294967296)return t.setUint8(i,206),t.setUint32(i+1,e),5;if(e<18446744073709552e3)return t.setUint8(i,207),Gh(t,i+1,e),9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(i,e),1;if(e>=-128)return t.setUint8(i,208),t.setInt8(i+1,e),2;if(e>=-32768)return t.setUint8(i,209),t.setInt16(i+1,e),3;if(e>=-2147483648)return t.setUint8(i,210),t.setInt32(i+1,e),5;if(e>=-9223372036854776e3)return t.setUint8(i,211),Hh(t,i+1,e),9;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(a==="undefined")return r?0:(t.setUint8(i,212),t.setUint8(i+1,0),t.setUint8(i+2,0),3);if(e===null)return r?0:(t.setUint8(i,192),1);if(a==="boolean")return t.setUint8(i,e?195:194),1;if(typeof e.toJSON=="function")return Jn(e.toJSON(),t,i,r);if(a==="object"){let u,g=0,m;const S=Array.isArray(e);if(S?u=e.length:(m=ha(e,r),u=m.length),u<16?(t.setUint8(i,u|(S?144:128)),g=1):u<65536?(t.setUint8(i,S?220:222),t.setUint16(i+1,u),g=3):u<4294967296&&(t.setUint8(i,S?221:223),t.setUint32(i+1,u),g=5),S)for(let C=0;C<u;C++)g+=Jn(e[C],t,i+g,r);else if(m)for(let C=0;C<u;C++){const I=m[C];g+=Jn(I,t,i+g),g+=Jn(e[I],t,i+g,r)}return g}if(a==="function")return 0;throw new Error("Unknown type "+a)}function Qn(e,t){const i=typeof e;if(i==="string"){const r=Wi(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(typeof e=="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;if(e<18446744073709552e3)return 9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(i==="boolean")return 1;if(e===null)return t?0:1;if(e===void 0)return t?0:3;if(typeof e.toJSON=="function")return Qn(e.toJSON(),t);if(i==="object"){let r,a=0;if(Array.isArray(e)){r=e.length;for(let u=0;u<r;u++)a+=Qn(e[u],t)}else{const u=ha(e,t);r=u.length;for(let g=0;g<r;g++){const m=u[g];a+=Qn(m)+Qn(e[m],t)}}if(r<16)return 1+a;if(r<65536)return 3+a;if(r<4294967296)return 5+a;throw new Error("Array or object too long 0x"+r.toString(16))}if(i==="function")return 0;throw new Error("Unknown type "+i)}var Ki={encode:Uh,decode:qh,inspect:Nh,utf8Write:zn,utf8Read:la,utf8ByteCount:Wi};function Fh(e,t){return!!t.get("x-ably-errorcode")}function Vh(e,t){if(Fh(e,t))return e.error&&R.fromValues(e.error)}function Wh(e){const t={};return e.forEach((i,r)=>{t[r]=i}),t}async function $h(e,t,i,r,a,u){const g=new Headers(r||{}),m=e?e.toUpperCase():ke(u)?"GET":"POST",S=new AbortController;let C;const I=new Promise(k=>{C=setTimeout(()=>{S.abort(),k({error:new _e("Request timed out",null,408)})},t?t.options.timeouts.httpRequestTimeout:ee.TIMEOUTS.httpRequestTimeout)}),E={method:m,headers:g,body:u,signal:S.signal};_.Config.isWebworker||(E.credentials=g.has("authorization")?"include":"same-origin");const G=(async()=>{try{const k=new URLSearchParams(a||{});k.set("rnd",K());const F=i+"?"+k,V=await He().fetch(F,E);if(clearTimeout(C),V.status==204)return{error:null,statusCode:V.status};const Y=V.headers.get("Content-Type");let ue;Y&&Y.indexOf("application/x-msgpack")>-1?ue=await V.arrayBuffer():Y&&Y.indexOf("application/json")>-1?ue=await V.json():ue=await V.text();const be=!!Y&&Y.indexOf("application/x-msgpack")===-1,Se=Wh(V.headers);return V.ok?{error:null,body:ue,headers:Se,unpacked:be,statusCode:V.status}:{error:Vh(ue,V.headers)||new _e("Error response received from server: "+V.status+" body was: "+_.Config.inspect(ue),null,V.status),body:ue,headers:Se,unpacked:be,statusCode:V.status}}catch(k){return clearTimeout(C),{error:k}}})();return Promise.race([I,G])}var Kh={XHRRequest:aa,FetchRequest:$h},fa=lh(ra,Zo);_.Crypto=fa,_.BufferUtils=Zo,_.Http=sa,_.Config=ra,_.Transports=Ih,_.WebStorage=ia;for(const e of[xi,Hi])e.Crypto=fa,e._MsgPack=Ki;sa.bundledRequestImplementations=Kh,h.initLogHandlers(),_.Defaults=Ol(Lh),_.Config.agent&&(_.Defaults.agent+=" "+_.Config.agent);var zh={ErrorInfo:R,Rest:xi,Realtime:Hi,msgpack:Ki,makeProtocolMessageFromDeserialized:Go};if(typeof c.exports=="object"&&typeof o=="object"){var Jh=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Object.getOwnPropertyNames(t))!Object.prototype.hasOwnProperty.call(e,a)&&a!==i&&Object.defineProperty(e,a,{get:()=>t[a],enumerable:!(r=Object.getOwnPropertyDescriptor(t,a))||r.enumerable});return e};c.exports=Jh(c.exports,o)}return c.exports})}($s)),$s.exports}var dp=fp();const gp={name:"Chat",data(){var n,s;return{activeSection:"users-section",users:[],loading:!1,loggedInUsername:((n=localStorage.getItem("username"))==null?void 0:n.trim())||null,inputMessage:"",messages:[],warningMessage:"",sentMessages:new Set,username:((s=localStorage.getItem("username"))==null?void 0:s.trim())||"Unknown",userColors:{},ably:null,channel:null}},methods:{switchSection(n){this.activeSection=n},async fetchUsers(){this.loading=!0;try{const s=await(await fetch("https://1999-theta.vercel.app/api/UserListChat",{method:"GET",headers:{"Content-Type":"application/json"}})).json(),o=new Set;this.users=s.filter(c=>o.has(c.username)?!1:(o.add(c.username),!0))}catch(n){console.error("Error fetching users:",n)}finally{this.loading=!1}},handleUserClick(n){n.username!==this.loggedInUsername&&(localStorage.setItem("chatWith",n.username),localStorage.setItem("chatWithId",n.id),localStorage.setItem("profileImage",n.profile_picture||"default-pfp.jpg"),window.location.href="https://latestnewsandaffairs.site/public/react.html")},getColorForUsername(n){if(!this.userColors[n]){const s=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#800000"];this.userColors[n]=s[Math.floor(Math.random()*s.length)]}return this.userColors[n]},getUsernameStyle(n){return n==="USERNAME99"?{backgroundColor:"#000",color:"#fff",fontSize:"23px",marginRight:"8px",whiteSpace:"nowrap",padding:"4px 8px",borderRadius:"4px"}:{fontWeight:"bold",color:this.getColorForUsername(n)}},appendMessage(n,s,o){this.sentMessages.has(o)||(this.messages.push({text:n,username:s,id:o}),this.sentMessages.add(o),this.$nextTick(()=>{const c=this.$el.querySelector("#messages");c.scrollTop=c.scrollHeight}))},sendMessage(){const n=this.inputMessage.trim();if(this.warningMessage="",!this.username||this.username==="Unknown"){this.warningMessage="Please sign up before sending a message.";return}if(n){const s=Date.now()+Math.random();this.appendMessage(n,this.username,s),this.channel&&this.channel.publish("new-message",{text:n,id:s,username:this.username}),this.inputMessage=""}}},mounted(){this.fetchUsers(),this.ably=new dp.Realtime("9frHeA.Si13Zw:KVzVyovw6hCu4RRuy6P11Tyl0h7MJIzv2Q_n4YgbNnE"),this.ably.connection.on("connected",()=>{console.log("Connected to Ably"),this.channel=this.ably.channels.get("chat-room"),this.channel.subscribe("new-message",n=>{const{text:s,id:o,username:c}=n.data;this.sentMessages.has(o)||this.appendMessage(s,c,o)})}),this.ably.connection.on("failed",()=>{console.error("Failed to connect to Ably"),this.warningMessage="Failed to connect to chat service."})},beforeUnmount(){this.channel&&this.channel.unsubscribe("new-message"),this.ably&&this.ably.close()}},pp={class:"chat-section",style:{background:"linear-gradient(to bottom right, #111827, #581c87)",border:"none"}},mp={class:"tabs"},yp={class:"sections"},bp={class:"section active"},vp={key:0,id:"loading",class:"loading"},wp={class:"users-container"},Cp=["onClick"],_p={class:"profile-picture"},Sp=["src","alt"],Op={class:"username"},Ap={class:"section"},Rp={id:"chat-container"},Tp={id:"messages"},Mp={class:"bubble"},Pp={class:"text-row"},kp={class:"message-text"},Ep={id:"input-container"},Ip={id:"warning-message"};function xp(n,s,o,c,l,f){return he(),we("section",pp,[A("div",mp,[A("button",{class:Je({active:l.activeSection==="users-section"}),onClick:s[0]||(s[0]=d=>f.switchSection("users-section"))}," Conversation ",2),A("button",{class:Je({active:l.activeSection==="World Chat"}),onClick:s[1]||(s[1]=d=>f.switchSection("World Chat"))}," World Chat ",2)]),A("div",yp,[Nt(A("div",bp,[l.loading?(he(),we("div",vp,s[5]||(s[5]=[A("div",{class:"spinner"},null,-1)]))):it("",!0),s[6]||(s[6]=A("div",{id:"load-more-trigger"},null,-1)),A("div",wp,[(he(!0),we(ze,null,Nn(l.users,d=>(he(),we("div",{key:d.username,class:"user-card",onClick:p=>f.handleUserClick(d)},[A("div",_p,[A("img",{src:d.profile_picture||"default-pfp.jpg",alt:d.username+" profile"},null,8,Sp)]),A("div",Op,[A("strong",null,Te(d.username),1)])],8,Cp))),128))])],512),[[Mn,l.activeSection==="users-section"]]),Nt(A("div",Ap,[A("div",Rp,[A("div",Tp,[(he(!0),we(ze,null,Nn(l.messages,d=>(he(),we("div",{key:d.id,class:"message"},[A("div",Mp,[A("div",Pp,[A("div",{class:"username",style:Ln(f.getUsernameStyle(d.username))},Te(d.username||"Unknown"),5),A("span",kp,Te(d.text||"[Empty Message]"),1)])])]))),128))]),A("div",Ep,[Nt(A("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>l.inputMessage=d),id:"input-message",type:"text",placeholder:"Type a message...",onKeyup:s[3]||(s[3]=ii((...d)=>f.sendMessage&&f.sendMessage(...d),["enter"]))},null,544),[[Wr,l.inputMessage]]),A("button",{id:"send-button",onClick:s[4]||(s[4]=(...d)=>f.sendMessage&&f.sendMessage(...d))},"Send")]),A("div",Ip,Te(l.warningMessage),1)])],512),[[Mn,l.activeSection==="World Chat"]])])])}const Lp=_s(gp,[["render",xp]]),Np={name:"Settings",data(){return{activeTab:null,userProfile:{username:"",profilePicture:"default.jpg",description:"",location:"",status:"",profession:"",hobby:""},newProfilePicture:null,settings:{darkMode:!1,notifications:!0,privateAccount:!1,showOnlineStatus:!0,twoFactorAuth:!1}}},computed:{toggleSettings(){return[{key:"darkMode",label:"Dark Mode"},{key:"notifications",label:"Notifications"},{key:"privateAccount",label:"Private Account"},{key:"showOnlineStatus",label:"Show Online Status"},{key:"twoFactorAuth",label:"Two-Factor Authentication"}]}},methods:{toggleTab(n){this.activeTab=this.activeTab===n?null:n},async fetchUserSettings(){var n;try{const s=localStorage.getItem("username");if(!s){alert("Username not found!");return}const c=await(await fetch(`https://sports321.vercel.app/api/posts?username=${s}`)).json();this.userProfile={username:s,location:c.location||"Location not available",status:c.status||"Status not available",profession:c.profession||"Profession not available",hobby:c.hobby||"Hobby not available",description:c.description||"No description available",profilePicture:(n=c.profile_picture)!=null&&n.startsWith("data:image")?c.profile_picture:`https://sports321.vercel.app/${c.profile_picture||"default.jpg"}`}}catch(s){console.error("Error fetching user settings:",s),this.userProfile={username:localStorage.getItem("username")||"",profilePicture:"default.jpg",description:"No description available",location:"Location not available",status:"Status not available",profession:"Profession not available",hobby:"Hobby not available"}}},async updateUserProfileField(n,s){const o=localStorage.getItem("username");if(!o){alert("Username not found!");return}try{const l=await(await fetch("https://sports123.vercel.app/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,[n]:s})})).json(),f=`${n.charAt(0).toUpperCase()+n.slice(1)} updated successfully`;l.message===f?(alert(`Your ${n} has been updated!`),this.userProfile[n]=s):alert(`Failed to update ${n}`)}catch(c){console.error(`Error updating ${n}:`,c),alert(`Failed to update ${n}`)}},changeUsername(){const n=prompt("Enter your new username:",this.userProfile.username);n!=null&&n.trim()&&this.updateUserProfileField("username",n.trim())},editDescription(){const n=prompt("Enter your new description:",this.userProfile.description);n!=null&&n.trim()&&this.updateUserProfileField("description",n.trim())},editLocation(){const n=prompt("Enter your new location:",this.userProfile.location);n!=null&&n.trim()&&this.updateUserProfileField("location",n.trim())},editStatus(){const n=prompt("Enter your new status:",this.userProfile.status);n!=null&&n.trim()&&this.updateUserProfileField("status",n.trim())},editProfession(){const n=prompt("Enter your new profession:",this.userProfile.profession);n!=null&&n.trim()&&this.updateUserProfileField("profession",n.trim())},editHobby(){const n=prompt("Enter your new hobby:",this.userProfile.hobby);n!=null&&n.trim()&&this.updateUserProfileField("hobby",n.trim())},triggerFileInput(){this.$refs.profileFileInput.click()},handleProfilePictureChange(n){const s=n.target.files[0];if(s){const o=new FileReader;o.onload=c=>{this.newProfilePicture=c.target.result,this.userProfile.profilePicture=c.target.result},o.readAsDataURL(s)}},async saveProfilePicture(){if(this.newProfilePicture)try{const n=localStorage.getItem("username");if(!n){alert("Username not found!");return}(await(await fetch("https://sports123.vercel.app/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,profilePicture:this.newProfilePicture})})).json()).message==="Profile picture updated successfully"?(alert("Profile picture updated!"),this.newProfilePicture=null):alert("Failed to update profile picture")}catch(n){console.error("Error updating profile picture:",n),alert("Failed to update profile picture")}},toggleSetting(n){this.settings[n]=!this.settings[n],n==="darkMode"&&this.toggleDarkMode()},toggleDarkMode(){document.documentElement.classList.toggle("dark-mode",this.settings.darkMode),localStorage.setItem("darkMode",this.settings.darkMode)},getStatusText(n){switch(n){case"darkMode":return this.settings.darkMode?"On":"Off";case"notifications":return this.settings.notifications?"On":"Off";case"privateAccount":return this.settings.privateAccount?"On":"Off";case"showOnlineStatus":return this.settings.showOnlineStatus?"Visible":"Hidden";case"twoFactorAuth":return this.settings.twoFactorAuth?"Enabled":"Disabled";default:return""}},getToggleStyle(n){return{width:"50px",height:"26px",borderRadius:"13px",background:this.settings[n]?"linear-gradient(135deg, #34c759, #28a745)":"linear-gradient(135deg, #e0e0e0, #b0b0b0)",position:"relative",cursor:"pointer",transition:"background 0.3s ease",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"}},getKnobStyle(n){return{height:"22px",width:"22px",background:"linear-gradient(135deg, #ffffff, #f0f0f0)",borderRadius:"50%",position:"absolute",top:"2px",left:this.settings[n]?"26px":"2px",transition:"left 0.3s ease, transform 0.2s ease",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",transform:this.settings[n]?"scale(1.05)":"scale(1)"}},saveSettings(){console.log("Settings saved:",this.settings),alert("Settings saved successfully!")},openBlockedUsers(){alert("Navigating to Blocked Users...")},viewMyActivity(){alert("Navigating to My Activity...")},logOut(){alert("Logging out...")}},mounted(){this.fetchUserSettings();const n=localStorage.getItem("darkMode")==="true";this.settings.darkMode=n,n&&document.documentElement.classList.add("dark-mode")}},Up={class:"settings-section container mt-5"},Bp={class:"row"},Dp={class:"col-md-12"},Hp={class:"nav flex-column nav-pills",role:"tablist"},Gp={class:"nav-item mb-2"},jp={class:"tab-content p-4 tab-border rounded shadow-sm mt-2"},qp={class:"mb-3 d-flex align-items-center"},Fp={class:"mb-3"},Vp={class:"d-flex align-items-center mt-2"},Wp=["src"],$p={class:"mb-3 d-flex align-items-center"},Kp={class:"mb-3 d-flex align-items-center"},zp={class:"mb-3 d-flex align-items-center"},Jp={class:"mb-3 d-flex align-items-center"},Qp={class:"mb-3 d-flex align-items-center"},Yp={class:"nav-item mb-2"},Xp={class:"tab-content p-4 tab-border rounded shadow-sm mt-2"},Zp={class:"d-flex align-items-center"},em=["aria-pressed","onClick","onKeydown"],tm={class:"ms-3 status-text"},nm={class:"nav-item mb-2"},sm={class:"tab-content p-4 tab-border rounded shadow-sm mt-2"},im={class:"nav-item mb-2"},rm={class:"tab-content p-4 tab-border rounded shadow-sm mt-2"};function om(n,s,o,c,l,f){return he(),we("section",Up,[s[30]||(s[30]=A("h2",{class:"text-center mb-4"},"Settings",-1)),A("div",Bp,[A("div",Dp,[A("ul",Hp,[A("li",Gp,[A("a",{class:Je(["nav-link",{active:l.activeTab==="profile"}]),onClick:s[0]||(s[0]=d=>f.toggleTab("profile")),href:"#profile",role:"tab","aria-expanded":"activeTab === 'profile'"}," Profile ",2),Nt(A("div",jp,[A("div",qp,[s[17]||(s[17]=A("strong",{class:"me-2"},"Username:",-1)),A("span",null,Te(l.userProfile.username||"Loading..."),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[1]||(s[1]=(...d)=>f.changeUsername&&f.changeUsername(...d))})]),s[24]||(s[24]=A("hr",null,null,-1)),A("div",Fp,[s[18]||(s[18]=A("strong",null,"Profile Picture:",-1)),A("div",Vp,[A("img",{src:l.userProfile.profilePicture,alt:"Profile Picture",class:"rounded-circle me-3",style:{width:"80px",height:"80px","object-fit":"cover"}},null,8,Wp),A("i",{class:"fas fa-edit edit-icon",onClick:s[2]||(s[2]=(...d)=>f.triggerFileInput&&f.triggerFileInput(...d))}),A("input",{type:"file",ref:"profileFileInput",onChange:s[3]||(s[3]=(...d)=>f.handleProfilePictureChange&&f.handleProfilePictureChange(...d)),accept:"image/*",style:{display:"none"}},null,544),l.newProfilePicture?(he(),we("button",{key:0,class:"btn btn-success btn-sm ms-3",onClick:s[4]||(s[4]=(...d)=>f.saveProfilePicture&&f.saveProfilePicture(...d))}," Save ")):it("",!0)])]),s[25]||(s[25]=A("hr",null,null,-1)),A("div",$p,[s[19]||(s[19]=A("strong",{class:"me-2"},"Description:",-1)),A("span",null,Te(l.userProfile.description||"No description available"),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[5]||(s[5]=(...d)=>f.editDescription&&f.editDescription(...d))})]),s[26]||(s[26]=A("hr",null,null,-1)),A("div",Kp,[s[20]||(s[20]=A("strong",{class:"me-2"},"Location:",-1)),A("span",null,Te(l.userProfile.location||"Location not available"),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[6]||(s[6]=(...d)=>f.editLocation&&f.editLocation(...d))})]),s[27]||(s[27]=A("hr",null,null,-1)),A("div",zp,[s[21]||(s[21]=A("strong",{class:"me-2"},"Status:",-1)),A("span",null,Te(l.userProfile.status||"Status not available"),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[7]||(s[7]=(...d)=>f.editStatus&&f.editStatus(...d))})]),s[28]||(s[28]=A("hr",null,null,-1)),A("div",Jp,[s[22]||(s[22]=A("strong",{class:"me-2"},"Profession:",-1)),A("span",null,Te(l.userProfile.profession||"Profession not available"),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[8]||(s[8]=(...d)=>f.editProfession&&f.editProfession(...d))})]),s[29]||(s[29]=A("hr",null,null,-1)),A("div",Qp,[s[23]||(s[23]=A("strong",{class:"me-2"},"Hobby:",-1)),A("span",null,Te(l.userProfile.hobby||"Hobby not available"),1),A("i",{class:"fas fa-edit edit-icon ms-auto",onClick:s[9]||(s[9]=(...d)=>f.editHobby&&f.editHobby(...d))})])],512),[[Mn,l.activeTab==="profile"]])]),A("li",Yp,[A("a",{class:Je(["nav-link",{active:l.activeTab==="general"}]),onClick:s[10]||(s[10]=d=>f.toggleTab("general")),href:"#general",role:"tab","aria-expanded":"activeTab === 'general'"}," General ",2),Nt(A("div",Xp,[(he(!0),we(ze,null,Nn(f.toggleSettings,d=>(he(),we("div",{key:d.key,class:"d-flex justify-content-between align-items-center mb-3"},[A("span",null,Te(d.label),1),A("div",Zp,[A("div",{class:"toggle-switch","aria-pressed":l.settings[d.key],role:"switch",tabindex:"0",onClick:p=>f.toggleSetting(d.key),onKeydown:[ii(za(p=>f.toggleSetting(d.key),["prevent"]),["space"]),ii(za(p=>f.toggleSetting(d.key),["prevent"]),["enter"])],style:Ln(f.getToggleStyle(d.key))},[A("div",{class:"toggle-knob",style:Ln(f.getKnobStyle(d.key))},null,4)],44,em),A("span",tm,Te(f.getStatusText(d.key)),1)])]))),128)),A("button",{class:"btn btn-custom mt-3 w-100",onClick:s[11]||(s[11]=(...d)=>f.saveSettings&&f.saveSettings(...d))}," Save Settings ")],512),[[Mn,l.activeTab==="general"]])]),A("li",nm,[A("a",{class:Je(["nav-link",{active:l.activeTab==="history"}]),onClick:s[12]||(s[12]=d=>f.toggleTab("history")),href:"#history",role:"tab","aria-expanded":"activeTab === 'history'"}," History ",2),Nt(A("div",sm,[A("button",{class:"btn btn-custom w-100",onClick:s[13]||(s[13]=(...d)=>f.viewMyActivity&&f.viewMyActivity(...d))}," View My Activity ")],512),[[Mn,l.activeTab==="history"]])]),A("li",im,[A("a",{class:Je(["nav-link",{active:l.activeTab==="account"}]),onClick:s[14]||(s[14]=d=>f.toggleTab("account")),href:"#account",role:"tab","aria-expanded":"activeTab === 'account'"}," Account ",2),Nt(A("div",rm,[A("button",{class:"btn btn-custom w-100 mb-3",onClick:s[15]||(s[15]=(...d)=>f.openBlockedUsers&&f.openBlockedUsers(...d))}," Blocked Users "),A("button",{class:"btn btn-danger w-100",onClick:s[16]||(s[16]=(...d)=>f.logOut&&f.logOut(...d))},"Log Out")],512),[[Mn,l.activeTab==="account"]])])])])])])}const am=_s(Np,[["render",om],["__scopeId","data-v-3071b359"]]),cm={components:{Posts:Zg,Videos:up,Chat:Lp,Settings:am},data(){return{currentTab:"posts",searchVisible:!1,searchQuery:"",showProfileMenu:!1,userProfile:{name:"John Doe",email:"john.doe@example.com",avatar:"https://via.placeholder.com/32"},loggedInUsername:localStorage.getItem("username")||"Unknown",sessionId:sessionStorage.getItem("sessionId"),settings:{darkMode:!1,notifications:!0}}},methods:{switchTab(n){this.currentTab=n,this.searchVisible=!1,this.showProfileMenu=!1},toggleSearch(){this.searchVisible=!this.searchVisible,this.showProfileMenu=!1,this.searchVisible&&this.$nextTick(()=>{const n=document.querySelector(".search-dropdown input");n&&n.focus()})},toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu,this.searchVisible=!1},logout(){console.log("User logged out"),this.showProfileMenu=!1}}},lm={class:"min-h-screen flex flex-col"},um={class:"user-section",style:{gap:"12px",display:"flex"}},hm={key:0,class:"search-dropdown"},fm={class:"relative"},dm=["src"],gm={key:0,class:"profile-menu"},pm={class:"name"},mm={class:"email"},ym={class:"glassmorphism"};function bm(n,s,o,c,l,f){const d=js("Posts"),p=js("Videos"),y=js("Chat"),O=js("Settings");return he(),we("div",lm,[A("header",null,[s[9]||(s[9]=A("h1",{style:{"font-size":"23px","margin-left":"5%"}},"𝓢𝔂𝓷𝓬",-1)),A("div",um,[A("i",{class:"fas fa-search search-icon",onClick:s[0]||(s[0]=(...v)=>f.toggleSearch&&f.toggleSearch(...v)),style:{"font-size":"25px",color:"#5eead4","margin-right":"15%",cursor:"pointer","margin-top":"5px"}}),je(ni,{name:"fade"},{default:ps(()=>[l.searchVisible?(he(),we("div",hm,[Nt(A("input",{"onUpdate:modelValue":s[1]||(s[1]=v=>l.searchQuery=v),type:"text",placeholder:"Search posts or videos..."},null,512),[[Wr,l.searchQuery]])])):it("",!0)]),_:1}),A("div",fm,[A("img",{src:l.userProfile.avatar,alt:"User Avatar",class:"hover-scale",onClick:s[2]||(s[2]=(...v)=>f.toggleProfileMenu&&f.toggleProfileMenu(...v)),style:{width:"32px",height:"32px","border-radius":"50%",cursor:"pointer",border:"2px solid #000","margin-right":"20px"}},null,8,dm),je(ni,{name:"fade"},{default:ps(()=>[l.showProfileMenu?(he(),we("div",gm,[A("p",pm,Te(l.userProfile.name),1),A("p",mm,Te(l.userProfile.email),1),A("button",{onClick:s[3]||(s[3]=(...v)=>f.logout&&f.logout(...v))},"Logout")])):it("",!0)]),_:1})])])]),A("main",null,[l.currentTab==="posts"?(he(),ns(d,{key:0,searchQuery:l.searchQuery,loggedInUsername:l.loggedInUsername,sessionId:l.sessionId},null,8,["searchQuery","loggedInUsername","sessionId"])):it("",!0),l.currentTab==="videos"?(he(),ns(p,{key:1,searchQuery:l.searchQuery},null,8,["searchQuery"])):it("",!0),l.currentTab==="chat"?(he(),ns(y,{key:2})):it("",!0),l.currentTab==="settings"?(he(),ns(O,{key:3,settings:l.settings,"onUpdate:settings":s[4]||(s[4]=v=>l.settings=v)},null,8,["settings"])):it("",!0)]),A("nav",ym,[A("ul",null,[A("li",{class:Je({active:l.currentTab==="posts"}),onClick:s[5]||(s[5]=v=>f.switchTab("posts"))},s[10]||(s[10]=[A("i",{class:"fas fa-home"},null,-1)]),2),A("li",{class:Je({active:l.currentTab==="videos"}),onClick:s[6]||(s[6]=v=>f.switchTab("videos"))},s[11]||(s[11]=[A("i",{class:"fab fa-youtube"},null,-1)]),2),A("li",{class:Je({active:l.currentTab==="chat"}),onClick:s[7]||(s[7]=v=>f.switchTab("chat"))},s[12]||(s[12]=[A("i",{class:"fas fa-comment"},null,-1)]),2),A("li",{class:Je({active:l.currentTab==="settings"}),onClick:s[8]||(s[8]=v=>f.switchTab("settings"))},s[13]||(s[13]=[A("i",{class:"fas fa-cog"},null,-1)]),2)])])])}const vm=_s(cm,[["render",bm]]);Rg(vm).mount("#app");
